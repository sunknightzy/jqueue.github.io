<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta />
    <title>finalize 方法重写对 GC 的影响分析 - J.Queue的技术博客</title>
    <link rel="manifest" href="/manifest.json" />
    <meta name="application-name" content="J.Queue的技术博客" />
    <meta name="msapplication-TileImage" content="/img/favicon.ico" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="J.Queue的技术博客" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta
      name="description"
      content="关于 Object 的 finalize 方法，在日常开发中可能有超过 99% 的人都没有关注过，因为业务开发很少有重写 finalize 方法的场景；开发者对于 finalize 的认知大多在是“面试八股文”中，而且也不乏见到将 finalize、finally 以及 final 放在一块比较的 case，面试官可能是出于对初学者 java 基本语言知识的考量，但是这真的有意义吗？"
    />
    <meta property="og:type" content="blog" />
    <meta property="og:title" content="finalize 方法重写对 GC 的影响分析" />
    <meta
      property="og:url"
      content="http://www.glmapper.com/2021/11/02/java/java-advance-gc-finalize/"
    />
    <meta property="og:site_name" content="J.Queue的技术博客" />
    <meta
      property="og:description"
      content="关于 Object 的 finalize 方法，在日常开发中可能有超过 99% 的人都没有关注过，因为业务开发很少有重写 finalize 方法的场景；开发者对于 finalize 的认知大多在是“面试八股文”中，而且也不乏见到将 finalize、finally 以及 final 放在一块比较的 case，面试官可能是出于对初学者 java 基本语言知识的考量，但是这真的有意义吗？"
    />
    <meta property="og:locale" content="zh_CN" />
    <meta
      property="og:image"
      content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/367ff72d7c504747be0173841e1d4cab~tplv-k3u1fbpfcp-zoom-1.image"
    />
    <meta
      property="og:image"
      content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4bea36e8c1604a7b90a39968b38185b2~tplv-k3u1fbpfcp-zoom-1.image"
    />
    <meta
      property="og:image"
      content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/151002a959944a4a9aa11816da88bf18~tplv-k3u1fbpfcp-zoom-1.image"
    />
    <meta
      property="article:published_time"
      content="2021-11-02T03:17:56.000Z"
    />
    <meta property="article:modified_time" content="2022-04-24T03:21:21.447Z" />
    <meta property="article:author" content="J.Queue" />
    <meta property="article:tag" content="SOFAArk" />
    <meta property="article:tag" content="ClassLoader" />
    <meta property="article:tag" content="gc" />
    <meta property="twitter:card" content="summary" />
    <meta
      property="twitter:image"
      content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/367ff72d7c504747be0173841e1d4cab~tplv-k3u1fbpfcp-zoom-1.image"
    />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http://www.glmapper.com/2021/11/02/java/java-advance-gc-finalize/"
        },
        "headline": "finalize 方法重写对 GC 的影响分析",
        "image": [],
        "datePublished": "2021-11-02T03:17:56.000Z",
        "dateModified": "2022-04-24T03:21:21.447Z",
        "author": { "@type": "Person", "name": "J.Queue" },
        "publisher": {
          "@type": "Organization",
          "name": "J.Queue的技术博客",
          "logo": {
            "@type": "ImageObject",
            "url": { "text": "J.Queue的技术博客" }
          }
        },
        "description": "关于 Object 的 finalize 方法，在日常开发中可能有超过 99% 的人都没有关注过，因为业务开发很少有重写 finalize 方法的场景；开发者对于 finalize 的认知大多在是“面试八股文”中，而且也不乏见到将 finalize、finally 以及 final 放在一块比较的 case，面试官可能是出于对初学者 java 基本语言知识的考量，但是这真的有意义吗？"
      }
    </script>
    <link
      rel="canonical"
      href="http://www.glmapper.com/2021/11/02/java/java-advance-gc-finalize/"
    />
    <link rel="icon" href="/img/favicon.ico" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/github.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"
    />
    <link rel="stylesheet" href="/css/default.css" />
    <style>
      body > .footer,
      body > .navbar,
      body > .section {
        opacity: 0;
      }
    </style>
    <!--!-->
    <!--!-->
    <!--!-->
    <script
      src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"
      defer
    ></script>
    <!--!-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"
    />
    <!--!-->
    <!--!-->
    <style>
      .pace {
        -webkit-pointer-events: none;
        pointer-events: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }
      .pace-inactive {
        display: none;
      }
      .pace .pace-progress {
        background: #3273dc;
        position: fixed;
        z-index: 2000;
        top: 0;
        right: 100%;
        width: 100%;
        height: 2px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script>
    <!--!-->
    <!--!-->
    <!-- hexo injector head_end start -->
    <script>
      ;(function () {
        function switchTab() {
          if (!location.hash) {
            return
          }
          Array.from(document.querySelectorAll('.tab-content')).forEach(
            ($tab) => {
              $tab.classList.add('is-hidden')
            }
          )
          Array.from(document.querySelectorAll('.tabs li')).forEach(($tab) => {
            $tab.classList.remove('is-active')
          })
          const $activeTab = document.querySelector(location.hash)
          if ($activeTab) {
            $activeTab.classList.remove('is-hidden')
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`)
          if ($tabMenu) {
            $tabMenu.parentElement.classList.add('is-active')
          }
        }
        switchTab()
        window.addEventListener('hashchange', switchTab, false)
      })()
    </script>
    <!-- hexo injector head_end end -->
    <meta name="generator" content="Hexo 6.1.0" />
    <link
      rel="alternate"
      href="/atom.xml"
      title="J.Queue的技术博客"
      type="application/atom+xml"
    />
  </head>
  <body class="is-3-column">
    <nav class="navbar navbar-main">
      <div class="container navbar-container">
        <div class="navbar-brand justify-content-center">
          <a class="navbar-item navbar-logo" href="/">J.Queue的技术博客</a>
        </div>
        <div class="navbar-menu">
          <div class="navbar-start">
            <a class="navbar-item" href="/">首页</a
            ><a class="navbar-item" href="/archives">归档</a
            ><a class="navbar-item" href="/categories">分类</a
            ><a class="navbar-item" href="/tags">Tags</a
            ><a class="navbar-item" href="/about">关于</a>
          </div>
          <div class="navbar-end">
            <a
              class="navbar-item"
              target="_blank"
              rel="noopener"
              title="Download on GitHub"
              href="https://github.com/glmapper"
              ><i class="fab fa-github"></i></a
            ><a
              class="navbar-item is-hidden-tablet catalogue"
              title="目录"
              href="javascript:;"
              ><i class="fas fa-list-ul"></i></a
            ><a class="navbar-item search" title="搜索" href="javascript:;"
              ><i class="fas fa-search"></i
            ></a>
          </div>
        </div>
      </div>
    </nav>
    <section class="section">
      <div class="container">
        <div class="columns">
          <div
            class="column order-2 column-main is-8-tablet is-8-desktop is-10-widescreen"
          >
            <div class="card">
              <article class="card-content article" role="article">
                <div
                  class="article-meta is-size-7 is-uppercase level is-mobile"
                >
                  <div class="level-left">
                    <span class="level-item"
                      ><time
                        datetime="2021-11-02T03:17:56.000Z"
                        title="2021/11/2 上午11:17:56"
                        >2021-11-02</time
                      >发表</span
                    ><span class="level-item"
                      ><time
                        datetime="2022-04-24T03:21:21.447Z"
                        title="2022/4/24 上午11:21:21"
                        >2022-04-24</time
                      >更新</span
                    ><span class="level-item"
                      ><a class="link-muted" href="/categories/SOFA/"
                        >SOFA</a
                      ></span
                    ><span class="level-item">23 分钟读完 (大约3509个字)</span
                    ><span class="level-item" id="busuanzi_container_page_pv"
                      ><span id="busuanzi_value_page_pv">0</span>次访问</span
                    >
                  </div>
                </div>
                <h1 class="title is-3 is-size-4-mobile">
                  finalize 方法重写对 GC 的影响分析
                </h1>
                <div class="content">
                  <p>
                    关于 Object 的 finalize 方法，在日常开发中可能有超过 99%
                    的人都没有关注过，因为业务开发很少有重写 finalize
                    方法的场景；开发者对于 finalize
                    的认知大多在是“面试八股文”中，而且也不乏见到将
                    finalize、finally 以及 final 放在一块比较的
                    case，面试官可能是出于对初学者 java
                    基本语言知识的考量，但是这真的有意义吗？
                  </p>
                  <span id="more"></span>

                  <p>
                    本文将用一个非常简单的 case 来直观的看下，finalize
                    方法重写带来的影响。
                  </p>
                  <h2 id="finalize-方法是什么">
                    <a
                      href="#finalize-方法是什么"
                      class="headerlink"
                      title="finalize 方法是什么"
                    ></a
                    >finalize 方法是什么
                  </h2>
                  <p>下面我们直接来看下 finalize 的代码注释。</p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">* Called by the garbage collector on an object when garbage collection</span><br><span class="line">* determines that there are no more references to the object.</span><br><span class="line">* A subclass overrides the &#123;@code finalize&#125; method to dispose of</span><br><span class="line">* system resources or to perform other cleanup.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    finalize 是 java 的顶级父类 Object 中的一些方法，默认情况下
                    finalize
                    方法是空实现；其调时机是：当前对象没有任何引用时，执行 GC
                    时被调用。子类可以重写了 finalize
                    方法去释放系统资源或执行其他清理。
                  </p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">* The general contract of &#123;@code finalize&#125; is that it is invoked</span><br><span class="line">* if and when the Java&amp;trade; virtual</span><br><span class="line">* machine has determined that there is no longer any</span><br><span class="line">* means by which this object can be accessed by any thread that has</span><br><span class="line">* not yet died, except as a result of an action taken by the</span><br><span class="line">* finalization of some other object or class which is ready to be</span><br><span class="line">* finalized. The &#123;@code finalize&#125; method may take any action, including</span><br><span class="line">* making this object available again to other threads; the usual purpose</span><br><span class="line">* of &#123;@code finalize&#125;, however, is to perform cleanup actions before</span><br><span class="line">* the object is irrevocably discarded. For example, the finalize method</span><br><span class="line">* for an object that represents an input/output connection might perform</span><br><span class="line">* explicit I/O transactions to break the connection before the object is</span><br><span class="line">* permanently discarded.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    finalizer 方法的调用时机由 JavaTM
                    开发商决定：简单说就是要确定对象的任何方法都不（再）会被调用时，再调用其
                    finalize
                    方法。除非一些其他的已经准备好被终止的对象或类将调用
                    finalize 方法，包括在其终止动作之中（即调用对象的 finalize
                    方法，此时该对象的 finalize
                    方法将是最后被调用的方法，在这之后，对象的任何方法都不（再）会被调用。finalize
                    方法中可以执行任何操作，包括再次使该对象可用于其它线程（重新初始化）；但是
                    finalize
                    的通常目的是在对象（一定）不再被需要时（对象将被丢弃）之前执行清除操作。例如，表示input&#x2F;output
                    连接的对象的 finalize 方法可能会在对象被永久丢弃之前执行显式
                    I&#x2F;O 事务来中断连接。
                  </p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">* The Java programming language does not guarantee which thread will</span><br><span class="line">* invoke the &#123;@code finalize&#125; method for any given object. It is</span><br><span class="line">* guaranteed, however, that the thread that invokes finalize will not</span><br><span class="line">* be holding any user-visible synchronization locks when finalize is</span><br><span class="line">* invoked. If an uncaught exception is thrown by the finalize method,</span><br><span class="line">* the exception is ignored and finalization of that object terminates.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    java 语言不对任何对象的 finalize
                    方法调用发生的线程做限制，即任何线程都可以调用对象的
                    finalize 方法，然而，调用 finalize
                    方法的线程将不能持有任何用户可见的线程同步锁。当 finalize
                    方法被调用时，如果 finalize
                    方法抛出异常，且异常未被捕获时，异常将被忽略，finalize
                    方法将中止。
                  </p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">* After the &#123;@code finalize&#125; method has been invoked for an object, no</span><br><span class="line">* further action is taken until the Java virtual machine has again</span><br><span class="line">* determined that there is no longer any means by which this object can</span><br><span class="line">* be accessed by any thread that has not yet died, including possible</span><br><span class="line">* actions by other objects or classes which are ready to be finalized,</span><br><span class="line">* at which point the object may be discarded.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    当对象的 finalize
                    方法被调用后，不会再有基于该对象的方法调用，直到 JVM
                    再次进行回收动作时该对象将被释放，占用的内存将被回收。
                  </p>
                  <p>
                    另外，任何对象的 finalize 方法只会被 JVM
                    调用一次。finalize（）方法引发的任何异常都会导致该对象的终止被暂停，否则被忽略。
                  </p>
                  <h2 id="finalize-方法重写对-GC-的影响">
                    <a
                      href="#finalize-方法重写对-GC-的影响"
                      class="headerlink"
                      title="finalize 方法重写对 GC 的影响"
                    ></a
                    >finalize 方法重写对 GC 的影响
                  </h2>
                  <p>
                    这里丢一个简单的例子，TestMain 类重写了 finalize
                    方法，并且在 finalize 方法中已创建的对象总数 COUNT
                    做减操作，并且没隔 100000 次输出下当前 COUNT。
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">COUNT</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TestMain</span><span class="params">()</span> &#123;</span><br><span class="line">        COUNT.incrementAndGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写 finalize 方法测试</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        COUNT.decrementAndGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ;; i++) &#123;</span><br><span class="line">            <span class="type">TestMain</span> <span class="variable">item</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestMain</span>();</span><br><span class="line">            <span class="keyword">if</span> ((i % <span class="number">100000</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.format(<span class="string">&quot;creating %d objects, current %d are alive.%n&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123;i, COUNT.get() &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>运行环境：MacOS 10.14.6</p>
                  <p>
                    JVM 参数：-XX:+PrintGCDetails -Xms200M -Xmx200M -Xmn100M
                  </p>
                  <p>执行这段代码，可以在控制台观察，会出现以下几个阶段:</p>
                  <h3 id="阶段一：第一次执行-GC-的时候">
                    <a
                      href="#阶段一：第一次执行-GC-的时候"
                      class="headerlink"
                      title="阶段一：第一次执行 GC 的时候"
                    ></a
                    >阶段一：第一次执行 GC 的时候
                  </h3>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">creating 0 objects, current 1 are alive.</span><br><span class="line">creating 100000 objects, current 100001 are alive.</span><br><span class="line">creating 200000 objects, current 200001 are alive.</span><br><span class="line">creating 300000 objects, current 300001 are alive.</span><br><span class="line">creating 400000 objects, current 400001 are alive.</span><br><span class="line">creating 500000 objects, current 500001 are alive.</span><br><span class="line">creating 600000 objects, current 600001 are alive.</span><br><span class="line">creating 700000 objects, current 700001 are alive.</span><br><span class="line">creating 800000 objects, current 800001 are alive.</span><br><span class="line">creating 900000 objects, current 900001 are alive.</span><br><span class="line">creating 1000000 objects, current 1000001 are alive.</span><br><span class="line">creating 1100000 objects, current 1100001 are alive.</span><br><span class="line">creating 1200000 objects, current 1200001 are alive.</span><br><span class="line">// ygc 失败，下面直接进行 fgc 了</span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 76800K-&gt;12800K(89600K)] 76800K-&gt;71066K(192000K), 0.3839994 secs] [Times: user=1.87 sys=0.07, real=0.38 secs] </span><br><span class="line">// 执行 fgc</span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 12800K-&gt;0K(89600K)] [ParOldGen: 58266K-&gt;70801K(102400K)] 71066K-&gt;70801K(192000K), [Metaspace: 3696K-&gt;3696K(1056768K)], 1.3266229 secs] [Times: user=4.89 sys=0.17, real=1.33 secs]</span><br><span class="line">creating 1300000 objects, current 1296221 are alive.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>看下 GC 之后，COUNT 中统计的存活的对象数还是有很多。</p>
                  <h3 id="阶段二：频繁-fgc">
                    <a
                      href="#阶段二：频繁-fgc"
                      class="headerlink"
                      title="阶段二：频繁 fgc"
                    ></a
                    >阶段二：频繁 fgc
                  </h3>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">creating 3200000 objects, current 3132405 are alive.</span><br><span class="line">creating 3300000 objects, current 3230808 are alive.</span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;75818K(89600K)] [ParOldGen: 102171K-&gt;102028K(102400K)] 178971K-&gt;177846K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.8383374 secs] [Times: user=4.93 sys=0.09, real=0.84 secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76768K(89600K)] [ParOldGen: 102028K-&gt;102028K(102400K)] 178828K-&gt;178797K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.3276008 secs] [Times: user=2.24 sys=0.01, real=0.33 secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76784K(89600K)] [ParOldGen: 102028K-&gt;102028K(102400K)] 178828K-&gt;178813K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.2876044 secs] [Times: user=1.74 sys=0.03, real=0.29 secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76775K(89600K)] [ParOldGen: 102028K-&gt;102028K(102400K)] 178828K-&gt;178803K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.2761930 secs] [Times: user=1.74 sys=0.02, real=0.28 secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76778K(89600K)] [ParOldGen: 102028K-&gt;102028K(102400K)] 178828K-&gt;178806K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.3522859 secs] [Times: user=1.67 sys=0.02, real=0.35 secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76786K(89600K)] [ParOldGen: 102028K-&gt;102028K(102400K)] 178828K-&gt;178814K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.2609472 secs] [Times: user=1.36 sys=0.02, real=0.26 secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76793K(89600K)] [ParOldGen: 102028K-&gt;102028K(102400K)] 178828K-&gt;178821K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.2691448 secs] [Times: user=1.28 sys=0.01, real=0.27 secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76787K(89600K)] [ParOldGen: 102028K-&gt;102028K(102400K)] 178828K-&gt;178816K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.2254074 secs] [Times: user=1.37 sys=0.01, real=0.22 secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76779K(89600K)] [ParOldGen: 102028K-&gt;102028K(102400K)] 178828K-&gt;178808K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.2670959 secs] [Times: user=1.77 sys=0.02, real=0.27 secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76778K(89600K)] [ParOldGen: 102028K-&gt;102028K(102400K)] 178828K-&gt;178807K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.2704234 secs] [Times: user=1.71 sys=0.02, real=0.27 secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76785K(89600K)] [ParOldGen: 102028K-&gt;102028K(102400K)] 178828K-&gt;178813K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.3302090 secs] [Times: user=1.84 sys=0.02, real=0.33 secs] </span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    差不多在 330 万次时，就开始持续有 fgc
                    的情况了；可以看到各个数据区都被占满了。
                  </p>
                  <h3 id="阶段三：OOM">
                    <a
                      href="#阶段三：OOM"
                      class="headerlink"
                      title="阶段三：OOM"
                    ></a
                    >阶段三：OOM
                  </h3>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[Full GC (Ergonomics) [PSYoungGen: 76800K-&gt;76784K(89600K)] [ParOldGen: 102028K-&gt;101994K(102400K)] 178828K-&gt;178778K(192000K), [Metaspace: 3716K-&gt;3716K(1056768K)], 0.4323213 secs] [Times: user=2.13 sys=0.04, real=0.43 secs] </span><br><span class="line">[Full GC (Ergonomics) Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: GC overhead limit exceeded</span><br><span class="line">[PSYoungGen: 76799K-&gt;76697K(89600K)] [ParOldGen: 101994K-&gt;101994K(102400K)] 178793K-&gt;178691K(192000K), [Metaspace: 3720K-&gt;3720K(1056768K)], 0.3325707 secs] [Times: user=1.70 sys=0.02, real=0.33 secs] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 89600K, used 76800K [0x00000007b9c00000, 0x00000007c0000000, 0x00000007c0000000)</span><br><span class="line">  eden space 76800K, 100% used [0x00000007b9c00000,0x00000007be700000,0x00000007be700000)</span><br><span class="line">  from space 12800K, 0% used [0x00000007be700000,0x00000007be700000,0x00000007bf380000)</span><br><span class="line">  to   space 12800K, 0% used [0x00000007bf380000,0x00000007bf380000,0x00000007c0000000)</span><br><span class="line"> ParOldGen       total 102400K, used 101994K [0x00000007b3800000, 0x00000007b9c00000, 0x00000007b9c00000)</span><br><span class="line">  object space 102400K, 99% used [0x00000007b3800000,0x00000007b9b9a8e0,0x00000007b9c00000)</span><br><span class="line"> Metaspace       used 3751K, capacity 4670K, committed 4864K, reserved 1056768K</span><br><span class="line">  class space    used 404K, capacity 434K, committed 512K, reserved 1048576K</span><br><span class="line">	at java.lang.ref.Finalizer.register(Finalizer.java:87)</span><br><span class="line">	at java.lang.Object.&lt;init&gt;(Object.java:37)</span><br><span class="line">	at com.glmapper.bridge.boot.finalize.TestMain.&lt;init&gt;(TestMain.java:13)</span><br><span class="line">	at com.glmapper.bridge.boot.finalize.TestMain.main(TestMain.java:28)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    在创建了 330 万个对象后就抛出 java.lang.OutOfMemoryError: GC
                    overhead limitt exceeded
                    异常退出了。从我工程测试日志中看到，基本全都都是
                    fgc（只有一次
                    ygc），从代码看，这些对象并没有什么特殊，代码层面也没有引用，但是
                    JVM 就直接使用代价更高的 Full GC
                    来清理老生代和持久代的空间了。所以 why ?
                  </p>
                  <p>
                    那作为对比，我们把代码中重写 finalize
                    的代码逻辑去掉再跑一次：
                  </p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">creating 111000000 objects </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 99328K-&gt;0K(100864K)] 100161K-&gt;833K(203264K), 0.0008235 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">creating 112000000 objects </span><br><span class="line">creating 113000000 objects </span><br><span class="line">creating 114000000 objects </span><br><span class="line">creating 115000000 objects </span><br><span class="line">creating 116000000 objects </span><br><span class="line">creating 117000000 objects </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 99328K-&gt;0K(100864K)] 100161K-&gt;833K(203264K), 0.0005181 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] </span><br><span class="line">creating 118000000 objects </span><br><span class="line">creating 119000000 objects </span><br><span class="line">creating 120000000 objects </span><br><span class="line">creating 121000000 objects </span><br><span class="line">creating 122000000 objects </span><br><span class="line">creating 123000000 objects </span><br><span class="line">creating 124000000 objects </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 99328K-&gt;0K(100864K)] 100161K-&gt;833K(203264K), 0.0004161 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">creating 125000000 objects </span><br><span class="line">creating 126000000 objects </span><br><span class="line">creating 127000000 objects </span><br><span class="line">creating 128000000 objects </span><br><span class="line">creating 129000000 objects </span><br><span class="line">creating 130000000 objects </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 99328K-&gt;32K(101376K)] 100161K-&gt;865K(203776K), 0.0004908 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">creating 131000000 objects </span><br><span class="line">creating 132000000 objects </span><br><span class="line">creating 133000000 objects </span><br><span class="line">creating 134000000 objects </span><br><span class="line">creating 135000000 objects </span><br><span class="line">creating 136000000 objects</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    可以看到，在创建 13600 万对象时仍然可以继续跑，并且通过 GC
                    日志看，也只有 ygc , 没有一次 fgc。所以这个和重写 finalize
                    时的差距还是非常大的。那么下面就来分析下具体原因。
                  </p>
                  <h2 id="GC-影响分析">
                    <a
                      href="#GC-影响分析"
                      class="headerlink"
                      title="GC 影响分析"
                    ></a
                    >GC 影响分析
                  </h2>
                  <p>
                    这里思路很简单，首先我们要知道是什么对象导致了
                    OOM，要找出来。
                  </p>
                  <h3 id="找到占用空间的元凶">
                    <a
                      href="#找到占用空间的元凶"
                      class="headerlink"
                      title="找到占用空间的元凶"
                    ></a
                    >找到占用空间的元凶
                  </h3>
                  <p>
                    在启动参数中加上 -XX:+HeapDumpOnOutOfMemoryError
                    参数，重新执行一次，在出现 OOM 时会执行一次 heap dump
                  </p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">java.lang.OutOfMemoryError: GC overhead limit exceeded</span><br><span class="line">Dumping heap to java_pid88685.hprof ...</span><br><span class="line">Heap dump file created [320504328 bytes in 3.050 secs]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    通过分析工具（我使用的是 Jprofile 2）,看到都是 Finalizer
                    这个类的对象实例
                  </p>
                  <p>
                    <img
                      src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/367ff72d7c504747be0173841e1d4cab~tplv-k3u1fbpfcp-zoom-1.image"
                    />
                  </p>
                  <p>
                    在我的测试代码中，非常明确没有创建 Finalizer
                    对象的逻辑，那为什么会有这么多 Finalizer
                    对象实例呢？其实从上面 OOM 堆栈那里已经可以看出些端倪了：
                  </p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">class space    used 404K, capacity 434K, committed 512K, reserved 1048576K</span><br><span class="line">	at java.lang.ref.Finalizer.register(Finalizer.java:87)</span><br><span class="line">    at java.lang.Object.&lt;init&gt;(Object.java:37)</span><br><span class="line">    at com.glmapper.bridge.boot.finalize.TestMain.&lt;init&gt;(TestMain.java:13)</span><br><span class="line">    at com.glmapper.bridge.boot.finalize.TestMain.main(TestMain.java:28)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    在堆栈中看到了 Finalizer.register
                    这样一个方法执行，把断点打在这里：
                  </p>
                  <p>
                    <img
                      src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4bea36e8c1604a7b90a39968b38185b2~tplv-k3u1fbpfcp-zoom-1.image"
                    />
                  </p>
                  <p>
                    对于重写 finalize 方法的类，在创建其实例时，会同时创建一个
                    Finalizer 实例，这些所有的 Finalizer 实例又会为 Finalizer
                    类所引用，由于存在这么一个引用链关系存在，所以整个的这些对象都是存活的；所以当
                    Eden
                    区满了之后，此时所有的对象还是存活的，所以并不会被回收掉，继而只能将他们进一步放到
                    Suvivor 区去，但是由于这些对象不会被释放，引用一直存在，所以
                    Suvivor
                    区也很快被占满，既然这些对象被放到老年代，直到存入元数据空间，最后
                    OOM；所以前面提到的，不是 JVM 不使用 ygc
                    ，而是基于既定规则下，ygc
                    并不能将这些存活的对象回收掉。关于引用链通过 Jprofile
                    也可以直观的得到结论
                  </p>
                  <p>
                    <img
                      src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/151002a959944a4a9aa11816da88bf18~tplv-k3u1fbpfcp-zoom-1.image"
                    />
                  </p>
                  <h3 id="如何被回收的？">
                    <a
                      href="#如何被回收的？"
                      class="headerlink"
                      title="如何被回收的？"
                    ></a
                    >如何被回收的？
                  </h3>
                  <p>
                    那是不是就一直没法被回收呢？其实也不是，我们看到在执行了 fgc
                    之后，还是有一些对象被回收掉的。那就是说，这些被引用的对象，还是有可能被释放的；那其实就看这个对象什么时候从下面这个队列中被弹出。
                  </p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">private static ReferenceQueue&lt;Object&gt; queue = new ReferenceQueue&lt;&gt;();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    被弹出的对象在下一次 GC
                    的时候就会被认为已经没有任何引用从而被回收掉。
                  </p>
                  <h3 id="Finalizer-线程-FinalizerThread">
                    <a
                      href="#Finalizer-线程-FinalizerThread"
                      class="headerlink"
                      title="Finalizer 线程: FinalizerThread"
                    ></a
                    >Finalizer 线程: FinalizerThread
                  </h3>
                  <p>
                    FinalizerThread 的职责非常简单，就是不停的循环等待
                    ReferenceQueue 中的新增对象，然后弹出这个对象，调用它的
                    finalize() 方法，将该引用从 Finalizer 类中移除，因此下次 GC
                    再执行的时候，这个 Finalizer
                    实例以及它引用的那个对象就可以回垃圾回收掉了。
                  </p>
                  <p>
                    finalize()
                    方法的调用会比你创建新对象要早得多，因此大多数时候，Finalizer
                    线程能够赶在下次 GC 带来更多的 Finalizer
                    对象前清空这个队列。
                  </p>
                  <p>
                    既然如此，那为什么会出现 OOM 呢？因为 Finalizer
                    线程和主线程相比它的优先级要低。这意味着分配给它的CPU
                    时间更少，因此它的处理速度没法赶上新对象创建的速度。这就是问题的根源——对象创建的速度要比Finalizer
                    线程调用 finalize()
                    结束它们的速度要快，这导致最后堆中所有可用的空间都被耗尽了，结果就出现了
                    OOM 这种情况。（PS: 案例代码在一直循环创建新的对象）
                  </p>
                  <h2 id="总结">
                    <a href="#总结" class="headerlink" title="总结"></a>总结
                  </h2>
                  <p>
                    通过上面的 case 和分析，可以知道，对于重写了 finalize
                    的类，其对象的生命周期和普通对象的生命周期是完全不一样的。对于重写了
                    finalize 的类，其生命周期大致如下：
                  </p>
                  <ul>
                    <li>JVM 创建 TestMain 对象</li>
                    <li>JVM 创建一个 Finalizer 对象，指向 TestMain 对象</li>
                  </ul>
                  <!---->

                  <ul>
                    <li>
                      Finalizer 类持有新创建的 Finalizer
                      的实例，使得下一次新生代 GC 无法回收这些对象
                    </li>
                    <li>
                      新生代 GC 无法清空 Eden
                      区（引用被持有了），因此会将这些对象移到 Survivor
                      区或者老生代
                    </li>
                  </ul>
                  <!---->

                  <ul>
                    <li>
                      垃圾回收器发现这些对象实现了finalize()
                      方法，因为会把它们添加到 ReferenceQueue 队列中
                    </li>
                    <li>
                      FinalizerThread 处理 ReferenceQueue
                      队列，将里面的对象逐个弹出，并调用它们的 finalize() 方法
                    </li>
                  </ul>
                  <!---->

                  <ul>
                    <li>
                      finalize() 方法调用完后，FinalizerThread 会将引用从
                      Finalizer 类中去掉，因此在下一轮 GC
                      中，这些对象就可以被回收了
                    </li>
                  </ul>
                  <p>
                    所以，如果你有使用 finalize()
                    方法的情况，如果不是使用常规的方式来清理对象的话，最好是多考虑一下。
                  </p>
                </div>
                <div class="article-licensing box">
                  <div class="licensing-title">
                    <p>finalize 方法重写对 GC 的影响分析</p>
                    <p>
                      <a
                        href="http://www.glmapper.com/2021/11/02/java/java-advance-gc-finalize/"
                        >http://www.glmapper.com/2021/11/02/java/java-advance-gc-finalize/</a
                      >
                    </p>
                  </div>
                  <div class="licensing-meta level is-mobile">
                    <div class="level-left">
                      <div class="level-item is-narrow">
                        <div>
                          <h6>作者</h6>
                          <p>J.Queue</p>
                        </div>
                      </div>
                      <div class="level-item is-narrow">
                        <div>
                          <h6>发布于</h6>
                          <p>2021-11-02</p>
                        </div>
                      </div>
                      <div class="level-item is-narrow">
                        <div>
                          <h6>更新于</h6>
                          <p>2022-04-24</p>
                        </div>
                      </div>
                      <div class="level-item is-narrow">
                        <div>
                          <h6>许可协议</h6>
                          <p>
                            <a
                              class="icons"
                              rel="noopener"
                              target="_blank"
                              title="Creative Commons"
                              href="https://creativecommons.org/"
                              ><i class="icon fab fa-creative-commons"></i
                            ></a>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="article-tags is-size-7 mb-4">
                  <span class="mr-2">#</span
                  ><a class="link-muted mr-2" rel="tag" href="/tags/SOFAArk/"
                    >SOFAArk</a
                  ><a
                    class="link-muted mr-2"
                    rel="tag"
                    href="/tags/ClassLoader/"
                    >ClassLoader</a
                  ><a class="link-muted mr-2" rel="tag" href="/tags/gc/">gc</a>
                </div>
                <!--!-->
              </article>
            </div>
            <div class="card">
              <div class="card-content">
                <h3 class="menu-label has-text-centered">
                  喜欢这篇文章？打赏一下作者吧
                </h3>
                <div class="buttons is-centered">
                  <a class="button donate" data-type="alipay"
                    ><span class="icon is-small"
                      ><i class="fab fa-alipay"></i></span
                    ><span>支付宝</span
                    ><span class="qrcode"
                      ><img src="/img/zfb.JPG" alt="支付宝" /></span></a
                  ><a class="button donate" data-type="wechat"
                    ><span class="icon is-small"
                      ><i class="fab fa-weixin"></i></span
                    ><span>微信</span
                    ><span class="qrcode"
                      ><img src="/img/pay.JPG" alt="微信" /></span
                  ></a>
                </div>
              </div>
            </div>
            <nav class="post-navigation mt-4 level is-mobile">
              <div class="level-start">
                <a
                  class="article-nav-prev level level-item link-muted"
                  href="/2021/11/05/jvm/jvm-openjdk-oop-klass/"
                  ><i class="level-item fas fa-chevron-left"></i
                  ><span class="level-item">JVM-Java 对象模型</span></a
                >
              </div>
              <div class="level-end">
                <a
                  class="article-nav-next level level-item link-muted"
                  href="/2021/11/01/sofa/sofa-ark-plugin-classloader-log4j/"
                  ><span class="level-item"
                    >log4j2 日志 PatternLayout 配置对 SOFAArk PluginClassLoader
                    的影响</span
                  ><i class="level-item fas fa-chevron-right"></i
                ></a>
              </div>
            </nav>
            <div class="card">
              <div class="card-content">
                <h3 class="title is-5">评论</h3>
                <div id="comment-container"></div>
                <link
                  rel="stylesheet"
                  href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"
                />
                <script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
                <script>
                  var gitalk = new Gitalk({
                    id: 'b9260431c8fcf9d4a49a6f820ed0f976',
                    repo: 'glmapper.github.io',
                    owner: 'glmapper',
                    clientID: 'd25147ddf77e70d7adfe',
                    clientSecret: 'c10bbd1ba7a09c96e4106709107d4da85d60be78',
                    admin: ['glmapper'],
                    createIssueManually: false,
                    distractionFreeMode: true,
                    perPage: 20,
                    pagerDirection: 'last',

                    enableHotKey: true,
                    language: 'zh-CN',
                  })
                  gitalk.render('comment-container')
                </script>
              </div>
            </div>
          </div>
          <div
            class="column column-left is-4-tablet is-4-desktop is-3-widescreen order-1 is-sticky"
          >
            <div class="card widget" data-type="profile">
              <div class="card-content">
                <nav class="level">
                  <div class="level-item has-text-centered flex-shrink-1">
                    <div>
                      <figure class="image is-128x128 mx-auto mb-2">
                        <img
                          class="avatar is-rounded"
                          src="/img/self.jpg"
                          alt="J.Queue"
                        />
                      </figure>
                      <p
                        class="title is-size-4 is-block"
                        style="line-height: inherit"
                      >
                        J.Queue
                      </p>
                      <p class="is-size-6 is-block">Java Developer</p>
                      <p class="is-size-6 is-flex justify-content-center">
                        <i class="fas fa-map-marker-alt mr-1"></i
                        ><span>HeFei AnHui</span>
                      </p>
                    </div>
                  </div>
                </nav>
                <nav class="level is-mobile">
                  <div class="level-item has-text-centered is-marginless">
                    <div>
                      <p class="heading">文章</p>
                      <a href="/archives"><p class="title">108</p></a>
                    </div>
                  </div>
                  <div class="level-item has-text-centered is-marginless">
                    <div>
                      <p class="heading">分类</p>
                      <a href="/categories"><p class="title">17</p></a>
                    </div>
                  </div>
                  <div class="level-item has-text-centered is-marginless">
                    <div>
                      <p class="heading">标签</p>
                      <a href="/tags"><p class="title">128</p></a>
                    </div>
                  </div>
                </nav>
                <div class="level">
                  <a
                    class="level-item button is-primary is-rounded"
                    href="https://github.com/glmapper"
                    target="_blank"
                    rel="noopener"
                    >关注我</a
                  >
                </div>
                <div class="level is-mobile is-multiline">
                  <a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="Github"
                    href="https://github.com/glmapper"
                    ><i class="fab fa-github"></i></a
                  ><a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="Twitter"
                    href="https://twitter.com"
                    ><i class="fab fa-twitter"></i></a
                  ><a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="weibo"
                    href="https://weibo.com/u/2412872703"
                    ><i class="fab fa-weibo"></i></a
                  ><a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="RSS"
                    href="/atom.xml"
                    ><i class="fas fa-rss"></i
                  ></a>
                </div>
              </div>
            </div>
            <div class="card widget" data-type="links">
              <div class="card-content">
                <div class="menu">
                  <h3 class="menu-label">链接</h3>
                  <ul class="menu-list">
                    <li>
                      <a
                        class="level is-mobile"
                        href="https://juejin.cn/user/3227821827961806"
                        target="_blank"
                        rel="noopener"
                        ><span class="level-left"
                          ><span class="level-item">掘金社区</span></span
                        ><span class="level-right"
                          ><span class="level-item tag">juejin.cn</span></span
                        ></a
                      >
                    </li>
                    <li>
                      <a
                        class="level is-mobile"
                        href="https://www.sofastack.tech/"
                        target="_blank"
                        rel="noopener"
                        ><span class="level-left"
                          ><span class="level-item">SOFAStack</span></span
                        ><span class="level-right"
                          ><span class="level-item tag"
                            >www.sofastack.tech</span
                          ></span
                        ></a
                      >
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="card widget" id="toc" data-type="toc">
              <div class="card-content">
                <div class="menu">
                  <h3 class="menu-label">目录</h3>
                  <ul class="menu-list">
                    <li>
                      <a class="level is-mobile" href="#finalize-方法是什么"
                        ><span class="level-left"
                          ><span class="level-item">1</span
                          ><span class="level-item"
                            >finalize 方法是什么</span
                          ></span
                        ></a
                      >
                    </li>
                    <li>
                      <a
                        class="level is-mobile"
                        href="#finalize-方法重写对-GC-的影响"
                        ><span class="level-left"
                          ><span class="level-item">2</span
                          ><span class="level-item"
                            >finalize 方法重写对 GC 的影响</span
                          ></span
                        ></a
                      >
                      <ul class="menu-list">
                        <li>
                          <a
                            class="level is-mobile"
                            href="#阶段一：第一次执行-GC-的时候"
                            ><span class="level-left"
                              ><span class="level-item">2.1</span
                              ><span class="level-item"
                                >阶段一：第一次执行 GC 的时候</span
                              ></span
                            ></a
                          >
                        </li>
                        <li>
                          <a class="level is-mobile" href="#阶段二：频繁-fgc"
                            ><span class="level-left"
                              ><span class="level-item">2.2</span
                              ><span class="level-item"
                                >阶段二：频繁 fgc</span
                              ></span
                            ></a
                          >
                        </li>
                        <li>
                          <a class="level is-mobile" href="#阶段三：OOM"
                            ><span class="level-left"
                              ><span class="level-item">2.3</span
                              ><span class="level-item">阶段三：OOM</span></span
                            ></a
                          >
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a class="level is-mobile" href="#GC-影响分析"
                        ><span class="level-left"
                          ><span class="level-item">3</span
                          ><span class="level-item">GC 影响分析</span></span
                        ></a
                      >
                      <ul class="menu-list">
                        <li>
                          <a class="level is-mobile" href="#找到占用空间的元凶"
                            ><span class="level-left"
                              ><span class="level-item">3.1</span
                              ><span class="level-item"
                                >找到占用空间的元凶</span
                              ></span
                            ></a
                          >
                        </li>
                        <li>
                          <a class="level is-mobile" href="#如何被回收的？"
                            ><span class="level-left"
                              ><span class="level-item">3.2</span
                              ><span class="level-item"
                                >如何被回收的？</span
                              ></span
                            ></a
                          >
                        </li>
                        <li>
                          <a
                            class="level is-mobile"
                            href="#Finalizer-线程-FinalizerThread"
                            ><span class="level-left"
                              ><span class="level-item">3.3</span
                              ><span class="level-item"
                                >Finalizer 线程: FinalizerThread</span
                              ></span
                            ></a
                          >
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a class="level is-mobile" href="#总结"
                        ><span class="level-left"
                          ><span class="level-item">4</span
                          ><span class="level-item">总结</span></span
                        ></a
                      >
                    </li>
                  </ul>
                </div>
              </div>
              <script src="/js/toc.js" defer></script>
            </div>
            <div class="card widget" data-type="tags">
              <div class="card-content">
                <div class="menu">
                  <h3 class="menu-label">标签</h3>
                  <div class="field is-grouped is-grouped-multiline">
                    <div class="control">
                      <a class="tags has-addons" href="/tags/BeanDefinition/"
                        ><span class="tag">BeanDefinition</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/BeanPostProcessor/"
                        ><span class="tag">BeanPostProcessor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/BeanWrapper/"
                        ><span class="tag">BeanWrapper</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/CAS/"
                        ><span class="tag">CAS</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ClassLoader/"
                        ><span class="tag">ClassLoader</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/CopyOnWriteArraySet/"
                        ><span class="tag">CopyOnWriteArraySet</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Disruptor/"
                        ><span class="tag">Disruptor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Embedded-Tomcat/"
                        ><span class="tag">Embedded Tomcat</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Exception/"
                        ><span class="tag">Exception</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Executor/"
                        ><span class="tag">Executor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/FX-Application/"
                        ><span class="tag">FX Application</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/FatJar/"
                        ><span class="tag">FatJar</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Ioc/"
                        ><span class="tag">Ioc</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/JAR/"
                        ><span class="tag">JAR</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/JDK/"
                        ><span class="tag">JDK</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/JUC/"
                        ><span class="tag">JUC</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Kafka/"
                        ><span class="tag">Kafka</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/MANIFEST-MF/"
                        ><span class="tag">MANIFEST.MF</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Mockito/"
                        ><span class="tag">Mockito</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Mysql/"
                        ><span class="tag">Mysql</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/OOM/"
                        ><span class="tag">OOM</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/OpenTracing/"
                        ><span class="tag">OpenTracing</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/PropertySource/"
                        ><span class="tag">PropertySource</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Readiness-Check/"
                        ><span class="tag">Readiness Check</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ResourceLoader/"
                        ><span class="tag">ResourceLoader</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/RestTemplate/"
                        ><span class="tag">RestTemplate</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/RocketMQ/"
                        ><span class="tag">RocketMQ</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SOFA/"
                        ><span class="tag">SOFA</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SOFAArk/"
                        ><span class="tag">SOFAArk</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SOFAStack/"
                        ><span class="tag">SOFAStack</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SpringBoot/"
                        ><span class="tag">SpringBoot</span
                        ><span class="tag">16</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/TestDouble/"
                        ><span class="tag">TestDouble</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/ThreadPoolExecutor/"
                        ><span class="tag">ThreadPoolExecutor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Tracer/"
                        ><span class="tag">Tracer</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Zipkin/"
                        ><span class="tag">Zipkin</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ab-test/"
                        ><span class="tag">ab test</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/actuator/"
                        ><span class="tag">actuator</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/aop/"
                        ><span class="tag">aop</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/api/"
                        ><span class="tag">api</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/apollo/"
                        ><span class="tag">apollo</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/bean-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">bean 扩展机制</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"
                        ><span class="tag">bean 生命周期</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/bootstrap/"
                        ><span class="tag">bootstrap</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/cache/"
                        ><span class="tag">cache</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/classloader/"
                        ><span class="tag">classloader</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/config/"
                        ><span class="tag">config</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/cookie/"
                        ><span class="tag">cookie</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/curator/"
                        ><span class="tag">curator</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/docker/"
                        ><span class="tag">docker</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/eureka/"
                        ><span class="tag">eureka</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/event/"
                        ><span class="tag">event</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/feign/"
                        ><span class="tag">feign</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/gateway/"
                        ><span class="tag">gateway</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/gc/"
                        ><span class="tag">gc</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/git/"
                        ><span class="tag">git</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/github/"
                        ><span class="tag">github</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/guava/"
                        ><span class="tag">guava</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/http/"
                        ><span class="tag">http</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/hystrix/"
                        ><span class="tag">hystrix</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/java/"
                        ><span class="tag">java</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/junit/"
                        ><span class="tag">junit</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/jvm/"
                        ><span class="tag">jvm</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/kafka/"
                        ><span class="tag">kafka</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/linux/"
                        ><span class="tag">linux</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/lock/"
                        ><span class="tag">lock</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/log/"
                        ><span class="tag">log</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/logback/"
                        ><span class="tag">logback</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/maven/"
                        ><span class="tag">maven</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/maven-debug/"
                        ><span class="tag">maven debug</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/maven-plugin/"
                        ><span class="tag">maven plugin</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/merge/"
                        ><span class="tag">merge</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/microservices/"
                        ><span class="tag">microservices</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/mock/"
                        ><span class="tag">mock</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/mybatis/"
                        ><span class="tag">mybatis</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/mysql/"
                        ><span class="tag">mysql</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/nacos/"
                        ><span class="tag">nacos</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/namespace/"
                        ><span class="tag">namespace</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/netflix/"
                        ><span class="tag">netflix</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/nginx/"
                        ><span class="tag">nginx</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/oop-klass/"
                        ><span class="tag">oop-klass</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/reactor/"
                        ><span class="tag">reactor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/rebase/"
                        ><span class="tag">rebase</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/redis/"
                        ><span class="tag">redis</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/rpc/"
                        ><span class="tag">rpc</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/session/"
                        ><span class="tag">session</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/set/"
                        ><span class="tag">set</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/shell/"
                        ><span class="tag">shell</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/slf4j/"
                        ><span class="tag">slf4j</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/spring/"
                        ><span class="tag">spring</span
                        ><span class="tag">11</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/spring-cloud/"
                        ><span class="tag">spring cloud</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/spring-mvc/"
                        ><span class="tag">spring mvc</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/spring-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">spring 扩展机制</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/sql/"
                        ><span class="tag">sql</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ssh/"
                        ><span class="tag">ssh</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/starter-%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">starter 机制</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/test/"
                        ><span class="tag">test</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/testing/"
                        ><span class="tag">testing</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/thread/"
                        ><span class="tag">thread</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/tomcat/"
                        ><span class="tag">tomcat</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/top/"
                        ><span class="tag">top</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/typecheck/"
                        ><span class="tag">typecheck</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/yapi/"
                        ><span class="tag">yapi</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/yum/"
                        ><span class="tag">yum</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/zookeeper/"
                        ><span class="tag">zookeeper</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E4%B8%AD%E5%8F%B0/"
                        ><span class="tag">中台</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">事件机制</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"
                        ><span class="tag">依赖注入</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"
                        ><span class="tag">分布式</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"
                        ><span class="tag">分布式链路跟踪</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"
                        ><span class="tag">反向代理</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%8F%8D%E5%B0%84/"
                        ><span class="tag">反射</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%90%88%E8%82%A5/"
                        ><span class="tag">合肥</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"
                        ><span class="tag">并发编程</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"
                        ><span class="tag">微服务</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%9D%AD%E5%B7%9E/"
                        ><span class="tag">杭州</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%9E%B6%E6%9E%84/"
                        ><span class="tag">架构</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%A1%86%E6%9E%B6/"
                        ><span class="tag">框架</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%B3%9B%E5%9E%8B/"
                        ><span class="tag">泛型</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"
                        ><span class="tag">注册中心</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%B6%88%E6%81%AF/"
                        ><span class="tag">消息</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD/"
                        ><span class="tag">类加载</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"
                        ><span class="tag">线程池</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE/"
                        ><span class="tag">自动配置</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"
                        ><span class="tag">负载均衡</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%BF%90%E7%BB%B4/"
                        ><span class="tag">运维</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8/"
                        ><span class="tag">迭代器</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E9%85%8D%E7%BD%AE/"
                        ><span class="tag">配置</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E9%9B%86%E7%BE%A4%E9%80%89%E4%B8%BB/"
                        ><span class="tag">集群选主</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="column-right-shadow is-hidden-widescreen is-sticky"
            ></div>
          </div>
        </div>
      </div>
    </section>
    <footer class="footer">
      <div class="container">
        <div class="level">
          <div class="level-start">
            <a class="footer-logo is-block mb-2" href="/">J.Queue的技术博客</a>
            <p class="is-size-7">
              <span>&copy; 2022 J.Queue</span>  Powered by
              <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a
              > &amp; <a
                href="https://github.com/ppoffice/hexo-theme-icarus"
                target="_blank"
                rel="noopener"
                >Icarus</a
              ><br /><span id="busuanzi_container_site_uv"
                >共<span id="busuanzi_value_site_uv">0</span>个访客</span
              >
            </p>
          </div>
          <div class="level-end">
            <div class="field has-addons">
              <p class="control">
                <a
                  class="button is-transparent is-large"
                  target="_blank"
                  rel="noopener"
                  title="Download on GitHub"
                  href="https://github.com/glmapper"
                  ><i class="fab fa-github"></i
                ></a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
    <script>
      moment.locale('zh-CN')
    </script>
    <script>
      var IcarusThemeSettings = {
        article: {
          highlight: {
            clipboard: false,
            fold: '',
          },
        },
      }
    </script>
    <script src="/js/column.js"></script>
    <script src="/js/animation.js"></script>
    <a id="back-to-top" title="回到顶端" href="javascript:;"
      ><i class="fas fa-chevron-up"></i
    ></a>
    <script src="/js/back_to_top.js" defer></script>
    <!--!--><!--!--><!--!--><!--!-->
    <script
      src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"
      defer
    ></script>
    <script>
      window.addEventListener('load', () => {
        window.cookieconsent.initialise({
          type: 'info',
          theme: 'edgeless',
          static: false,
          position: 'bottom-left',
          content: {
            message: '此网站使用Cookie来改善您的体验。',
            dismiss: '知道了！',
            allow: '允许使用Cookie',
            deny: '拒绝',
            link: '了解更多',
            policy: 'Cookie政策',
            href: 'https://www.cookiesandyou.com/',
          },
          palette: {
            popup: {
              background: '#edeff5',
              text: '#838391',
            },
            button: {
              background: '#4b81e8',
            },
          },
        })
      })
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js"
      defer
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"
      defer
    ></script>
    <script>
      window.addEventListener('load', () => {
        if (typeof $.fn.lightGallery === 'function') {
          $('.article').lightGallery({ selector: '.gallery-item' })
        }
        if (typeof $.fn.justifiedGallery === 'function') {
          if ($('.justified-gallery > p > .gallery-item').length) {
            $('.justified-gallery > p > .gallery-item').unwrap()
          }
          $('.justified-gallery').justifiedGallery()
        }
      })
    </script>
    <!--!--><!--!--><!--!--><!--!--><!--!-->
    <script src="/js/main.js" defer></script>
    <div class="searchbox">
      <div class="searchbox-container">
        <div class="searchbox-header">
          <div class="searchbox-input-container">
            <input
              class="searchbox-input"
              type="text"
              placeholder="想要查找什么..."
            />
          </div>
          <a class="searchbox-close" href="javascript:;">×</a>
        </div>
        <div class="searchbox-body"></div>
      </div>
    </div>
    <script src="/js/insight.js" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        loadInsight(
          { contentUrl: '/content.json' },
          {
            hint: '想要查找什么...',
            untitled: '(无标题)',
            posts: '文章',
            pages: '页面',
            categories: '分类',
            tags: '标签',
          }
        )
      })
    </script>
  </body>
</html>
