<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta />
    <title>聊一聊 Mockito - J.Queue的技术博客</title>
    <link rel="manifest" href="/manifest.json" />
    <meta name="application-name" content="J.Queue的技术博客" />
    <meta name="msapplication-TileImage" content="/img/favicon.ico" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="J.Queue的技术博客" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta
      name="description"
      content="Mockito 是 mocking 框架，它让你用简洁的API做测试。而且 Mockito 简单易学，它可读性强和验证语法简洁。"
    />
    <meta property="og:type" content="blog" />
    <meta property="og:title" content="聊一聊 Mockito" />
    <meta
      property="og:url"
      content="http://sunknightzy.github.io/2021/11/06/tests/test-mock-mockito/"
    />
    <meta property="og:site_name" content="J.Queue的技术博客" />
    <meta
      property="og:description"
      content="Mockito 是 mocking 框架，它让你用简洁的API做测试。而且 Mockito 简单易学，它可读性强和验证语法简洁。"
    />
    <meta property="og:locale" content="zh_CN" />
    <meta
      property="og:image"
      content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f01c1cc1b5c04f128854f26ec5dcac91~tplv-k3u1fbpfcp-zoom-1.image"
    />
    <meta
      property="article:published_time"
      content="2021-11-06T03:26:33.000Z"
    />
    <meta property="article:modified_time" content="2022-04-24T03:29:36.816Z" />
    <meta property="article:author" content="J.Queue" />
    <meta property="article:tag" content="test" />
    <meta property="article:tag" content="mock" />
    <meta property="article:tag" content="Mockito" />
    <meta property="twitter:card" content="summary" />
    <meta
      property="twitter:image"
      content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f01c1cc1b5c04f128854f26ec5dcac91~tplv-k3u1fbpfcp-zoom-1.image"
    />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http://sunknightzy.github.io/2021/11/06/tests/test-mock-mockito/"
        },
        "headline": "聊一聊 Mockito",
        "image": [],
        "datePublished": "2021-11-06T03:26:33.000Z",
        "dateModified": "2022-04-24T03:29:36.816Z",
        "author": { "@type": "Person", "name": "J.Queue" },
        "publisher": {
          "@type": "Organization",
          "name": "J.Queue的技术博客",
          "logo": {
            "@type": "ImageObject",
            "url": { "text": "J.Queue的技术博客" }
          }
        },
        "description": "Mockito 是 mocking 框架，它让你用简洁的API做测试。而且 Mockito 简单易学，它可读性强和验证语法简洁。"
      }
    </script>
    <link
      rel="canonical"
      href="http://sunknightzy.github.io/2021/11/06/tests/test-mock-mockito/"
    />
    <link rel="icon" href="/img/favicon.ico" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/github.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"
    />
    <link rel="stylesheet" href="/css/default.css" />
    <style>
      body > .footer,
      body > .navbar,
      body > .section {
        opacity: 0;
      }
    </style>
    <!--!-->
    <!--!-->
    <!--!-->
    <script
      src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"
      defer
    ></script>
    <!--!-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"
    />
    <!--!-->
    <!--!-->
    <style>
      .pace {
        -webkit-pointer-events: none;
        pointer-events: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }
      .pace-inactive {
        display: none;
      }
      .pace .pace-progress {
        background: #3273dc;
        position: fixed;
        z-index: 2000;
        top: 0;
        right: 100%;
        width: 100%;
        height: 2px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script>
    <!--!-->
    <!--!-->
    <!-- hexo injector head_end start -->
    <script>
      ;(function () {
        function switchTab() {
          if (!location.hash) {
            return
          }
          Array.from(document.querySelectorAll('.tab-content')).forEach(
            ($tab) => {
              $tab.classList.add('is-hidden')
            }
          )
          Array.from(document.querySelectorAll('.tabs li')).forEach(($tab) => {
            $tab.classList.remove('is-active')
          })
          const $activeTab = document.querySelector(location.hash)
          if ($activeTab) {
            $activeTab.classList.remove('is-hidden')
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`)
          if ($tabMenu) {
            $tabMenu.parentElement.classList.add('is-active')
          }
        }
        switchTab()
        window.addEventListener('hashchange', switchTab, false)
      })()
    </script>
    <!-- hexo injector head_end end -->
    <meta name="generator" content="Hexo 6.1.0" />
    <link
      rel="alternate"
      href="/atom.xml"
      title="J.Queue的技术博客"
      type="application/atom+xml"
    />
  </head>
  <body class="is-3-column">
    <nav class="navbar navbar-main">
      <div class="container navbar-container">
        <div class="navbar-brand justify-content-center">
          <a class="navbar-item navbar-logo" href="/">J.Queue的技术博客</a>
        </div>
        <div class="navbar-menu">
          <div class="navbar-start">
            <a class="navbar-item" href="/">首页</a
            ><a class="navbar-item" href="/archives">归档</a
            ><a class="navbar-item" href="/categories">分类</a
            ><a class="navbar-item" href="/tags">Tags</a
            ><a class="navbar-item" href="/about">关于</a>
          </div>
          <div class="navbar-end">
            <a
              class="navbar-item"
              target="_blank"
              rel="noopener"
              title="Download on GitHub"
              href="https://github.com/glmapper"
              ><i class="fab fa-github"></i></a
            ><a
              class="navbar-item is-hidden-tablet catalogue"
              title="目录"
              href="javascript:;"
              ><i class="fas fa-list-ul"></i></a
            ><a class="navbar-item search" title="搜索" href="javascript:;"
              ><i class="fas fa-search"></i
            ></a>
          </div>
        </div>
      </div>
    </nav>
    <section class="section">
      <div class="container">
        <div class="columns">
          <div
            class="column order-2 column-main is-8-tablet is-8-desktop is-10-widescreen"
          >
            <div class="card">
              <article class="card-content article" role="article">
                <div
                  class="article-meta is-size-7 is-uppercase level is-mobile"
                >
                  <div class="level-left">
                    <span class="level-item"
                      ><time
                        datetime="2021-11-06T03:26:33.000Z"
                        title="2021/11/6 上午11:26:33"
                        >2021-11-06</time
                      >发表</span
                    ><span class="level-item"
                      ><time
                        datetime="2022-04-24T03:29:36.816Z"
                        title="2022/4/24 上午11:29:36"
                        >2022-04-24</time
                      >更新</span
                    ><span class="level-item"
                      ><a class="link-muted" href="/categories/test/"
                        >test</a
                      ></span
                    ><span class="level-item">22 分钟读完 (大约3232个字)</span
                    ><span class="level-item" id="busuanzi_container_page_pv"
                      ><span id="busuanzi_value_page_pv">0</span>次访问</span
                    >
                  </div>
                </div>
                <h1 class="title is-3 is-size-4-mobile">聊一聊 Mockito</h1>
                <div class="content">
                  <p>
                    Mockito 是 mocking 框架，它让你用简洁的API做测试。而且
                    Mockito 简单易学，它可读性强和验证语法简洁。
                  </p>
                  <span id="more"></span>

                  <p>从一个最简单的案例看起</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAnswer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">MockitoAnswerService</span> <span class="variable">service</span> <span class="operator">=</span> Mockito.mock(MockitoAnswerService.class);</span><br><span class="line">    Mockito.when(service.getResult(Mockito.anyString(), Mockito.anyList(), Mockito.any(MockitoAnswerParam.class))).then(<span class="keyword">new</span> <span class="title class_">Answer</span>&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">answer</span><span class="params">(InvocationOnMock invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">            Object[] arguments = invocation.getArguments();</span><br><span class="line">            <span class="comment">// 3</span></span><br><span class="line">            System.out.println(arguments.length);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;MOCK_ANSWER_RESULT&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> service.getResult(<span class="string">&quot;1&quot;</span>, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(), <span class="keyword">new</span> <span class="title class_">MockitoAnswerParam</span>());</span><br><span class="line">    Assert.assertTrue(result.equals(<span class="string">&quot;MOCK_ANSWER_RESULT&quot;</span>));</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>从代码看，主要有这样几个关键行为：</p>
                  <ul>
                    <li>mock</li>
                    <li>when</li>
                    <li>then</li>
                    <li>answer</li>
                  </ul>
                  <p>下面将以这几个行为作为分析的着手点。</p>
                  <h1 id="mock-对象做了哪些事情">
                    <a
                      href="#mock-对象做了哪些事情"
                      class="headerlink"
                      title="mock 对象做了哪些事情"
                    ></a
                    >mock 对象做了哪些事情
                  </h1>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates mock object of given class or interface.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * See examples in javadoc for &#123;<span class="doctag">@link</span> Mockito&#125; class</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> classToMock class or interface to mock</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mock object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@CheckReturnValue</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">mock</span><span class="params">(Class&lt;T&gt; classToMock)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mock(classToMock, withSettings());</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    接受一个 class 类型与一个 mockSettings，classToMock
                    就是我们需要 mock 对象的类型，而mockSettings 则记录着此次
                    mock 的一些信息。
                  </p>
                  <h2 id="mock">
                    <a href="#mock" class="headerlink" title="mock"></a>mock
                  </h2>
                  <p>
                    Mockito 内部持有了一个 MockitoCore 对象
                    <em>MOCKITO_CORE，</em> mock 最后是委托给
                    <em>MOCKITO_CORE</em> 来处理。
                  </p>
                  <p><code>org.mockito.internal.MockitoCore #mock</code></p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">public &lt;T&gt; T mock(Class&lt;T&gt; typeToMock, MockSettings settings) &#123;</span><br><span class="line">    if (!MockSettingsImpl.class.isInstance(settings)) &#123;</span><br><span class="line">        throw new IllegalArgumentException(</span><br><span class="line">            &quot;Unexpected implementation of &#x27;&quot;</span><br><span class="line">            + settings.getClass().getCanonicalName()</span><br><span class="line">            + &quot;&#x27;\n&quot;</span><br><span class="line">            + &quot;At the moment, you cannot provide your own implementations of that class.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    MockSettingsImpl impl = MockSettingsImpl.class.cast(settings);</span><br><span class="line">    MockCreationSettings&lt;T&gt; creationSettings = impl.build(typeToMock);</span><br><span class="line">    // 创建 mock 对象</span><br><span class="line">    T mock = createMock(creationSettings);</span><br><span class="line">    mockingProgress().mockingStarted(mock, creationSettings);</span><br><span class="line">    return mock;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <h3 id="mock-对象的产生">
                    <a
                      href="#mock-对象的产生"
                      class="headerlink"
                      title="mock 对象的产生"
                    ></a
                    >mock 对象的产生
                  </h3>
                  <p>
                    在MockitoCore中一是做了一下初始化工作，接着继续将 mock
                    对象创建交给了 MockUtil
                  </p>
                  <p>org.mockito.internal.util.MockUtil#createMock</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">createMock</span><span class="params">(MockCreationSettings&lt;T&gt; settings)</span> &#123;</span><br><span class="line">        <span class="type">MockHandler</span> <span class="variable">mockHandler</span> <span class="operator">=</span> createMockHandler(settings);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">spiedInstance</span> <span class="operator">=</span> settings.getSpiedInstance();</span><br><span class="line"></span><br><span class="line">        T mock;</span><br><span class="line">        <span class="keyword">if</span> (spiedInstance != <span class="literal">null</span>) &#123;</span><br><span class="line">            mock =</span><br><span class="line">                    mockMaker</span><br><span class="line">                            .createSpy(settings, mockHandler, (T) spiedInstance)</span><br><span class="line">                            .orElseGet(</span><br><span class="line">                                    () -&gt; &#123;</span><br><span class="line">                                        <span class="type">T</span> <span class="variable">instance</span> <span class="operator">=</span> mockMaker.createMock(settings, mockHandler);</span><br><span class="line">                                        <span class="keyword">new</span> <span class="title class_">LenientCopyTool</span>().copyToMock(spiedInstance, instance);</span><br><span class="line">                                        <span class="keyword">return</span> instance;</span><br><span class="line">                                    &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mock = mockMaker.createMock(settings, mockHandler);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mock;</span><br><span class="line">    &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>在 MockUtil 中比较关键的两个处理：</p>
                  <ul>
                    <li>
                      创建 MockHandler 对象，MockHandler 是一个接口，MockHandler
                      对象的实例是 InvocationNotifierHandler
                      类型，它只是负责对外的包装，内部实际起作用的是MockHandlerImpl，这个类承载了
                      Mockito 的主要逻辑，后面详细说明。
                    </li>
                    <li>
                      调用 mockMaker 来创建最终的实例，MockMaker
                      也是一个接口，其实现为ByteBuddyMockMaker。
                    </li>
                  </ul>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ByteBuddyMockMaker</span> <span class="keyword">implements</span> <span class="title class_">ClassCreatingMockMaker</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">ClassCreatingMockMaker</span> <span class="variable">defaultByteBuddyMockMaker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubclassByteBuddyMockMaker</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">createMock</span><span class="params">(MockCreationSettings&lt;T&gt; settings, MockHandler handler)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> defaultByteBuddyMockMaker.createMock(settings, handler);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 省略其他代码</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    可以看到，ByteBuddyMockMaker 内部用于创建 mock 对象的是
                    SubclassByteBuddyMockMaker。具体实现如下（为方便代码阅读，这里将一些无关代码去掉了）：
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">createMock</span><span class="params">(MockCreationSettings&lt;T&gt; settings, MockHandler handler)</span> &#123;</span><br><span class="line"> </span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; mockedProxyType = createMockType(settings);</span><br><span class="line"></span><br><span class="line">    <span class="type">Instantiator</span> <span class="variable">instantiator</span> <span class="operator">=</span> Plugins.getInstantiatorProvider().getInstantiator(settings);</span><br><span class="line">    <span class="type">T</span> <span class="variable">mockInstance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 实例化</span></span><br><span class="line">        mockInstance = instantiator.newInstance(mockedProxyType);</span><br><span class="line">        <span class="type">MockAccess</span> <span class="variable">mockAccess</span> <span class="operator">=</span> (MockAccess) mockInstance;</span><br><span class="line">        mockAccess.setMockitoInterceptor(<span class="keyword">new</span> <span class="title class_">MockMethodInterceptor</span>(handler, settings));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ensureMockIsAssignableToMockedType(settings, mockInstance);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassCastException cce) &#123;</span><br><span class="line">        <span class="comment">// ignore code</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (org.mockito.creation.instance.InstantiationException e) &#123;</span><br><span class="line">        <span class="comment">// ignore code</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    可以比较明确的看到，其创建了一个 mock
                    proxy（在之前的版本是直接创建代理类的），这里通过追踪代码，最终创建的逻辑在
                    org.mockito.internal.creation.bytebuddy.SubclassBytecodeGenerator#mockClass。这个方法内部逻辑比较多，但是核心部分就是通过
                    <a
                      target="_blank"
                      rel="noopener"
                      href="https://bytebuddy.net/"
                      >https://bytebuddy.net</a
                    >
                    动态生成一个代理类。
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// ....</span></span><br><span class="line">DynamicType.Builder&lt;T&gt; builder =</span><br><span class="line">                byteBuddy</span><br><span class="line">                        .subclass(features.mockedType)</span><br><span class="line">                        .name(name)</span><br><span class="line">                        .ignoreAlso(isGroovyMethod())</span><br><span class="line">                        .annotateType(</span><br><span class="line">                                features.stripAnnotations</span><br><span class="line">                                        ? <span class="keyword">new</span> <span class="title class_">Annotation</span>[<span class="number">0</span>]</span><br><span class="line">                                        : features.mockedType.getAnnotations())</span><br><span class="line">                        .implement(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Type&gt;(features.interfaces))</span><br><span class="line">                        .method(matcher)</span><br><span class="line">                        .intercept(dispatcher)</span><br><span class="line">                        .transform(withModifiers(SynchronizationState.PLAIN))</span><br><span class="line">                        .attribute(</span><br><span class="line">                                features.stripAnnotations</span><br><span class="line">                                        ? MethodAttributeAppender.NoOp.INSTANCE</span><br><span class="line">                                        : INCLUDING_RECEIVER)</span><br><span class="line">                        .method(isHashCode())</span><br><span class="line">                        .intercept(hashCode)</span><br><span class="line">                        .method(isEquals())</span><br><span class="line">                        .intercept(equals)</span><br><span class="line">                        .serialVersionUid(<span class="number">42L</span>)</span><br><span class="line">                        .defineField(<span class="string">&quot;mockitoInterceptor&quot;</span>, MockMethodInterceptor.class, PRIVATE)</span><br><span class="line">                        .implement(MockAccess.class)</span><br><span class="line">                        .intercept(FieldAccessor.ofBeanProperty());</span><br><span class="line"><span class="comment">//....</span></span><br><span class="line"><span class="keyword">return</span> builder.make()</span><br><span class="line">                .load(</span><br><span class="line">                        classLoader,</span><br><span class="line">                        loader.resolveStrategy(features.mockedType, classLoader, localMock))</span><br><span class="line">                .getLoaded();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    这里其实是 bytebuddy
                    动态生成类的基本动作，但是毕竟只是代码，下面是我将当前创建的
                    mockedProxyType 字节码写到 .class 文件得到的：
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.testproperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testproperties.MockitoAnswerService.MockitoMock<span class="number">.1791756687</span>.auxiliary.UFw2zv6r;</span><br><span class="line"><span class="keyword">import</span> com.example.testproperties.MockitoAnswerService.MockitoMock<span class="number">.1791756687</span>.auxiliary.oa15uI8r;</span><br><span class="line"><span class="keyword">import</span> com.example.testproperties.MockitoAnswerService.MockitoMock<span class="number">.1791756687</span>.auxiliary.vbeEWzX6;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.mockito.internal.creation.bytebuddy.MockAccess;</span><br><span class="line"><span class="keyword">import</span> org.mockito.internal.creation.bytebuddy.MockMethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mockito.internal.creation.bytebuddy.MockMethodInterceptor.DispatcherDefaultingToRealMethod;</span><br><span class="line"><span class="keyword">import</span> org.mockito.internal.creation.bytebuddy.MockMethodInterceptor.ForEquals;</span><br><span class="line"><span class="keyword">import</span> org.mockito.internal.creation.bytebuddy.MockMethodInterceptor.ForHashCode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MockitoAnswerService$MockitoMock$1791756687</span> <span class="keyword">extends</span> <span class="title class_">MockitoAnswerService</span> <span class="keyword">implements</span> <span class="title class_">MockAccess</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">42L</span>;</span><br><span class="line">    <span class="keyword">private</span> MockMethodInterceptor mockitoInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object var1)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ForEquals.doIdentityEquals(<span class="built_in">this</span>, var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (String)DispatcherDefaultingToRealMethod.interceptSuperCallable(<span class="built_in">this</span>, <span class="built_in">this</span>.mockitoInterceptor, cachedValue$oKHFaZjn$4cscpe1, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>], <span class="keyword">new</span> <span class="title class_">UFw2zv6r</span>(<span class="built_in">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ForHashCode.doIdentityHashCode(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> DispatcherDefaultingToRealMethod.interceptSuperCallable(<span class="built_in">this</span>, <span class="built_in">this</span>.mockitoInterceptor, cachedValue$oKHFaZjn$7m9oaq0, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>], <span class="keyword">new</span> <span class="title class_">oa15uI8r</span>(<span class="built_in">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getResult</span><span class="params">(String arg1, List&lt;Object&gt; arg2, MockitoAnswerParam arg3)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (String)DispatcherDefaultingToRealMethod.interceptSuperCallable(<span class="built_in">this</span>, <span class="built_in">this</span>.mockitoInterceptor, cachedValue$oKHFaZjn$rr3ccu3, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;var1, var2, var3&#125;, <span class="keyword">new</span> <span class="title class_">vbeEWzX6</span>(<span class="built_in">this</span>, var1, var2, var3));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MockMethodInterceptor <span class="title function_">getMockitoInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mockitoInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMockitoInterceptor</span><span class="params">(MockMethodInterceptor var1)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mockitoInterceptor = var1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MockitoAnswerService$MockitoMock$<span class="number">1791756687</span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    可以比较直观的看到，getResult
                    方法被插了拦截器，且当前类是作为目标被测试类的子类。来看下
                    DispatcherDefaultingToRealMethod#interceptSuperCallable
                    方法：
                  </p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">@RuntimeType</span><br><span class="line">@BindingPriority(BindingPriority.DEFAULT * 2)</span><br><span class="line">public static Object interceptSuperCallable(</span><br><span class="line">    @This Object mock,</span><br><span class="line">    @FieldValue(&quot;mockitoInterceptor&quot;) MockMethodInterceptor interceptor,</span><br><span class="line">    @Origin Method invokedMethod,</span><br><span class="line">    @AllArguments Object[] arguments,</span><br><span class="line">    @SuperCall(serializableProxy = true) Callable&lt;?&gt; superCall)</span><br><span class="line">    throws Throwable &#123;</span><br><span class="line">    if (interceptor == null) &#123;</span><br><span class="line">        return superCall.call();</span><br><span class="line">    &#125;</span><br><span class="line">    return interceptor.doIntercept(</span><br><span class="line">        mock, invokedMethod, arguments, new RealMethod.FromCallable(superCall));</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    按照参数来看，cachedValue$oKHFaZjn$rr3ccu3
                    这坨东西居然是原始方法…。在前面那个代码中也提到，这里
                    interceptor 是类型为 MockMethodInterceptor
                    的实例，在创建字节码时就有体现这一点。所以在方法调用上，会走
                    doIntercept 的逻辑。
                  </p>
                  <h3 id="mock-方法的执行">
                    <a
                      href="#mock-方法的执行"
                      class="headerlink"
                      title="mock 方法的执行"
                    ></a
                    >mock 方法的执行
                  </h3>
                  <p>
                    上面提到，mock 本质上时通过 byteBuddy 创建了一个被 mock
                    类的子类，并且未被 mock
                    类方法插上了拦截器。所以我们基本就可以猜测到，mock
                    方法的实际执行，会被 mock 对象包装过的方法及拦截器 hook
                    掉，从而走到预设的逻辑。下面具体分析。（下面是通过执行堆栈追踪到的具体执行逻辑,<code>org.mockito.internal.creation.bytebuddy.MockMethodInterceptor#doIntercept</code>）
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Object <span class="title function_">doIntercept</span><span class="params">(</span></span><br><span class="line"><span class="params">            Object mock,</span></span><br><span class="line"><span class="params">            Method invokedMethod,</span></span><br><span class="line"><span class="params">            Object[] arguments,</span></span><br><span class="line"><span class="params">            RealMethod realMethod,</span></span><br><span class="line"><span class="params">            Location location)</span></span><br><span class="line">            <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// If the currently dispatched method is used in a hot path, typically a tight loop and if</span></span><br><span class="line">        <span class="comment">// the mock is not used after the currently dispatched method, the JVM might attempt a</span></span><br><span class="line">        <span class="comment">// garbage collection of the mock instance even before the execution of the current</span></span><br><span class="line">        <span class="comment">// method is completed. Since we only reference the mock weakly from hereon after to avoid</span></span><br><span class="line">        <span class="comment">// leaking the instance, it might therefore be garbage collected before the</span></span><br><span class="line">        <span class="comment">// handler.handle(...) method completes. Since the handler method expects the mock to be</span></span><br><span class="line">        <span class="comment">// present while a method call onto the mock is dispatched, this can lead to the problem</span></span><br><span class="line">        <span class="comment">// described in GitHub #1802.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// To avoid this problem, we distract the JVM JIT by escaping the mock instance to a thread</span></span><br><span class="line">        <span class="comment">// local field for the duration of the handler&#x27;s dispatch.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// When dropping support for Java 8, instead of this hatch we should use an explicit fence</span></span><br><span class="line">        <span class="comment">// https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Reference.html#reachabilityFence-java.lang.Object-</span></span><br><span class="line">        weakReferenceHatch.set(mock);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> handler.handle(</span><br><span class="line">                    createInvocation(</span><br><span class="line">                            mock,</span><br><span class="line">                            invokedMethod,</span><br><span class="line">                            arguments,</span><br><span class="line">                            realMethod,</span><br><span class="line">                            mockCreationSettings,</span><br><span class="line">                            location));</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            weakReferenceHatch.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    这里在内部，有包装了一层，将原始方法及mock
                    对象参数等，放到了
                    <code
                      >org.mockito.internal.invocation.InterceptedInvocation</code
                    >
                    这个类中。这种做法还是比较常见的，使得所有的模型按照组件内部封装的模型进行转换和执行，在组件内部形成语义上的闭环。weakReferenceHatch
                    是一个 ThreadLocal 变量，这里就是将 mock 对象放在
                    ThreadLocal
                    中，已便于后面基于当前线程上下文的所有动作都可以共享这个
                    mock 对象。那最核心的执行部分就是 handler#handle(Invocation
                    invocation)。
                  </p>
                  <p>
                    这里的 Hander 是 MockHandler，Mockito
                    内部实现此接口的有三个，实际使用最多的是 MockHandlerImpl
                    实现方式，这里以 MockHandlerImpl 的 handle
                    为例。下面是代码：
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">handle</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">// doAnswer 时会执行</span></span><br><span class="line">        <span class="keyword">if</span> (invocationContainer.hasAnswersForStubbing()) &#123;</span><br><span class="line">            <span class="comment">// stubbing voids with doThrow() or doAnswer() style</span></span><br><span class="line">            <span class="type">InvocationMatcher</span> <span class="variable">invocationMatcher</span> <span class="operator">=</span></span><br><span class="line">                    matchersBinder.bindMatchers(</span><br><span class="line">                            mockingProgress().getArgumentMatcherStorage(), invocation);</span><br><span class="line">            invocationContainer.setMethodForStubbing(invocationMatcher);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// VerificationMode 是对验证信息的封装,它是一个接口,含有 verify 函数, 例如常用的 never,times 返回的都是 Times 类型,而 Times 类型就是 VerificationMode 的一种实现。 然后,调用 mockingProgress 来缓存 mode 信息。</span></span><br><span class="line">        <span class="type">VerificationMode</span> <span class="variable">verificationMode</span> <span class="operator">=</span> mockingProgress().pullVerificationMode();</span><br><span class="line">		<span class="comment">// 用来匹配 when 条件</span></span><br><span class="line">        <span class="type">InvocationMatcher</span> <span class="variable">invocationMatcher</span> <span class="operator">=</span></span><br><span class="line">                matchersBinder.bindMatchers(</span><br><span class="line">                        mockingProgress().getArgumentMatcherStorage(), invocation);</span><br><span class="line"></span><br><span class="line">        mockingProgress().validateState();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if verificationMode is not null then someone is doing verify()</span></span><br><span class="line">        <span class="keyword">if</span> (verificationMode != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// We need to check if verification was started on the correct mock</span></span><br><span class="line">            <span class="comment">// - see VerifyingWithAnExtraCallToADifferentMockTest (bug 138)</span></span><br><span class="line">            <span class="keyword">if</span> (((MockAwareVerificationMode) verificationMode).getMock() == invocation.getMock()) &#123;</span><br><span class="line">                <span class="type">VerificationDataImpl</span> <span class="variable">data</span> <span class="operator">=</span></span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">VerificationDataImpl</span>(invocationContainer, invocationMatcher);</span><br><span class="line">                verificationMode.verify(data);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// this means there is an invocation on a different mock. Re-adding verification</span></span><br><span class="line">                <span class="comment">// mode</span></span><br><span class="line">                <span class="comment">// - see VerifyingWithAnExtraCallToADifferentMockTest (bug 138)</span></span><br><span class="line">                mockingProgress().verificationStarted(verificationMode);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 准备 stubbing 调用</span></span><br><span class="line">        invocationContainer.setInvocationForPotentialStubbing(invocationMatcher);</span><br><span class="line">        OngoingStubbingImpl&lt;T&gt; ongoingStubbing = <span class="keyword">new</span> <span class="title class_">OngoingStubbingImpl</span>&lt;T&gt;(invocationContainer);</span><br><span class="line">        mockingProgress().reportOngoingStubbing(ongoingStubbing);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 寻找此 invocation 是否有 answer</span></span><br><span class="line">        <span class="type">StubbedInvocationMatcher</span> <span class="variable">stubbing</span> <span class="operator">=</span> invocationContainer.findAnswerFor(invocation);</span><br><span class="line">        <span class="comment">// TODO #793 - when completed, we should be able to get rid of the casting below</span></span><br><span class="line">        notifyStubbedAnswerLookup(</span><br><span class="line">                invocation,</span><br><span class="line">                stubbing,</span><br><span class="line">                invocationContainer.getStubbingsAscending(),</span><br><span class="line">                (CreationSettings) mockSettings);</span><br><span class="line">		<span class="comment">// 如果有 answer 则进行 answer 的回调，上面的 例子中有，所以 case 执行会走到这里</span></span><br><span class="line">        <span class="keyword">if</span> (stubbing != <span class="literal">null</span>) &#123;</span><br><span class="line">            stubbing.captureArgumentsFrom(invocation);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> stubbing.answer(invocation);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// Needed so that we correctly isolate stubbings in some scenarios</span></span><br><span class="line">                <span class="comment">// see MockitoStubbedCallInAnswerTest or issue #1279</span></span><br><span class="line">                mockingProgress().reportOngoingStubbing(ongoingStubbing);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> mockSettings.getDefaultAnswer().answer(invocation);</span><br><span class="line">            DefaultAnswerValidator.validateReturnValueFor(invocation, ret);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Mockito uses it to redo setting invocation for potential stubbing in case of partial</span></span><br><span class="line">            <span class="comment">// mocks / spies.</span></span><br><span class="line">            <span class="comment">// Without it, the real method inside &#x27;when&#x27; might have delegated to other self method</span></span><br><span class="line">            <span class="comment">// and overwrite the intended stubbed method with a different one.</span></span><br><span class="line">            <span class="comment">// This means we would be stubbing a wrong method.</span></span><br><span class="line">            <span class="comment">// Typically this would led to runtime exception that validates return type with stubbed</span></span><br><span class="line">            <span class="comment">// method signature.</span></span><br><span class="line">            invocationContainer.resetInvocationForPotentialStubbing(invocationMatcher);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    这里说明以下，handle 方法在 when
                    中会被执行一次，再后面实际调用时还会执行一次，所以一次
                    when(method) 到实际 mock 调用，会执行两次。这里最开始在
                    debug 时，每次第一次走到都没符合预期返回 then
                    的值，后面通过分析堆栈发展调用入口时 when 中 mock
                    发起，并非时后面实际测试调用发起，才解释了这个没有预期返回结果的情况。
                  </p>
                  <p>这里补充下 InvocationMatcher 的 runtime 信息</p>
                  <p>
                    <img
                      src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f01c1cc1b5c04f128854f26ec5dcac91~tplv-k3u1fbpfcp-zoom-1.image"
                    />
                  </p>
                  <h2 id="MockHandler">
                    <a
                      href="#MockHandler"
                      class="headerlink"
                      title="MockHandler"
                    ></a
                    >MockHandler
                  </h2>
                  <p>
                    mockito 会为每个创建的 mock 对象创建一个 MockHandler,
                    它的实现类是 MockHandlerImpl。该对象主要用于处理 mock
                    对象的每个被拦截方法。执行每个拦截方法的时候，都会交给这个
                    handler 处理。
                  </p>
                  <h2 id="MockingProgress">
                    <a
                      href="#MockingProgress"
                      class="headerlink"
                      title="MockingProgress"
                    ></a
                    >MockingProgress
                  </h2>
                  <p>
                    用来存放正在 mock 中的数据，如
                    OngoingStubbingImpl、argumentMatcherStorage、verificationMode
                    等。MockingProgress 的实现类是 MockingProgressImpl 。从
                    MockHandlerImpl#handle
                    的代码中可以看到，在整个执行逻辑中会平凡的出现
                    mockingProgress() ，mockingProgress() 是
                    ThreadSafeMockingProgress
                    中提供的静态方法，ThreadSafeMockingProgress
                    为不用线程分配了不同的 MockingProgress ，采用了 ThreadLocal
                    方式实现，保证了线程安全。
                  </p>
                  <h2 id="OngoingStubbingImpl">
                    <a
                      href="#OngoingStubbingImpl"
                      class="headerlink"
                      title="OngoingStubbingImpl"
                    ></a
                    >OngoingStubbingImpl
                  </h2>
                  <p>
                    mock 方法的一个包装。会为每个 mock 对象的方法创建一个
                    OngoingStubbingImpl，用来监控和模拟该方法行为。如上面service.getResult(Mockito.<em>anyString</em>(),
                    Mockito.<em>anyList</em>(),
                    Mockito.<em>any</em>(MockitoAnswerParam.class)) 行为。一个
                    mock 方法对应多个 OngoingStubbingImpl，因为每调用一次 mock
                    方法都会创建一个 OngoingStubbingImpl 对象。
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//see MockHandlerImpl#handle</span></span><br><span class="line"></span><br><span class="line">invocationContainer.setInvocationForPotentialStubbing(invocationMatcher);</span><br><span class="line"><span class="comment">// 这里是对上述描述的代码解释</span></span><br><span class="line">OngoingStubbingImpl&lt;T&gt; ongoingStubbing = <span class="keyword">new</span> <span class="title class_">OngoingStubbingImpl</span>&lt;T&gt;(invocationContainer);</span><br><span class="line">mockingProgress().reportOngoingStubbing(ongoingStubbing);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <h2 id="mockSettings">
                    <a
                      href="#mockSettings"
                      class="headerlink"
                      title="mockSettings"
                    ></a
                    >mockSettings
                  </h2>
                  <blockquote>
                    <p>
                      MockSettings has been introduced for two reasons. Firstly,
                      to make it easy to add another mock setting when the
                      demand comes. Secondly, to enable combining together
                      different mock settings without introducing zillions of
                      overloaded mock() methods.
                    </p>
                  </blockquote>
                  <p>
                    引入 MockSettings 有两个原因。
                    首先，当有需求时，可以很容易地添加另一个模拟设置。
                    其次，在不引入无数重载的 mock()
                    方法的情况下，将不同的模拟设置组合在一起。
                  </p>
                  <p>怎么理解这个 mockSettings ？举个例子：</p>
                  <p>创建具有不同 defaultAnswer 和 name 的 mock</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="type">Foo</span> <span class="variable">mock</span> <span class="operator">=</span> mock(Foo.class, withSettings()</span><br><span class="line">                                  .defaultAnswer(RETURNS_SMART_NULLS)</span><br><span class="line">                                  .name(<span class="string">&quot;cool mockie&quot;</span>)</span><br><span class="line">                                  );</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    创建具有不同 defaultAnswer name 和 extraInterfaces 的 mock
                  </p>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Foo mock = mock(Foo.class, withSettings()</span><br><span class="line">                                  .defaultAnswer(RETURNS_SMART_NULLS)</span><br><span class="line">                                  .name(&quot;cool mockie&quot;)</span><br><span class="line">                                  .extraInterfaces(Bar.class));</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <h3 id="什么是-extraInterfaces">
                    <a
                      href="#什么是-extraInterfaces"
                      class="headerlink"
                      title="什么是 extraInterfaces"
                    ></a
                    >什么是 extraInterfaces
                  </h3>
                  <p>
                    指定 mock
                    应该实现的额外接口，可能对遗留代码或某些极端情况有用。这个神秘的功能应该偶尔使用。被测对象应该确切地知道它的合作者和依赖关系。
                    如果实际场景碰巧有经常这样使用它的，那往往说明你的代码可能不具备简单、干净和可读的特性。
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="type">Foo</span> <span class="variable">foo</span> <span class="operator">=</span> mock(Foo.class, withSettings().extraInterfaces(Bar.class, Baz.class));</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>现在，mock 实现了额外的接口，因此可以进行以下转换：</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="type">Bar</span> <span class="variable">bar</span> <span class="operator">=</span> (Bar) foo;</span><br><span class="line"><span class="type">Baz</span> <span class="variable">baz</span> <span class="operator">=</span> (Baz) foo;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <h3 id="什么的-name">
                    <a
                      href="#什么的-name"
                      class="headerlink"
                      title="什么的 name"
                    ></a
                    >什么的 name
                  </h3>
                  <p>
                    当前 mock 对象的名字，没有什么实际的用处，即使 name
                    相同，也是不同的两个 mock 对象（可通过 hashCode 判断得出）
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="type">Foo</span> <span class="variable">foo</span> <span class="operator">=</span> mock(Foo.class, withSettings().name(<span class="string">&quot;foo&quot;</span>));</span><br><span class="line"><span class="type">Foo</span> <span class="variable">foo</span> <span class="operator">=</span> mock(Foo.class, <span class="string">&quot;foo&quot;</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>@Mock 注解 的 name 默认是 filedName 。</p>
                  <h3 id="什么是-defaultAnswer">
                    <a
                      href="#什么是-defaultAnswer"
                      class="headerlink"
                      title="什么是 defaultAnswer"
                    ></a
                    >什么是 defaultAnswer
                  </h3>
                  <p>
                    对 mock 对象的方法进行调用预期的设定，可以通过 thenReturn()
                    来指定返回值，thenThrow()
                    指定返回时所抛异常，通常来说这两个方法足以应对一般的需求。但有时我们需要自定义方法执行的返回结果，Answer
                    接口就是满足这样的需求而存在的，它可以用来处理那些 mock
                    对象没有 stubbing 的方法的返回值。
                  </p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAnswer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">MockitoAnswerService</span> <span class="variable">service</span> <span class="operator">=</span> Mockito.mock(MockitoAnswerService.class);</span><br><span class="line">    Mockito.when(service.getResult(Mockito.anyString(), Mockito.anyList(), Mockito.any(MockitoAnswerParam.class))).then(<span class="keyword">new</span> <span class="title class_">Answer</span>&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">answer</span><span class="params">(InvocationOnMock invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">            Object[] arguments = invocation.getArguments();</span><br><span class="line">            <span class="comment">// 3</span></span><br><span class="line">            System.out.println(arguments.length);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;MOCK_ANSWER_RESULT&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> service.getResult(<span class="string">&quot;1&quot;</span>, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(), <span class="keyword">new</span> <span class="title class_">MockitoAnswerParam</span>());</span><br><span class="line">    Assert.assertTrue(result.equals(<span class="string">&quot;MOCK_ANSWER_RESULT&quot;</span>));</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    还有一些如 stubbingLookupListeners
                    等这里不做过多说明，详细可参考官方文档。
                  </p>
                </div>
                <div class="article-licensing box">
                  <div class="licensing-title">
                    <p>聊一聊 Mockito</p>
                    <p>
                      <a
                        href="http://sunknightzy.github.io/2021/11/06/tests/test-mock-mockito/"
                        >http://sunknightzy.github.io/2021/11/06/tests/test-mock-mockito/</a
                      >
                    </p>
                  </div>
                  <div class="licensing-meta level is-mobile">
                    <div class="level-left">
                      <div class="level-item is-narrow">
                        <div>
                          <h6>作者</h6>
                          <p>J.Queue</p>
                        </div>
                      </div>
                      <div class="level-item is-narrow">
                        <div>
                          <h6>发布于</h6>
                          <p>2021-11-06</p>
                        </div>
                      </div>
                      <div class="level-item is-narrow">
                        <div>
                          <h6>更新于</h6>
                          <p>2022-04-24</p>
                        </div>
                      </div>
                      <div class="level-item is-narrow">
                        <div>
                          <h6>许可协议</h6>
                          <p>
                            <a
                              class="icons"
                              rel="noopener"
                              target="_blank"
                              title="Creative Commons"
                              href="https://creativecommons.org/"
                              ><i class="icon fab fa-creative-commons"></i
                            ></a>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="article-tags is-size-7 mb-4">
                  <span class="mr-2">#</span
                  ><a class="link-muted mr-2" rel="tag" href="/tags/test/"
                    >test</a
                  ><a class="link-muted mr-2" rel="tag" href="/tags/mock/"
                    >mock</a
                  ><a class="link-muted mr-2" rel="tag" href="/tags/Mockito/"
                    >Mockito</a
                  >
                </div>
                <!--!-->
              </article>
            </div>
            <div class="card">
              <div class="card-content">
                <h3 class="menu-label has-text-centered">
                  喜欢这篇文章？打赏一下作者吧
                </h3>
                <div class="buttons is-centered">
                  <a class="button donate" data-type="alipay"
                    ><span class="icon is-small"
                      ><i class="fab fa-alipay"></i></span
                    ><span>支付宝</span
                    ><span class="qrcode"
                      ><img src="/img/zfb.JPG" alt="支付宝" /></span></a
                  ><a class="button donate" data-type="wechat"
                    ><span class="icon is-small"
                      ><i class="fab fa-weixin"></i></span
                    ><span>微信</span
                    ><span class="qrcode"
                      ><img src="/img/pay.JPG" alt="微信" /></span
                  ></a>
                </div>
              </div>
            </div>
            <nav class="post-navigation mt-4 level is-mobile">
              <div class="level-start">
                <a
                  class="article-nav-prev level level-item link-muted"
                  href="/2021/11/08/middleware/middleware-mysql-log-file/"
                  ><i class="level-item fas fa-chevron-left"></i
                  ><span class="level-item">mysql 日志文件</span></a
                >
              </div>
              <div class="level-end">
                <a
                  class="article-nav-next level level-item link-muted"
                  href="/2021/11/05/jvm/jvm-openjdk-oop-klass/"
                  ><span class="level-item">JVM-Java 对象模型</span
                  ><i class="level-item fas fa-chevron-right"></i
                ></a>
              </div>
            </nav>
            <div class="card">
              <div class="card-content">
                <h3 class="title is-5">评论</h3>
                <div id="comment-container"></div>
                <link
                  rel="stylesheet"
                  href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"
                />
                <script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
                <script>
                  var gitalk = new Gitalk({
                    id: 'c016d61c876646533c51f2921b027b83',
                    repo: 'glmapper.github.io',
                    owner: 'glmapper',
                    clientID: 'd25147ddf77e70d7adfe',
                    clientSecret: 'c10bbd1ba7a09c96e4106709107d4da85d60be78',
                    admin: ['glmapper'],
                    createIssueManually: false,
                    distractionFreeMode: true,
                    perPage: 20,
                    pagerDirection: 'last',

                    enableHotKey: true,
                    language: 'zh-CN',
                  })
                  gitalk.render('comment-container')
                </script>
              </div>
            </div>
          </div>
          <div
            class="column column-left is-4-tablet is-4-desktop is-3-widescreen order-1 is-sticky"
          >
            <div class="card widget" data-type="profile">
              <div class="card-content">
                <nav class="level">
                  <div class="level-item has-text-centered flex-shrink-1">
                    <div>
                      <figure class="image is-128x128 mx-auto mb-2">
                        <img
                          class="avatar is-rounded"
                          src="/img/self.png"
                          alt="J.Queue"
                        />
                      </figure>
                      <p
                        class="title is-size-4 is-block"
                        style="line-height: inherit"
                      >
                        J.Queue
                      </p>
                      <p class="is-size-6 is-block">Java Developer</p>
                      <p class="is-size-6 is-flex justify-content-center">
                        <i class="fas fa-map-marker-alt mr-1"></i
                        ><span>🇨🇳 China</span>
                      </p>
                    </div>
                  </div>
                </nav>
                <nav class="level is-mobile">
                  <div class="level-item has-text-centered is-marginless">
                    <div>
                      <p class="heading">文章</p>
                      <a href="/archives"><p class="title">108</p></a>
                    </div>
                  </div>
                  <div class="level-item has-text-centered is-marginless">
                    <div>
                      <p class="heading">分类</p>
                      <a href="/categories"><p class="title">17</p></a>
                    </div>
                  </div>
                  <div class="level-item has-text-centered is-marginless">
                    <div>
                      <p class="heading">标签</p>
                      <a href="/tags"><p class="title">128</p></a>
                    </div>
                  </div>
                </nav>
                <div class="level">
                  <a
                    class="level-item button is-primary is-rounded"
                    href="https://github.com/glmapper"
                    target="_blank"
                    rel="noopener"
                    >关注我</a
                  >
                </div>
                <div class="level is-mobile is-multiline">
                  <a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="Github"
                    href="https://github.com/glmapper"
                    ><i class="fab fa-github"></i></a
                  ><a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="Twitter"
                    href="https://twitter.com"
                    ><i class="fab fa-twitter"></i></a
                  ><a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="weibo"
                    href="https://weibo.com/u/2412872703"
                    ><i class="fab fa-weibo"></i></a
                  ><a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="RSS"
                    href="/atom.xml"
                    ><i class="fas fa-rss"></i
                  ></a>
                </div>
              </div>
            </div>
            <div class="card widget" data-type="links">
              <div class="card-content">
                <div class="menu">
                  <h3 class="menu-label">链接</h3>
                  <ul class="menu-list">
                    <li>
                      <a
                        class="level is-mobile"
                        href="https://juejin.cn/user/3227821827961806"
                        target="_blank"
                        rel="noopener"
                        ><span class="level-left"
                          ><span class="level-item">掘金社区</span></span
                        ><span class="level-right"
                          ><span class="level-item tag">juejin.cn</span></span
                        ></a
                      >
                    </li>
                    <li>
                      <a
                        class="level is-mobile"
                        href="https://www.sofastack.tech/"
                        target="_blank"
                        rel="noopener"
                        ><span class="level-left"
                          ><span class="level-item">SOFAStack</span></span
                        ><span class="level-right"
                          ><span class="level-item tag"
                            >www.sofastack.tech</span
                          ></span
                        ></a
                      >
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="card widget" id="toc" data-type="toc">
              <div class="card-content">
                <div class="menu">
                  <h3 class="menu-label">目录</h3>
                  <ul class="menu-list">
                    <li>
                      <a class="level is-mobile" href="#mock-对象做了哪些事情"
                        ><span class="level-left"
                          ><span class="level-item">1</span
                          ><span class="level-item"
                            >mock 对象做了哪些事情</span
                          ></span
                        ></a
                      >
                      <ul class="menu-list">
                        <li>
                          <a class="level is-mobile" href="#mock"
                            ><span class="level-left"
                              ><span class="level-item">1.1</span
                              ><span class="level-item">mock</span></span
                            ></a
                          >
                          <ul class="menu-list">
                            <li>
                              <a class="level is-mobile" href="#mock-对象的产生"
                                ><span class="level-left"
                                  ><span class="level-item">1.1.1</span
                                  ><span class="level-item"
                                    >mock 对象的产生</span
                                  ></span
                                ></a
                              >
                            </li>
                            <li>
                              <a class="level is-mobile" href="#mock-方法的执行"
                                ><span class="level-left"
                                  ><span class="level-item">1.1.2</span
                                  ><span class="level-item"
                                    >mock 方法的执行</span
                                  ></span
                                ></a
                              >
                            </li>
                          </ul>
                        </li>
                        <li>
                          <a class="level is-mobile" href="#MockHandler"
                            ><span class="level-left"
                              ><span class="level-item">1.2</span
                              ><span class="level-item">MockHandler</span></span
                            ></a
                          >
                        </li>
                        <li>
                          <a class="level is-mobile" href="#MockingProgress"
                            ><span class="level-left"
                              ><span class="level-item">1.3</span
                              ><span class="level-item"
                                >MockingProgress</span
                              ></span
                            ></a
                          >
                        </li>
                        <li>
                          <a class="level is-mobile" href="#OngoingStubbingImpl"
                            ><span class="level-left"
                              ><span class="level-item">1.4</span
                              ><span class="level-item"
                                >OngoingStubbingImpl</span
                              ></span
                            ></a
                          >
                        </li>
                        <li>
                          <a class="level is-mobile" href="#mockSettings"
                            ><span class="level-left"
                              ><span class="level-item">1.5</span
                              ><span class="level-item"
                                >mockSettings</span
                              ></span
                            ></a
                          >
                          <ul class="menu-list">
                            <li>
                              <a
                                class="level is-mobile"
                                href="#什么是-extraInterfaces"
                                ><span class="level-left"
                                  ><span class="level-item">1.5.1</span
                                  ><span class="level-item"
                                    >什么是 extraInterfaces</span
                                  ></span
                                ></a
                              >
                            </li>
                            <li>
                              <a class="level is-mobile" href="#什么的-name"
                                ><span class="level-left"
                                  ><span class="level-item">1.5.2</span
                                  ><span class="level-item"
                                    >什么的 name</span
                                  ></span
                                ></a
                              >
                            </li>
                            <li>
                              <a
                                class="level is-mobile"
                                href="#什么是-defaultAnswer"
                                ><span class="level-left"
                                  ><span class="level-item">1.5.3</span
                                  ><span class="level-item"
                                    >什么是 defaultAnswer</span
                                  ></span
                                ></a
                              >
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
              <script src="/js/toc.js" defer></script>
            </div>
            <div class="card widget" data-type="tags">
              <div class="card-content">
                <div class="menu">
                  <h3 class="menu-label">标签</h3>
                  <div class="field is-grouped is-grouped-multiline">
                    <div class="control">
                      <a class="tags has-addons" href="/tags/BeanDefinition/"
                        ><span class="tag">BeanDefinition</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/BeanPostProcessor/"
                        ><span class="tag">BeanPostProcessor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/BeanWrapper/"
                        ><span class="tag">BeanWrapper</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/CAS/"
                        ><span class="tag">CAS</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ClassLoader/"
                        ><span class="tag">ClassLoader</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/CopyOnWriteArraySet/"
                        ><span class="tag">CopyOnWriteArraySet</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Disruptor/"
                        ><span class="tag">Disruptor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Embedded-Tomcat/"
                        ><span class="tag">Embedded Tomcat</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Exception/"
                        ><span class="tag">Exception</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Executor/"
                        ><span class="tag">Executor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/FX-Application/"
                        ><span class="tag">FX Application</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/FatJar/"
                        ><span class="tag">FatJar</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Ioc/"
                        ><span class="tag">Ioc</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/JAR/"
                        ><span class="tag">JAR</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/JDK/"
                        ><span class="tag">JDK</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/JUC/"
                        ><span class="tag">JUC</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Kafka/"
                        ><span class="tag">Kafka</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/MANIFEST-MF/"
                        ><span class="tag">MANIFEST.MF</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Mockito/"
                        ><span class="tag">Mockito</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Mysql/"
                        ><span class="tag">Mysql</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/OOM/"
                        ><span class="tag">OOM</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/OpenTracing/"
                        ><span class="tag">OpenTracing</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/PropertySource/"
                        ><span class="tag">PropertySource</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Readiness-Check/"
                        ><span class="tag">Readiness Check</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ResourceLoader/"
                        ><span class="tag">ResourceLoader</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/RestTemplate/"
                        ><span class="tag">RestTemplate</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/RocketMQ/"
                        ><span class="tag">RocketMQ</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SOFA/"
                        ><span class="tag">SOFA</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SOFAArk/"
                        ><span class="tag">SOFAArk</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SOFAStack/"
                        ><span class="tag">SOFAStack</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SpringBoot/"
                        ><span class="tag">SpringBoot</span
                        ><span class="tag">16</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/TestDouble/"
                        ><span class="tag">TestDouble</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/ThreadPoolExecutor/"
                        ><span class="tag">ThreadPoolExecutor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Tracer/"
                        ><span class="tag">Tracer</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Zipkin/"
                        ><span class="tag">Zipkin</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ab-test/"
                        ><span class="tag">ab test</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/actuator/"
                        ><span class="tag">actuator</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/aop/"
                        ><span class="tag">aop</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/api/"
                        ><span class="tag">api</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/apollo/"
                        ><span class="tag">apollo</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/bean-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">bean 扩展机制</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"
                        ><span class="tag">bean 生命周期</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/bootstrap/"
                        ><span class="tag">bootstrap</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/cache/"
                        ><span class="tag">cache</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/classloader/"
                        ><span class="tag">classloader</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/config/"
                        ><span class="tag">config</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/cookie/"
                        ><span class="tag">cookie</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/curator/"
                        ><span class="tag">curator</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/docker/"
                        ><span class="tag">docker</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/eureka/"
                        ><span class="tag">eureka</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/event/"
                        ><span class="tag">event</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/feign/"
                        ><span class="tag">feign</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/gateway/"
                        ><span class="tag">gateway</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/gc/"
                        ><span class="tag">gc</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/git/"
                        ><span class="tag">git</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/github/"
                        ><span class="tag">github</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/guava/"
                        ><span class="tag">guava</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/http/"
                        ><span class="tag">http</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/hystrix/"
                        ><span class="tag">hystrix</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/java/"
                        ><span class="tag">java</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/junit/"
                        ><span class="tag">junit</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/jvm/"
                        ><span class="tag">jvm</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/kafka/"
                        ><span class="tag">kafka</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/linux/"
                        ><span class="tag">linux</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/lock/"
                        ><span class="tag">lock</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/log/"
                        ><span class="tag">log</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/logback/"
                        ><span class="tag">logback</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/maven/"
                        ><span class="tag">maven</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/maven-debug/"
                        ><span class="tag">maven debug</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/maven-plugin/"
                        ><span class="tag">maven plugin</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/merge/"
                        ><span class="tag">merge</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/microservices/"
                        ><span class="tag">microservices</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/mock/"
                        ><span class="tag">mock</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/mybatis/"
                        ><span class="tag">mybatis</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/mysql/"
                        ><span class="tag">mysql</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/nacos/"
                        ><span class="tag">nacos</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/namespace/"
                        ><span class="tag">namespace</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/netflix/"
                        ><span class="tag">netflix</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/nginx/"
                        ><span class="tag">nginx</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/oop-klass/"
                        ><span class="tag">oop-klass</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/reactor/"
                        ><span class="tag">reactor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/rebase/"
                        ><span class="tag">rebase</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/redis/"
                        ><span class="tag">redis</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/rpc/"
                        ><span class="tag">rpc</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/session/"
                        ><span class="tag">session</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/set/"
                        ><span class="tag">set</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/shell/"
                        ><span class="tag">shell</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/slf4j/"
                        ><span class="tag">slf4j</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/spring/"
                        ><span class="tag">spring</span
                        ><span class="tag">11</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/spring-cloud/"
                        ><span class="tag">spring cloud</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/spring-mvc/"
                        ><span class="tag">spring mvc</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/spring-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">spring 扩展机制</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/sql/"
                        ><span class="tag">sql</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ssh/"
                        ><span class="tag">ssh</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/starter-%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">starter 机制</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/test/"
                        ><span class="tag">test</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/testing/"
                        ><span class="tag">testing</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/thread/"
                        ><span class="tag">thread</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/tomcat/"
                        ><span class="tag">tomcat</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/top/"
                        ><span class="tag">top</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/typecheck/"
                        ><span class="tag">typecheck</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/yapi/"
                        ><span class="tag">yapi</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/yum/"
                        ><span class="tag">yum</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/zookeeper/"
                        ><span class="tag">zookeeper</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E4%B8%AD%E5%8F%B0/"
                        ><span class="tag">中台</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">事件机制</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"
                        ><span class="tag">依赖注入</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"
                        ><span class="tag">分布式</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"
                        ><span class="tag">分布式链路跟踪</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"
                        ><span class="tag">反向代理</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%8F%8D%E5%B0%84/"
                        ><span class="tag">反射</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%90%88%E8%82%A5/"
                        ><span class="tag">合肥</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"
                        ><span class="tag">并发编程</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"
                        ><span class="tag">微服务</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%9D%AD%E5%B7%9E/"
                        ><span class="tag">杭州</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%9E%B6%E6%9E%84/"
                        ><span class="tag">架构</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%A1%86%E6%9E%B6/"
                        ><span class="tag">框架</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%B3%9B%E5%9E%8B/"
                        ><span class="tag">泛型</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"
                        ><span class="tag">注册中心</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%B6%88%E6%81%AF/"
                        ><span class="tag">消息</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD/"
                        ><span class="tag">类加载</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"
                        ><span class="tag">线程池</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE/"
                        ><span class="tag">自动配置</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"
                        ><span class="tag">负载均衡</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%BF%90%E7%BB%B4/"
                        ><span class="tag">运维</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8/"
                        ><span class="tag">迭代器</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E9%85%8D%E7%BD%AE/"
                        ><span class="tag">配置</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E9%9B%86%E7%BE%A4%E9%80%89%E4%B8%BB/"
                        ><span class="tag">集群选主</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="column-right-shadow is-hidden-widescreen is-sticky"
            ></div>
          </div>
        </div>
      </div>
    </section>
    <footer class="footer">
      <div class="container">
        <div class="level">
          <div class="level-start">
            <a class="footer-logo is-block mb-2" href="/">J.Queue的技术博客</a>
            <p class="is-size-7">
              <span>&copy; 2022 J.Queue</span>  Powered by
              <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a
              > &amp; <a
                href="https://github.com/ppoffice/hexo-theme-icarus"
                target="_blank"
                rel="noopener"
                >Icarus</a
              ><br /><span id="busuanzi_container_site_uv"
                >共<span id="busuanzi_value_site_uv">0</span>个访客</span
              >
            </p>
          </div>
          <div class="level-end">
            <div class="field has-addons">
              <p class="control">
                <a
                  class="button is-transparent is-large"
                  target="_blank"
                  rel="noopener"
                  title="Download on GitHub"
                  href="https://github.com/glmapper"
                  ><i class="fab fa-github"></i
                ></a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
    <script>
      moment.locale('zh-CN')
    </script>
    <script>
      var IcarusThemeSettings = {
        article: {
          highlight: {
            clipboard: false,
            fold: '',
          },
        },
      }
    </script>
    <script src="/js/column.js"></script>
    <script src="/js/animation.js"></script>
    <a id="back-to-top" title="回到顶端" href="javascript:;"
      ><i class="fas fa-chevron-up"></i
    ></a>
    <script src="/js/back_to_top.js" defer></script>
    <!--!--><!--!--><!--!--><!--!-->
    <script
      src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"
      defer
    ></script>
    <script>
      window.addEventListener('load', () => {
        window.cookieconsent.initialise({
          type: 'info',
          theme: 'edgeless',
          static: false,
          position: 'bottom-left',
          content: {
            message: '此网站使用Cookie来改善您的体验。',
            dismiss: '知道了！',
            allow: '允许使用Cookie',
            deny: '拒绝',
            link: '了解更多',
            policy: 'Cookie政策',
            href: 'https://www.cookiesandyou.com/',
          },
          palette: {
            popup: {
              background: '#edeff5',
              text: '#838391',
            },
            button: {
              background: '#4b81e8',
            },
          },
        })
      })
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js"
      defer
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"
      defer
    ></script>
    <script>
      window.addEventListener('load', () => {
        if (typeof $.fn.lightGallery === 'function') {
          $('.article').lightGallery({ selector: '.gallery-item' })
        }
        if (typeof $.fn.justifiedGallery === 'function') {
          if ($('.justified-gallery > p > .gallery-item').length) {
            $('.justified-gallery > p > .gallery-item').unwrap()
          }
          $('.justified-gallery').justifiedGallery()
        }
      })
    </script>
    <!--!--><!--!--><!--!--><!--!--><!--!-->
    <script src="/js/main.js" defer></script>
    <div class="searchbox">
      <div class="searchbox-container">
        <div class="searchbox-header">
          <div class="searchbox-input-container">
            <input
              class="searchbox-input"
              type="text"
              placeholder="想要查找什么..."
            />
          </div>
          <a class="searchbox-close" href="javascript:;">×</a>
        </div>
        <div class="searchbox-body"></div>
      </div>
    </div>
    <script src="/js/insight.js" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        loadInsight(
          { contentUrl: '/content.json' },
          {
            hint: '想要查找什么...',
            untitled: '(无标题)',
            posts: '文章',
            pages: '页面',
            categories: '分类',
            tags: '标签',
          }
        )
      })
    </script>
  </body>
</html>
