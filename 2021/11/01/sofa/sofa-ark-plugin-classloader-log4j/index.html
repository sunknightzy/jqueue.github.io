<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta />
    <title>
      log4j2 日志 PatternLayout 配置对 SOFAArk PluginClassLoader 的影响 -
      J.Queue的技术博客
    </title>
    <link rel="manifest" href="/manifest.json" />
    <meta name="application-name" content="J.Queue的技术博客" />
    <meta name="msapplication-TileImage" content="/img/favicon.ico" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="J.Queue的技术博客" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta
      name="description"
      content="log4j2 相关类在 sofaark 插件中是导出的，因此当出现 log4j2 的类需要被加载时，会委托给 PluginClassLoader 进行加载。"
    />
    <meta property="og:type" content="blog" />
    <meta
      property="og:title"
      content="log4j2 日志 PatternLayout 配置对 SOFAArk PluginClassLoader 的影响"
    />
    <meta
      property="og:url"
      content="http://www.glmapper.com/2021/11/01/sofa/sofa-ark-plugin-classloader-log4j/"
    />
    <meta property="og:site_name" content="J.Queue的技术博客" />
    <meta
      property="og:description"
      content="log4j2 相关类在 sofaark 插件中是导出的，因此当出现 log4j2 的类需要被加载时，会委托给 PluginClassLoader 进行加载。"
    />
    <meta property="og:locale" content="zh_CN" />
    <meta
      property="og:image"
      content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d885a3270e2f4df8abe25c5fac5bfa62~tplv-k3u1fbpfcp-watermark.image"
    />
    <meta
      property="og:image"
      content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b51cda273db74d9097054b9f085e604f~tplv-k3u1fbpfcp-watermark.image"
    />
    <meta
      property="og:image"
      content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b1962881d1649bdb5b7086c49e28fa1~tplv-k3u1fbpfcp-watermark.image"
    />
    <meta
      property="og:image"
      content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef1a773b19544abca7eb64c1ad16d103~tplv-k3u1fbpfcp-watermark.image"
    />
    <meta
      property="og:image"
      content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/08554a09b1144a7f9df05896cd24ee49~tplv-k3u1fbpfcp-watermark.image"
    />
    <meta
      property="article:published_time"
      content="2021-11-01T03:10:19.000Z"
    />
    <meta property="article:modified_time" content="2022-04-24T03:25:15.660Z" />
    <meta property="article:author" content="J.Queue" />
    <meta property="article:tag" content="SOFAArk" />
    <meta property="article:tag" content="ClassLoader" />
    <meta property="article:tag" content="类加载" />
    <meta property="article:tag" content="log" />
    <meta property="article:tag" content="gc" />
    <meta property="twitter:card" content="summary" />
    <meta
      property="twitter:image"
      content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d885a3270e2f4df8abe25c5fac5bfa62~tplv-k3u1fbpfcp-watermark.image"
    />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http://www.glmapper.com/2021/11/01/sofa/sofa-ark-plugin-classloader-log4j/"
        },
        "headline": "log4j2 日志 PatternLayout 配置对 SOFAArk PluginClassLoader 的影响",
        "image": [],
        "datePublished": "2021-11-01T03:10:19.000Z",
        "dateModified": "2022-04-24T03:25:15.660Z",
        "author": { "@type": "Person", "name": "J.Queue" },
        "publisher": {
          "@type": "Organization",
          "name": "J.Queue的技术博客",
          "logo": {
            "@type": "ImageObject",
            "url": { "text": "J.Queue的技术博客" }
          }
        },
        "description": "log4j2 相关类在 sofaark 插件中是导出的，因此当出现 log4j2 的类需要被加载时，会委托给 PluginClassLoader 进行加载。"
      }
    </script>
    <link
      rel="canonical"
      href="http://www.glmapper.com/2021/11/01/sofa/sofa-ark-plugin-classloader-log4j/"
    />
    <link rel="icon" href="/img/favicon.ico" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/github.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"
    />
    <link rel="stylesheet" href="/css/default.css" />
    <style>
      body > .footer,
      body > .navbar,
      body > .section {
        opacity: 0;
      }
    </style>
    <!--!-->
    <!--!-->
    <!--!-->
    <script
      src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"
      defer
    ></script>
    <!--!-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"
    />
    <!--!-->
    <!--!-->
    <style>
      .pace {
        -webkit-pointer-events: none;
        pointer-events: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }
      .pace-inactive {
        display: none;
      }
      .pace .pace-progress {
        background: #3273dc;
        position: fixed;
        z-index: 2000;
        top: 0;
        right: 100%;
        width: 100%;
        height: 2px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script>
    <!--!-->
    <!--!-->
    <!-- hexo injector head_end start -->
    <script>
      ;(function () {
        function switchTab() {
          if (!location.hash) {
            return
          }
          Array.from(document.querySelectorAll('.tab-content')).forEach(
            ($tab) => {
              $tab.classList.add('is-hidden')
            }
          )
          Array.from(document.querySelectorAll('.tabs li')).forEach(($tab) => {
            $tab.classList.remove('is-active')
          })
          const $activeTab = document.querySelector(location.hash)
          if ($activeTab) {
            $activeTab.classList.remove('is-hidden')
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`)
          if ($tabMenu) {
            $tabMenu.parentElement.classList.add('is-active')
          }
        }
        switchTab()
        window.addEventListener('hashchange', switchTab, false)
      })()
    </script>
    <!-- hexo injector head_end end -->
    <meta name="generator" content="Hexo 6.1.0" />
    <link
      rel="alternate"
      href="/atom.xml"
      title="J.Queue的技术博客"
      type="application/atom+xml"
    />
  </head>
  <body class="is-3-column">
    <nav class="navbar navbar-main">
      <div class="container navbar-container">
        <div class="navbar-brand justify-content-center">
          <a class="navbar-item navbar-logo" href="/">J.Queue的技术博客</a>
        </div>
        <div class="navbar-menu">
          <div class="navbar-start">
            <a class="navbar-item" href="/">首页</a
            ><a class="navbar-item" href="/archives">归档</a
            ><a class="navbar-item" href="/categories">分类</a
            ><a class="navbar-item" href="/tags">Tags</a
            ><a class="navbar-item" href="/about">关于</a>
          </div>
          <div class="navbar-end">
            <a
              class="navbar-item"
              target="_blank"
              rel="noopener"
              title="Download on GitHub"
              href="https://github.com/glmapper"
              ><i class="fab fa-github"></i></a
            ><a
              class="navbar-item is-hidden-tablet catalogue"
              title="目录"
              href="javascript:;"
              ><i class="fas fa-list-ul"></i></a
            ><a class="navbar-item search" title="搜索" href="javascript:;"
              ><i class="fas fa-search"></i
            ></a>
          </div>
        </div>
      </div>
    </nav>
    <section class="section">
      <div class="container">
        <div class="columns">
          <div
            class="column order-2 column-main is-8-tablet is-8-desktop is-10-widescreen"
          >
            <div class="card">
              <article class="card-content article" role="article">
                <div
                  class="article-meta is-size-7 is-uppercase level is-mobile"
                >
                  <div class="level-left">
                    <span class="level-item"
                      ><time
                        datetime="2021-11-01T03:10:19.000Z"
                        title="2021/11/1 上午11:10:19"
                        >2021-11-01</time
                      >发表</span
                    ><span class="level-item"
                      ><time
                        datetime="2022-04-24T03:25:15.660Z"
                        title="2022/4/24 上午11:25:15"
                        >2022-04-24</time
                      >更新</span
                    ><span class="level-item"
                      ><a class="link-muted" href="/categories/SOFA/"
                        >SOFA</a
                      ></span
                    ><span class="level-item">15 分钟读完 (大约2179个字)</span
                    ><span class="level-item" id="busuanzi_container_page_pv"
                      ><span id="busuanzi_value_page_pv">0</span>次访问</span
                    >
                  </div>
                </div>
                <h1 class="title is-3 is-size-4-mobile">
                  log4j2 日志 PatternLayout 配置对 SOFAArk PluginClassLoader
                  的影响
                </h1>
                <div class="content">
                  <p>
                    log4j2 相关类在 sofaark 插件中是导出的，因此当出现 log4j2
                    的类需要被加载时，会委托给 PluginClassLoader 进行加载。
                  </p>
                  <span id="more"></span>

                  <h2 id="背景">
                    <a href="#背景" class="headerlink" title="背景"></a>背景
                  </h2>
                  <figure class="highlight plaintext">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&quot;Log4j2-TF-7-AsyncLoggerConfig-8&quot; Id=52 BLOCKED on sun.misc.URLClassPath@26eb1b56 owned by &quot;Log4j2-TF-7-AsyncLoggerConfig-4&quot; Id=17</span><br><span class="line">    at sun.misc.URLClassPath.getNextLoader(URLClassPath.java:479)</span><br><span class="line">    -  blocked on sun.misc.URLClassPath@26eb1b56</span><br><span class="line">    at sun.misc.URLClassPath.getResource(URLClassPath.java:248)</span><br><span class="line">    at java.net.URLClassLoader$1.run(URLClassLoader.java:366)</span><br><span class="line">    at java.net.URLClassLoader$1.run(URLClassLoader.java:363)</span><br><span class="line">    at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">    at java.net.URLClassLoader.findClass(URLClassLoader.java:362)</span><br><span class="line">    at java.lang.ClassLoader.loadClass(ClassLoader.java:448)</span><br><span class="line">    at com.alipay.sofa.ark.container.service.classloader.AbstractClasspathClassLoader.resolveLocalClass(AbstractClasspathClassLoader.java:302)</span><br><span class="line">    at com.alipay.sofa.ark.container.service.classloader.PluginClassLoader.loadClassInternal(PluginClassLoader.java:102)</span><br><span class="line">	  // 插件加载  </span><br><span class="line">		at com.alipay.sofa.ark.container.service.classloader.AbstractClasspathClassLoader.loadClass(AbstractClasspathClassLoader.java:71)</span><br><span class="line">    at java.lang.ClassLoader.loadClass(ClassLoader.java:380)</span><br><span class="line">    at org.apache.logging.log4j.core.impl.ThrowableProxy.loadClass(ThrowableProxy.java:563)</span><br><span class="line">    at org.apache.logging.log4j.core.impl.ThrowableProxy.toExtendedStackTrace(ThrowableProxy.java:689)</span><br><span class="line">    at org.apache.logging.log4j.core.impl.ThrowableProxy.&lt;init&gt;(ThrowableProxy.java:138)</span><br><span class="line">    at org.apache.logging.log4j.core.impl.ThrowableProxy.&lt;init&gt;(ThrowableProxy.java:122)</span><br><span class="line">    at org.apache.logging.log4j.core.impl.Log4jLogEvent.getThrownProxy(Log4jLogEvent.java:564)</span><br><span class="line">    at org.apache.logging.log4j.core.pattern.ExtendedThrowablePatternConverter.format(ExtendedThrowablePatternConverter.java:63)</span><br><span class="line">    at org.apache.logging.log4j.core.pattern.PatternFormatter.format(PatternFormatter.java:38)</span><br><span class="line">    at org.apache.logging.log4j.core.layout.PatternLayout$PatternSerializer.toSerializable(PatternLayout.java:333)</span><br><span class="line">    at org.apache.logging.log4j.core.layout.PatternLayout.toText(PatternLayout.java:232)</span><br><span class="line">    at org.apache.logging.log4j.core.layout.PatternLayout.encode(PatternLayout.java:217)</span><br><span class="line">    at org.apache.logging.log4j.core.layout.PatternLayout.encode(PatternLayout.java:57)</span><br><span class="line">    at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.directEncodeEvent(AbstractOutputStreamAppender.java:177)</span><br><span class="line">    at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.tryAppend(AbstractOutputStreamAppender.java:170)</span><br><span class="line">    at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:161)</span><br><span class="line">    at org.apache.logging.log4j.core.appender.RollingFileAppender.append(RollingFileAppender.java:268)</span><br><span class="line">    at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:156)</span><br><span class="line">    at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:129)</span><br><span class="line">    at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:120)</span><br><span class="line">    at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:84)</span><br><span class="line">    at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:448)</span><br><span class="line">    at org.apache.logging.log4j.core.async.AsyncLoggerConfig.asyncCallAppenders(AsyncLoggerConfig.java:115)</span><br><span class="line">    at org.apache.logging.log4j.core.async.AsyncLoggerConfigDisruptor$Log4jEventWrapperHandler.onEvent(AsyncLoggerConfigDisruptor.java:112)</span><br><span class="line">    at org.apache.logging.log4j.core.async.AsyncLoggerConfigDisruptor$Log4jEventWrapperHandler.onEvent(AsyncLoggerConfigDisruptor.java:98)</span><br><span class="line">    at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:128)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1152)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:627)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:861)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    log4j2 相关类在 sofaark 插件中是导出的，因此当出现 log4j2
                    的类需要被加载时，会委托给 PluginClassLoader 进行加载。
                  </p>
                  <h2
                    id="PatternLayout-中配置-throwable-对于产生不同-Converter-的影响"
                  >
                    <a
                      href="#PatternLayout-中配置-throwable-对于产生不同-Converter-的影响"
                      class="headerlink"
                      title="PatternLayout 中配置 %throwable 对于产生不同 Converter 的影响"
                    ></a
                    >PatternLayout 中配置 %throwable 对于产生不同 Converter
                    的影响
                  </h2>
                  <p>SOFABoot 开始执行加载 log4j2 的配置文件</p>
                  <p>
                    <img
                      src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d885a3270e2f4df8abe25c5fac5bfa62~tplv-k3u1fbpfcp-watermark.image"
                      alt="image.png"
                    />
                  </p>
                  <p>
                    解析配置文件，并根据 PatternLayout 中的各个配置创建不同的 pc
                  </p>
                  <p>
                    <img
                      src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b51cda273db74d9097054b9f085e604f~tplv-k3u1fbpfcp-watermark.image"
                      alt="image.png"
                    />
                  </p>
                  <p>规则映射列表</p>
                  <p>
                    <img
                      src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b1962881d1649bdb5b7086c49e28fa1~tplv-k3u1fbpfcp-watermark.image"
                      alt="image.png"
                    />
                  </p>
                  <p>
                    找到对应 Converter，然后通过反射创建此对象，然后放在
                    patternConverters 中去。
                  </p>
                  <p>
                    <img
                      src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef1a773b19544abca7eb64c1ad16d103~tplv-k3u1fbpfcp-watermark.image"
                      alt="image.png"
                    />
                  </p>
                  <h2
                    id="什么情况下会产生-ExtendedThrowablePatternConverter-？"
                  >
                    <a
                      href="#什么情况下会产生-ExtendedThrowablePatternConverter-？"
                      class="headerlink"
                      title="什么情况下会产生 ExtendedThrowablePatternConverter ？"
                    ></a
                    >什么情况下会产生 ExtendedThrowablePatternConverter ？
                  </h2>
                  <p>这里有两个条件会产生这个 Converter</p>
                  <h3 id="配置-“xEx”-“xThrowable”-“xException”">
                    <a
                      href="#配置-“xEx”-“xThrowable”-“xException”"
                      class="headerlink"
                      title="配置 “xEx”, “xThrowable”, “xException”"
                    ></a
                    >配置 “xEx”, “xThrowable”, “xException”
                  </h3>
                  <p>
                    <img
                      src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/08554a09b1144a7f9df05896cd24ee49~tplv-k3u1fbpfcp-watermark.image"
                      alt="image.png"
                    />
                  </p>
                  <p>
                    log4j2 的配置文件中 PatternLayout 如果配置了 “xEx”,
                    “xThrowable”,
                    “xException”，由上面分析可以知道，解析时，rules
                    哪里匹配到对应 converterName，则会创建。
                  </p>
                  <h3 id="没有配置-throwable-时会创建">
                    <a
                      href="#没有配置-throwable-时会创建"
                      class="headerlink"
                      title="没有配置 %throwable 时会创建"
                    ></a
                    >没有配置 %throwable 时会创建
                  </h3>
                  <p>为什么？来看下一段代码：</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 给 PatternLayout 创建对应的 PatternFormatter，用于在输出日志时按指定的规则输出。</span></span><br><span class="line"><span class="comment">// PatternFormatter 执行 format 要依赖 Converter</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.alwaysWriteExceptions 默认为 true, 只能在配置文件中 配置修改。</span></span><br><span class="line"><span class="keyword">public</span> List&lt;PatternFormatter&gt; <span class="title function_">parse</span><span class="params">(<span class="keyword">final</span> String pattern, <span class="keyword">final</span> <span class="type">boolean</span> alwaysWriteExceptions,</span></span><br><span class="line"><span class="params">           <span class="keyword">final</span> <span class="type">boolean</span> disableAnsi, <span class="keyword">final</span> <span class="type">boolean</span> noConsoleNoAnsi)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> List&lt;PatternFormatter&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">final</span> List&lt;PatternConverter&gt; converters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">final</span> List&lt;FormattingInfo&gt; fields = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    parse(pattern, converters, fields, disableAnsi, noConsoleNoAnsi, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Iterator&lt;FormattingInfo&gt; fieldIter = fields.iterator();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">handlesThrowable</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="comment">// 当前 Logger 对应的所有 converters 集合，这里的 converters 是从上面 parse pattern 时按照 </span></span><br><span class="line">    <span class="comment">// pattern 的 style 生成的，</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">final</span> PatternConverter converter : converters) &#123;</span><br><span class="line">        <span class="keyword">if</span> (converter <span class="keyword">instanceof</span> NanoTimePatternConverter) &#123;</span><br><span class="line">            <span class="comment">// LOG4J2-1074 Switch to actual clock if nanosecond timestamps are required in config.</span></span><br><span class="line">            <span class="comment">// LOG4J2-1248 set config nanoclock</span></span><br><span class="line">            <span class="keyword">if</span> (config != <span class="literal">null</span>) &#123;</span><br><span class="line">                config.setNanoClock(<span class="keyword">new</span> <span class="title class_">SystemNanoClock</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        LogEventPatternConverter pc;</span><br><span class="line">        <span class="keyword">if</span> (converter <span class="keyword">instanceof</span> LogEventPatternConverter) &#123; </span><br><span class="line">            pc = (LogEventPatternConverter) converter;</span><br><span class="line">            <span class="comment">// 目前官方提供的 converte在，还有 Throwable 的  handlesThrowable 返回是 true</span></span><br><span class="line">            <span class="comment">// 所以，如果 pattern 中没有 %throwable, 这里会一直返回的都是 false</span></span><br><span class="line">            handlesThrowable |= pc.handlesThrowable();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            pc = <span class="keyword">new</span> <span class="title class_">LiteralPatternConverter</span>(config, Strings.EMPTY, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        FormattingInfo field;</span><br><span class="line">        <span class="keyword">if</span> (fieldIter.hasNext()) &#123;</span><br><span class="line">            field = fieldIter.next();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            field = FormattingInfo.getDefault();</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">PatternFormatter</span>(pc, field));</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// alwaysWriteExceptions = true</span></span><br><span class="line">    <span class="comment">// handlesThrowable 在配置 %throwable 时是 true，其他均为 false</span></span><br><span class="line">    <span class="comment">// 也就是说当前 Logger 没有配置 %throwable 时，就会创建 ExtendedThrowablePatternConverter</span></span><br><span class="line">    <span class="comment">// 作为默认的异常处理 Converter</span></span><br><span class="line">    <span class="keyword">if</span> (alwaysWriteExceptions &amp;&amp; !handlesThrowable) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">LogEventPatternConverter</span> <span class="variable">pc</span> <span class="operator">=</span> ExtendedThrowablePatternConverter.newInstance(config, <span class="literal">null</span>);</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">PatternFormatter</span>(pc, FormattingInfo.getDefault()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    结论：<strong
                      >根据 pattern 中的不同元素类型，产生不同类型的
                      PatternConverter，如果在日志文件中配置了 %throwable ,
                      则会对应产生一个 ThrowablePatternConverter 类型的
                      PatternConverter。如果没有配置 %throwable，则默认使用
                      ExtendedThrowablePatternConverter</strong
                    >。
                  </p>
                  <h2 id="converter-差异分析">
                    <a
                      href="#converter-差异分析"
                      class="headerlink"
                      title="converter 差异分析"
                    ></a
                    >converter 差异分析
                  </h2>
                  <p>
                    不同 PatternConverter 的作用是在日志输出时做相应数据的
                    format，所以对应 PatternConverter 来说，核心的方法就是
                    format 方法。下面看 ThrowablePatternConverter 和
                    ExtendedThrowablePatternConverter 的 format 方法差异。
                  </p>
                  <h3 id="ThrowablePatternConverter-format">
                    <a
                      href="#ThrowablePatternConverter-format"
                      class="headerlink"
                      title="ThrowablePatternConverter#format"
                    ></a
                    >ThrowablePatternConverter#format
                  </h3>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">format</span><span class="params">(<span class="keyword">final</span> LogEvent event, <span class="keyword">final</span> StringBuilder buffer)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Throwable</span> <span class="variable">t</span> <span class="operator">=</span> event.getThrown();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isSubShortOption()) &#123;</span><br><span class="line">        formatSubShortOption(t, getSuffix(event), buffer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (t != <span class="literal">null</span> &amp;&amp; options.anyLines()) &#123;</span><br><span class="line">        formatOption(t, getSuffix(event), buffer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    formatOption 就是把 Throwable 的 stackTracer 写到 buffer 中
                  </p>
                  <h3 id="ExtendedThrowablePatternConverter-format">
                    <a
                      href="#ExtendedThrowablePatternConverter-format"
                      class="headerlink"
                      title="ExtendedThrowablePatternConverter#format"
                    ></a
                    >ExtendedThrowablePatternConverter#format
                  </h3>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">format</span><span class="params">(<span class="keyword">final</span> LogEvent event, <span class="keyword">final</span> StringBuilder toAppendTo)</span> &#123;</span><br><span class="line">    <span class="comment">// 这里多了一个 getThrownProxy</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ThrowableProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> event.getThrownProxy();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Throwable</span> <span class="variable">throwable</span> <span class="operator">=</span> event.getThrown();</span><br><span class="line">    <span class="keyword">if</span> ((throwable != <span class="literal">null</span> || proxy != <span class="literal">null</span>) &amp;&amp; options.anyLines()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (proxy == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">super</span>.format(event, toAppendTo);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> getSuffix(event);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">extStackTrace</span> <span class="operator">=</span> proxy.getExtendedStackTraceAsString(options.getIgnorePackages(), options.getTextRenderer(), suffix);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> toAppendTo.length();</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span> &amp;&amp; !Character.isWhitespace(toAppendTo.charAt(len - <span class="number">1</span>))) &#123;</span><br><span class="line">            toAppendTo.append(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!options.allLines() || !Strings.LINE_SEPARATOR.equals(options.getSeparator())) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">final</span> String[] array = extStackTrace.split(Strings.LINE_SEPARATOR);</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">limit</span> <span class="operator">=</span> options.minLines(array.length) - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= limit; ++i) &#123;</span><br><span class="line">                sb.append(array[i]);</span><br><span class="line">                <span class="keyword">if</span> (i &lt; limit) &#123;</span><br><span class="line">                    sb.append(options.getSeparator());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            toAppendTo.append(sb.toString());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            toAppendTo.append(extStackTrace);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    <code
                      >final ThrowableProxy proxy = event.getThrownProxy()</code
                    >
                    结合最上面的异常堆栈来看，在构建 ThrowableProxy
                    对象实例时会去对堆栈中的数据进行序列化操作构建
                    CacheEntry（toExtendedStackTrace）,从而触发类加载动作。
                  </p>
                  <blockquote>
                    <p>
                      A proxy is used to represent a throwable that may not
                      exist in a different class loader or JVM. When an
                      application deserializes a ThrowableProxy, the throwable
                      may not be set, but the throwable’s information is
                      preserved in other fields of the proxy like the message
                      and stack trace.
                    </p>
                  </blockquote>
                  <h2 id="附1：Disruptor-消费者的等待策略">
                    <a
                      href="#附1：Disruptor-消费者的等待策略"
                      class="headerlink"
                      title="附1：Disruptor 消费者的等待策略"
                    ></a
                    >附1：Disruptor 消费者的等待策略
                  </h2>
                  <p>-DAsyncLoggerConfig.WaitStrategy&#x3D;xxx</p>
                  <table>
                    <thead>
                      <tr>
                        <th>名称</th>
                        <th>措施</th>
                        <th>场景</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>BlockingWaitStrategy</td>
                        <td>加锁</td>
                        <td>CPU资源紧缺，吞吐量和延迟并不重要的场景</td>
                      </tr>
                      <tr>
                        <td>BusySpinWaitStrategy</td>
                        <td>自旋</td>
                        <td>
                          通过不断重试，减少切换线程导致的系统调用，而降低延迟。推荐在线程绑定到固定的CPU的场景下使用
                        </td>
                      </tr>
                      <tr>
                        <td>PhasedBackoffWaitStrategy</td>
                        <td>自旋 + yield + 自定义策略</td>
                        <td>CPU资源紧缺，吞吐量和延迟并不重要的场景</td>
                      </tr>
                      <tr>
                        <td>SleepingWaitStrategy</td>
                        <td>自旋 + yield + sleep</td>
                        <td>性能和CPU资源之间有很好的折中。延迟不均匀</td>
                      </tr>
                      <tr>
                        <td>TimeoutBlockingWaitStrategy</td>
                        <td>加锁，有超时限制</td>
                        <td>CPU资源紧缺，吞吐量和延迟并不重要的场景</td>
                      </tr>
                      <tr>
                        <td>YieldingWaitStrategy</td>
                        <td>自旋 + yield + 自旋</td>
                        <td>性能和CPU资源之间有很好的折中。延迟比较均匀</td>
                      </tr>
                    </tbody>
                  </table>
                  <p>深色底纹为默认策略</p>
                  <h2 id="附2：Disruptor-队列长度并配置队列堵塞丢弃策略">
                    <a
                      href="#附2：Disruptor-队列长度并配置队列堵塞丢弃策略"
                      class="headerlink"
                      title="附2：Disruptor 队列长度并配置队列堵塞丢弃策略"
                    ></a
                    >附2：Disruptor 队列长度并配置队列堵塞丢弃策略
                  </h2>
                  <ul>
                    <li>
                      <p>
                        -Dlog4j2.AsyncQueueFullPolicy&#x3D;Default&#x2F;Discard
                          (默认 Default )
                      </p>
                    </li>
                    <li>
                      <p>
                        -Dlog4j2.DiscardThreshold&#x3D;ERROR&#x2F;INFO&#x2F;…  
                         （默认 info)
                      </p>
                    </li>
                  </ul>
                  <h3
                    id="1、DefaultAsyncQueueFullPolicy—等待队列，转为同步操作策略-默认"
                  >
                    <a
                      href="#1、DefaultAsyncQueueFullPolicy—等待队列，转为同步操作策略-默认"
                      class="headerlink"
                      title="1、DefaultAsyncQueueFullPolicy—等待队列，转为同步操作策略(默认)"
                    ></a
                    >1、DefaultAsyncQueueFullPolicy—等待队列，转为同步操作策略(默认)
                  </h3>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultAsyncQueueFullPolicy</span> <span class="keyword">implements</span> <span class="title class_">AsyncQueueFullPolicy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> EventRoute <span class="title function_">getRoute</span><span class="params">(<span class="keyword">final</span> <span class="type">long</span> backgroundThreadId, <span class="keyword">final</span> Level level)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// LOG4J2-1518: prevent deadlock when RingBuffer is full and object being logged calls</span></span><br><span class="line">        <span class="comment">// Logger.log in application thread</span></span><br><span class="line">        <span class="comment">// See also LOG4J2-471: prevent deadlock when RingBuffer is full and object</span></span><br><span class="line">        <span class="comment">// being logged calls Logger.log() from its toString() method in background thread</span></span><br><span class="line">        <span class="keyword">return</span> EventRoute.SYNCHRONOUS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <h3
                    id="2、DiscardingAsyncQueueFullPolicy—按照日志等级抛弃日志策略"
                  >
                    <a
                      href="#2、DiscardingAsyncQueueFullPolicy—按照日志等级抛弃日志策略"
                      class="headerlink"
                      title="2、DiscardingAsyncQueueFullPolicy—按照日志等级抛弃日志策略"
                    ></a
                    >2、DiscardingAsyncQueueFullPolicy—按照日志等级抛弃日志策略
                  </h3>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> EventRoute <span class="title function_">getRoute</span><span class="params">(<span class="keyword">final</span> <span class="type">long</span> backgroundThreadId, <span class="keyword">final</span> Level level)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (level.isLessSpecificThan(thresholdLevel)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (discardCount.getAndIncrement() == <span class="number">0</span>) &#123;</span><br><span class="line">            LOGGER.warn(<span class="string">&quot;Async queue is full, discarding event with level &#123;&#125;. &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;This message will only appear once; future events from &#123;&#125; &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;are silently discarded until queue capacity becomes available.&quot;</span>,</span><br><span class="line">                        level, thresholdLevel);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> EventRoute.DISCARD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getRoute(backgroundThreadId, level);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <h2 id="附3：Disruptor-默认队列大小">
                    <a
                      href="#附3：Disruptor-默认队列大小"
                      class="headerlink"
                      title="附3：Disruptor 默认队列大小"
                    ></a
                    >附3：Disruptor 默认队列大小
                  </h2>
                  <ul>
                    <li>-DAsyncLogger.RingBufferSize&#x3D;xxx</li>
                  </ul>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// propertyName -&gt; AsyncLoggerConfig.RingBufferSize</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculateRingBufferSize</span><span class="params">(<span class="keyword">final</span> String propertyName)</span> &#123;</span><br><span class="line">    <span class="comment">// Constants.ENABLE_THREADLOCALS 默认 false</span></span><br><span class="line">    <span class="comment">// RINGBUFFER_NO_GC_DEFAULT_SIZE 4096</span></span><br><span class="line">    <span class="comment">// 256 * 1024=262144</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ringBufferSize</span> <span class="operator">=</span> Constants.ENABLE_THREADLOCALS ? RINGBUFFER_NO_GC_DEFAULT_SIZE : RINGBUFFER_DEFAULT_SIZE;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">userPreferredRBSize</span> <span class="operator">=</span> PropertiesUtil.getProperties().getStringProperty(propertyName,</span><br><span class="line">                                                                                        String.valueOf(ringBufferSize));</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> Integer.parseInt(userPreferredRBSize);</span><br><span class="line">        <span class="comment">// RINGBUFFER_MIN_SIZE=128</span></span><br><span class="line">        <span class="keyword">if</span> (size &lt; RINGBUFFER_MIN_SIZE) &#123;</span><br><span class="line">            size = RINGBUFFER_MIN_SIZE;</span><br><span class="line">            LOGGER.warn(<span class="string">&quot;Invalid RingBufferSize &#123;&#125;, using minimum size &#123;&#125;.&quot;</span>, userPreferredRBSize,</span><br><span class="line">                        RINGBUFFER_MIN_SIZE);</span><br><span class="line">        &#125;</span><br><span class="line">        ringBufferSize = size;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception ex) &#123;</span><br><span class="line">        LOGGER.warn(<span class="string">&quot;Invalid RingBufferSize &#123;&#125;, using default size &#123;&#125;.&quot;</span>, userPreferredRBSize, ringBufferSize);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Integers.ceilingNextPowerOfTwo(ringBufferSize);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>

                  <p>
                    Constants.ENABLE_THREADLOCALS 这个值分为 web 和 非 web
                    应用两种情况，非 web 应用时，默认是 true，web 应用默认是
                    false，判断依据是，classpath 是否有 javax.servlet.Servlet
                    类。可以通过
                    <code>-Dlog4j2.is.webapp=true/false</code> 来手动设定。
                  </p>
                  <blockquote>
                    <p>
                      ps: -Dlog4j2.enable.threadlocals：  This system property
                      can be used to switch off the use of threadlocals, which
                      will partly disable Log4j’s garbage-free behaviour: to be
                      fully garbage-free, Log4j stores objects in ThreadLocal
                      fields to reuse them, otherwise new objects are created
                      for each log event. Note that this property is not
                      effective when Log4j detects it is running in a web
                      application.
                    </p>
                  </blockquote>
                </div>
                <div class="article-licensing box">
                  <div class="licensing-title">
                    <p>
                      log4j2 日志 PatternLayout 配置对 SOFAArk PluginClassLoader
                      的影响
                    </p>
                    <p>
                      <a
                        href="http://www.glmapper.com/2021/11/01/sofa/sofa-ark-plugin-classloader-log4j/"
                        >http://www.glmapper.com/2021/11/01/sofa/sofa-ark-plugin-classloader-log4j/</a
                      >
                    </p>
                  </div>
                  <div class="licensing-meta level is-mobile">
                    <div class="level-left">
                      <div class="level-item is-narrow">
                        <div>
                          <h6>作者</h6>
                          <p>J.Queue</p>
                        </div>
                      </div>
                      <div class="level-item is-narrow">
                        <div>
                          <h6>发布于</h6>
                          <p>2021-11-01</p>
                        </div>
                      </div>
                      <div class="level-item is-narrow">
                        <div>
                          <h6>更新于</h6>
                          <p>2022-04-24</p>
                        </div>
                      </div>
                      <div class="level-item is-narrow">
                        <div>
                          <h6>许可协议</h6>
                          <p>
                            <a
                              class="icons"
                              rel="noopener"
                              target="_blank"
                              title="Creative Commons"
                              href="https://creativecommons.org/"
                              ><i class="icon fab fa-creative-commons"></i
                            ></a>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="article-tags is-size-7 mb-4">
                  <span class="mr-2">#</span
                  ><a class="link-muted mr-2" rel="tag" href="/tags/SOFAArk/"
                    >SOFAArk</a
                  ><a
                    class="link-muted mr-2"
                    rel="tag"
                    href="/tags/ClassLoader/"
                    >ClassLoader</a
                  ><a
                    class="link-muted mr-2"
                    rel="tag"
                    href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD/"
                    >类加载</a
                  ><a class="link-muted mr-2" rel="tag" href="/tags/log/">log</a
                  ><a class="link-muted mr-2" rel="tag" href="/tags/gc/">gc</a>
                </div>
                <!--!-->
              </article>
            </div>
            <div class="card">
              <div class="card-content">
                <h3 class="menu-label has-text-centered">
                  喜欢这篇文章？打赏一下作者吧
                </h3>
                <div class="buttons is-centered">
                  <a class="button donate" data-type="alipay"
                    ><span class="icon is-small"
                      ><i class="fab fa-alipay"></i></span
                    ><span>支付宝</span
                    ><span class="qrcode"
                      ><img src="/img/zfb.JPG" alt="支付宝" /></span></a
                  ><a class="button donate" data-type="wechat"
                    ><span class="icon is-small"
                      ><i class="fab fa-weixin"></i></span
                    ><span>微信</span
                    ><span class="qrcode"
                      ><img src="/img/pay.JPG" alt="微信" /></span
                  ></a>
                </div>
              </div>
            </div>
            <nav class="post-navigation mt-4 level is-mobile">
              <div class="level-start">
                <a
                  class="article-nav-prev level level-item link-muted"
                  href="/2021/11/02/java/java-advance-gc-finalize/"
                  ><i class="level-item fas fa-chevron-left"></i
                  ><span class="level-item"
                    >finalize 方法重写对 GC 的影响分析</span
                  ></a
                >
              </div>
              <div class="level-end">
                <a
                  class="article-nav-next level level-item link-muted"
                  href="/2021/07/25/share/shares-sofa-meetup-7/"
                  ><span class="level-item"
                    >记：SOFA Meepup 合肥站-SOFA 微服务体系技术生态于实践</span
                  ><i class="level-item fas fa-chevron-right"></i
                ></a>
              </div>
            </nav>
            <div class="card">
              <div class="card-content">
                <h3 class="title is-5">评论</h3>
                <div id="comment-container"></div>
                <link
                  rel="stylesheet"
                  href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"
                />
                <script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
                <script>
                  var gitalk = new Gitalk({
                    id: '88c425adfc36385f46fce75a119c725a',
                    repo: 'glmapper.github.io',
                    owner: 'glmapper',
                    clientID: 'd25147ddf77e70d7adfe',
                    clientSecret: 'c10bbd1ba7a09c96e4106709107d4da85d60be78',
                    admin: ['glmapper'],
                    createIssueManually: false,
                    distractionFreeMode: true,
                    perPage: 20,
                    pagerDirection: 'last',

                    enableHotKey: true,
                    language: 'zh-CN',
                  })
                  gitalk.render('comment-container')
                </script>
              </div>
            </div>
          </div>
          <div
            class="column column-left is-4-tablet is-4-desktop is-3-widescreen order-1 is-sticky"
          >
            <div class="card widget" data-type="profile">
              <div class="card-content">
                <nav class="level">
                  <div class="level-item has-text-centered flex-shrink-1">
                    <div>
                      <figure class="image is-128x128 mx-auto mb-2">
                        <img
                          class="avatar is-rounded"
                          src="/img/self.jpg"
                          alt="J.Queue"
                        />
                      </figure>
                      <p
                        class="title is-size-4 is-block"
                        style="line-height: inherit"
                      >
                        J.Queue
                      </p>
                      <p class="is-size-6 is-block">Java Developer</p>
                      <p class="is-size-6 is-flex justify-content-center">
                        <i class="fas fa-map-marker-alt mr-1"></i
                        ><span>HeFei AnHui</span>
                      </p>
                    </div>
                  </div>
                </nav>
                <nav class="level is-mobile">
                  <div class="level-item has-text-centered is-marginless">
                    <div>
                      <p class="heading">文章</p>
                      <a href="/archives"><p class="title">108</p></a>
                    </div>
                  </div>
                  <div class="level-item has-text-centered is-marginless">
                    <div>
                      <p class="heading">分类</p>
                      <a href="/categories"><p class="title">17</p></a>
                    </div>
                  </div>
                  <div class="level-item has-text-centered is-marginless">
                    <div>
                      <p class="heading">标签</p>
                      <a href="/tags"><p class="title">128</p></a>
                    </div>
                  </div>
                </nav>
                <div class="level">
                  <a
                    class="level-item button is-primary is-rounded"
                    href="https://github.com/glmapper"
                    target="_blank"
                    rel="noopener"
                    >关注我</a
                  >
                </div>
                <div class="level is-mobile is-multiline">
                  <a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="Github"
                    href="https://github.com/glmapper"
                    ><i class="fab fa-github"></i></a
                  ><a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="Twitter"
                    href="https://twitter.com"
                    ><i class="fab fa-twitter"></i></a
                  ><a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="weibo"
                    href="https://weibo.com/u/2412872703"
                    ><i class="fab fa-weibo"></i></a
                  ><a
                    class="level-item button is-transparent is-marginless"
                    target="_blank"
                    rel="noopener"
                    title="RSS"
                    href="/atom.xml"
                    ><i class="fas fa-rss"></i
                  ></a>
                </div>
              </div>
            </div>
            <div class="card widget" data-type="links">
              <div class="card-content">
                <div class="menu">
                  <h3 class="menu-label">链接</h3>
                  <ul class="menu-list">
                    <li>
                      <a
                        class="level is-mobile"
                        href="https://juejin.cn/user/3227821827961806"
                        target="_blank"
                        rel="noopener"
                        ><span class="level-left"
                          ><span class="level-item">掘金社区</span></span
                        ><span class="level-right"
                          ><span class="level-item tag">juejin.cn</span></span
                        ></a
                      >
                    </li>
                    <li>
                      <a
                        class="level is-mobile"
                        href="https://www.sofastack.tech/"
                        target="_blank"
                        rel="noopener"
                        ><span class="level-left"
                          ><span class="level-item">SOFAStack</span></span
                        ><span class="level-right"
                          ><span class="level-item tag"
                            >www.sofastack.tech</span
                          ></span
                        ></a
                      >
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="card widget" id="toc" data-type="toc">
              <div class="card-content">
                <div class="menu">
                  <h3 class="menu-label">目录</h3>
                  <ul class="menu-list">
                    <li>
                      <a class="level is-mobile" href="#背景"
                        ><span class="level-left"
                          ><span class="level-item">1</span
                          ><span class="level-item">背景</span></span
                        ></a
                      >
                    </li>
                    <li>
                      <a
                        class="level is-mobile"
                        href="#PatternLayout-中配置-throwable-对于产生不同-Converter-的影响"
                        ><span class="level-left"
                          ><span class="level-item">2</span
                          ><span class="level-item"
                            >PatternLayout 中配置 %throwable 对于产生不同
                            Converter 的影响</span
                          ></span
                        ></a
                      >
                    </li>
                    <li>
                      <a
                        class="level is-mobile"
                        href="#什么情况下会产生-ExtendedThrowablePatternConverter-？"
                        ><span class="level-left"
                          ><span class="level-item">3</span
                          ><span class="level-item"
                            >什么情况下会产生 ExtendedThrowablePatternConverter
                            ？</span
                          ></span
                        ></a
                      >
                      <ul class="menu-list">
                        <li>
                          <a
                            class="level is-mobile"
                            href="#配置-“xEx”-“xThrowable”-“xException”"
                            ><span class="level-left"
                              ><span class="level-item">3.1</span
                              ><span class="level-item"
                                >配置 “xEx”, “xThrowable”, “xException”</span
                              ></span
                            ></a
                          >
                        </li>
                        <li>
                          <a
                            class="level is-mobile"
                            href="#没有配置-throwable-时会创建"
                            ><span class="level-left"
                              ><span class="level-item">3.2</span
                              ><span class="level-item"
                                >没有配置 %throwable 时会创建</span
                              ></span
                            ></a
                          >
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a class="level is-mobile" href="#converter-差异分析"
                        ><span class="level-left"
                          ><span class="level-item">4</span
                          ><span class="level-item"
                            >converter 差异分析</span
                          ></span
                        ></a
                      >
                      <ul class="menu-list">
                        <li>
                          <a
                            class="level is-mobile"
                            href="#ThrowablePatternConverter-format"
                            ><span class="level-left"
                              ><span class="level-item">4.1</span
                              ><span class="level-item"
                                >ThrowablePatternConverter#format</span
                              ></span
                            ></a
                          >
                        </li>
                        <li>
                          <a
                            class="level is-mobile"
                            href="#ExtendedThrowablePatternConverter-format"
                            ><span class="level-left"
                              ><span class="level-item">4.2</span
                              ><span class="level-item"
                                >ExtendedThrowablePatternConverter#format</span
                              ></span
                            ></a
                          >
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a
                        class="level is-mobile"
                        href="#附1：Disruptor-消费者的等待策略"
                        ><span class="level-left"
                          ><span class="level-item">5</span
                          ><span class="level-item"
                            >附1：Disruptor 消费者的等待策略</span
                          ></span
                        ></a
                      >
                    </li>
                    <li>
                      <a
                        class="level is-mobile"
                        href="#附2：Disruptor-队列长度并配置队列堵塞丢弃策略"
                        ><span class="level-left"
                          ><span class="level-item">6</span
                          ><span class="level-item"
                            >附2：Disruptor 队列长度并配置队列堵塞丢弃策略</span
                          ></span
                        ></a
                      >
                      <ul class="menu-list">
                        <li>
                          <a
                            class="level is-mobile"
                            href="#1、DefaultAsyncQueueFullPolicy—等待队列，转为同步操作策略-默认"
                            ><span class="level-left"
                              ><span class="level-item">6.1</span
                              ><span class="level-item"
                                >1、DefaultAsyncQueueFullPolicy—等待队列，转为同步操作策略(默认)</span
                              ></span
                            ></a
                          >
                        </li>
                        <li>
                          <a
                            class="level is-mobile"
                            href="#2、DiscardingAsyncQueueFullPolicy—按照日志等级抛弃日志策略"
                            ><span class="level-left"
                              ><span class="level-item">6.2</span
                              ><span class="level-item"
                                >2、DiscardingAsyncQueueFullPolicy—按照日志等级抛弃日志策略</span
                              ></span
                            ></a
                          >
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a
                        class="level is-mobile"
                        href="#附3：Disruptor-默认队列大小"
                        ><span class="level-left"
                          ><span class="level-item">7</span
                          ><span class="level-item"
                            >附3：Disruptor 默认队列大小</span
                          ></span
                        ></a
                      >
                    </li>
                  </ul>
                </div>
              </div>
              <script src="/js/toc.js" defer></script>
            </div>
            <div class="card widget" data-type="tags">
              <div class="card-content">
                <div class="menu">
                  <h3 class="menu-label">标签</h3>
                  <div class="field is-grouped is-grouped-multiline">
                    <div class="control">
                      <a class="tags has-addons" href="/tags/BeanDefinition/"
                        ><span class="tag">BeanDefinition</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/BeanPostProcessor/"
                        ><span class="tag">BeanPostProcessor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/BeanWrapper/"
                        ><span class="tag">BeanWrapper</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/CAS/"
                        ><span class="tag">CAS</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ClassLoader/"
                        ><span class="tag">ClassLoader</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/CopyOnWriteArraySet/"
                        ><span class="tag">CopyOnWriteArraySet</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Disruptor/"
                        ><span class="tag">Disruptor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Embedded-Tomcat/"
                        ><span class="tag">Embedded Tomcat</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Exception/"
                        ><span class="tag">Exception</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Executor/"
                        ><span class="tag">Executor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/FX-Application/"
                        ><span class="tag">FX Application</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/FatJar/"
                        ><span class="tag">FatJar</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Ioc/"
                        ><span class="tag">Ioc</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/JAR/"
                        ><span class="tag">JAR</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/JDK/"
                        ><span class="tag">JDK</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/JUC/"
                        ><span class="tag">JUC</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Kafka/"
                        ><span class="tag">Kafka</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/MANIFEST-MF/"
                        ><span class="tag">MANIFEST.MF</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Mockito/"
                        ><span class="tag">Mockito</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Mysql/"
                        ><span class="tag">Mysql</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/OOM/"
                        ><span class="tag">OOM</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/OpenTracing/"
                        ><span class="tag">OpenTracing</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/PropertySource/"
                        ><span class="tag">PropertySource</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Readiness-Check/"
                        ><span class="tag">Readiness Check</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ResourceLoader/"
                        ><span class="tag">ResourceLoader</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/RestTemplate/"
                        ><span class="tag">RestTemplate</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/RocketMQ/"
                        ><span class="tag">RocketMQ</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SOFA/"
                        ><span class="tag">SOFA</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SOFAArk/"
                        ><span class="tag">SOFAArk</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SOFAStack/"
                        ><span class="tag">SOFAStack</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/SpringBoot/"
                        ><span class="tag">SpringBoot</span
                        ><span class="tag">16</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/TestDouble/"
                        ><span class="tag">TestDouble</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/ThreadPoolExecutor/"
                        ><span class="tag">ThreadPoolExecutor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Tracer/"
                        ><span class="tag">Tracer</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/Zipkin/"
                        ><span class="tag">Zipkin</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ab-test/"
                        ><span class="tag">ab test</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/actuator/"
                        ><span class="tag">actuator</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/aop/"
                        ><span class="tag">aop</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/api/"
                        ><span class="tag">api</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/apollo/"
                        ><span class="tag">apollo</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/bean-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">bean 扩展机制</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"
                        ><span class="tag">bean 生命周期</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/bootstrap/"
                        ><span class="tag">bootstrap</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/cache/"
                        ><span class="tag">cache</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/classloader/"
                        ><span class="tag">classloader</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/config/"
                        ><span class="tag">config</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/cookie/"
                        ><span class="tag">cookie</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/curator/"
                        ><span class="tag">curator</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/docker/"
                        ><span class="tag">docker</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/eureka/"
                        ><span class="tag">eureka</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/event/"
                        ><span class="tag">event</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/feign/"
                        ><span class="tag">feign</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/gateway/"
                        ><span class="tag">gateway</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/gc/"
                        ><span class="tag">gc</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/git/"
                        ><span class="tag">git</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/github/"
                        ><span class="tag">github</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/guava/"
                        ><span class="tag">guava</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/http/"
                        ><span class="tag">http</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/hystrix/"
                        ><span class="tag">hystrix</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/java/"
                        ><span class="tag">java</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/junit/"
                        ><span class="tag">junit</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/jvm/"
                        ><span class="tag">jvm</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/kafka/"
                        ><span class="tag">kafka</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/linux/"
                        ><span class="tag">linux</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/lock/"
                        ><span class="tag">lock</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/log/"
                        ><span class="tag">log</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/logback/"
                        ><span class="tag">logback</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/maven/"
                        ><span class="tag">maven</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/maven-debug/"
                        ><span class="tag">maven debug</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/maven-plugin/"
                        ><span class="tag">maven plugin</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/merge/"
                        ><span class="tag">merge</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/microservices/"
                        ><span class="tag">microservices</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/mock/"
                        ><span class="tag">mock</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/mybatis/"
                        ><span class="tag">mybatis</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/mysql/"
                        ><span class="tag">mysql</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/nacos/"
                        ><span class="tag">nacos</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/namespace/"
                        ><span class="tag">namespace</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/netflix/"
                        ><span class="tag">netflix</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/nginx/"
                        ><span class="tag">nginx</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/oop-klass/"
                        ><span class="tag">oop-klass</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/reactor/"
                        ><span class="tag">reactor</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/rebase/"
                        ><span class="tag">rebase</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/redis/"
                        ><span class="tag">redis</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/rpc/"
                        ><span class="tag">rpc</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/session/"
                        ><span class="tag">session</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/set/"
                        ><span class="tag">set</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/shell/"
                        ><span class="tag">shell</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/slf4j/"
                        ><span class="tag">slf4j</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/spring/"
                        ><span class="tag">spring</span
                        ><span class="tag">11</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/spring-cloud/"
                        ><span class="tag">spring cloud</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/spring-mvc/"
                        ><span class="tag">spring mvc</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/spring-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">spring 扩展机制</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/sql/"
                        ><span class="tag">sql</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/ssh/"
                        ><span class="tag">ssh</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/starter-%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">starter 机制</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/test/"
                        ><span class="tag">test</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/testing/"
                        ><span class="tag">testing</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/thread/"
                        ><span class="tag">thread</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/tomcat/"
                        ><span class="tag">tomcat</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/top/"
                        ><span class="tag">top</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/typecheck/"
                        ><span class="tag">typecheck</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/yapi/"
                        ><span class="tag">yapi</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/yum/"
                        ><span class="tag">yum</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a class="tags has-addons" href="/tags/zookeeper/"
                        ><span class="tag">zookeeper</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E4%B8%AD%E5%8F%B0/"
                        ><span class="tag">中台</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/"
                        ><span class="tag">事件机制</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"
                        ><span class="tag">依赖注入</span
                        ><span class="tag">3</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"
                        ><span class="tag">分布式</span
                        ><span class="tag">6</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"
                        ><span class="tag">分布式链路跟踪</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"
                        ><span class="tag">反向代理</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%8F%8D%E5%B0%84/"
                        ><span class="tag">反射</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%90%88%E8%82%A5/"
                        ><span class="tag">合肥</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"
                        ><span class="tag">并发编程</span
                        ><span class="tag">5</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"
                        ><span class="tag">微服务</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%9D%AD%E5%B7%9E/"
                        ><span class="tag">杭州</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%9E%B6%E6%9E%84/"
                        ><span class="tag">架构</span
                        ><span class="tag">4</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%A1%86%E6%9E%B6/"
                        ><span class="tag">框架</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%B3%9B%E5%9E%8B/"
                        ><span class="tag">泛型</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"
                        ><span class="tag">注册中心</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E6%B6%88%E6%81%AF/"
                        ><span class="tag">消息</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD/"
                        ><span class="tag">类加载</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"
                        ><span class="tag">线程池</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE/"
                        ><span class="tag">自动配置</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"
                        ><span class="tag">负载均衡</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%BF%90%E7%BB%B4/"
                        ><span class="tag">运维</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8/"
                        ><span class="tag">迭代器</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E9%85%8D%E7%BD%AE/"
                        ><span class="tag">配置</span
                        ><span class="tag">2</span></a
                      >
                    </div>
                    <div class="control">
                      <a
                        class="tags has-addons"
                        href="/tags/%E9%9B%86%E7%BE%A4%E9%80%89%E4%B8%BB/"
                        ><span class="tag">集群选主</span
                        ><span class="tag">1</span></a
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="column-right-shadow is-hidden-widescreen is-sticky"
            ></div>
          </div>
        </div>
      </div>
    </section>
    <footer class="footer">
      <div class="container">
        <div class="level">
          <div class="level-start">
            <a class="footer-logo is-block mb-2" href="/">J.Queue的技术博客</a>
            <p class="is-size-7">
              <span>&copy; 2022 J.Queue</span>  Powered by
              <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a
              > &amp; <a
                href="https://github.com/ppoffice/hexo-theme-icarus"
                target="_blank"
                rel="noopener"
                >Icarus</a
              ><br /><span id="busuanzi_container_site_uv"
                >共<span id="busuanzi_value_site_uv">0</span>个访客</span
              >
            </p>
          </div>
          <div class="level-end">
            <div class="field has-addons">
              <p class="control">
                <a
                  class="button is-transparent is-large"
                  target="_blank"
                  rel="noopener"
                  title="Download on GitHub"
                  href="https://github.com/glmapper"
                  ><i class="fab fa-github"></i
                ></a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
    <script>
      moment.locale('zh-CN')
    </script>
    <script>
      var IcarusThemeSettings = {
        article: {
          highlight: {
            clipboard: false,
            fold: '',
          },
        },
      }
    </script>
    <script src="/js/column.js"></script>
    <script src="/js/animation.js"></script>
    <a id="back-to-top" title="回到顶端" href="javascript:;"
      ><i class="fas fa-chevron-up"></i
    ></a>
    <script src="/js/back_to_top.js" defer></script>
    <!--!--><!--!--><!--!--><!--!-->
    <script
      src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"
      defer
    ></script>
    <script>
      window.addEventListener('load', () => {
        window.cookieconsent.initialise({
          type: 'info',
          theme: 'edgeless',
          static: false,
          position: 'bottom-left',
          content: {
            message: '此网站使用Cookie来改善您的体验。',
            dismiss: '知道了！',
            allow: '允许使用Cookie',
            deny: '拒绝',
            link: '了解更多',
            policy: 'Cookie政策',
            href: 'https://www.cookiesandyou.com/',
          },
          palette: {
            popup: {
              background: '#edeff5',
              text: '#838391',
            },
            button: {
              background: '#4b81e8',
            },
          },
        })
      })
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js"
      defer
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"
      defer
    ></script>
    <script>
      window.addEventListener('load', () => {
        if (typeof $.fn.lightGallery === 'function') {
          $('.article').lightGallery({ selector: '.gallery-item' })
        }
        if (typeof $.fn.justifiedGallery === 'function') {
          if ($('.justified-gallery > p > .gallery-item').length) {
            $('.justified-gallery > p > .gallery-item').unwrap()
          }
          $('.justified-gallery').justifiedGallery()
        }
      })
    </script>
    <!--!--><!--!--><!--!--><!--!--><!--!-->
    <script src="/js/main.js" defer></script>
    <div class="searchbox">
      <div class="searchbox-container">
        <div class="searchbox-header">
          <div class="searchbox-input-container">
            <input
              class="searchbox-input"
              type="text"
              placeholder="想要查找什么..."
            />
          </div>
          <a class="searchbox-close" href="javascript:;">×</a>
        </div>
        <div class="searchbox-body"></div>
      </div>
    </div>
    <script src="/js/insight.js" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        loadInsight(
          { contentUrl: '/content.json' },
          {
            hint: '想要查找什么...',
            untitled: '(无标题)',
            posts: '文章',
            pages: '页面',
            categories: '分类',
            tags: '标签',
          }
        )
      })
    </script>
  </body>
</html>
