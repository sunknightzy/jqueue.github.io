<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>JVM 性能调优监控工具 - J.Queue的技术博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="J.Queue的技术博客"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="J.Queue的技术博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="本篇主要学习记录下工作中常用的 JDK 自带的一些 JVM 性能调优监控工具，通过了解这些工具，可以在排查问题时给予我们非常大的帮助，将一些隐藏在底下的东西拿到明面上来做分析。"><meta property="og:type" content="blog"><meta property="og:title" content="JVM 性能调优监控工具"><meta property="og:url" content="http://www.glmapper.com/2020/10/26/jvm/jvm-self-command/"><meta property="og:site_name" content="J.Queue的技术博客"><meta property="og:description" content="本篇主要学习记录下工作中常用的 JDK 自带的一些 JVM 性能调优监控工具，通过了解这些工具，可以在排查问题时给予我们非常大的帮助，将一些隐藏在底下的东西拿到明面上来做分析。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/jprofile.jpg"><meta property="og:image" content="https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/jvm/jhat.jpg"><meta property="og:image" content="https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/jvm/jhat-details.jpg"><meta property="article:published_time" content="2020-10-26T15:49:29.000Z"><meta property="article:modified_time" content="2022-04-23T01:51:50.369Z"><meta property="article:author" content="J.Queue"><meta property="article:tag" content="jvm"><meta property="article:tag" content="JDK"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/jprofile.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.glmapper.com/2020/10/26/jvm/jvm-self-command/"},"headline":"JVM 性能调优监控工具","image":["https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/jprofile.jpg","https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/jvm/jhat.jpg","https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/jvm/jhat-details.jpg"],"datePublished":"2020-10-26T15:49:29.000Z","dateModified":"2022-04-23T01:51:50.369Z","author":{"@type":"Person","name":"J.Queue"},"publisher":{"@type":"Organization","name":"J.Queue的技术博客","logo":{"@type":"ImageObject","url":{"text":"J.Queue的技术博客"}}},"description":"本篇主要学习记录下工作中常用的 JDK 自带的一些 JVM 性能调优监控工具，通过了解这些工具，可以在排查问题时给予我们非常大的帮助，将一些隐藏在底下的东西拿到明面上来做分析。"}</script><link rel="canonical" href="http://www.glmapper.com/2020/10/26/jvm/jvm-self-command/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/github.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="J.Queue的技术博客" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">J.Queue的技术博客</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/glmapper"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-10-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-10-26T15:49:29.000Z" title="2020/10/26 下午11:49:29">2020-10-26</time>发表</span><span class="level-item"><time dateTime="2022-04-23T01:51:50.369Z" title="2022/4/23 上午9:51:50">2022-04-23</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/jvm/">jvm</a></span><span class="level-item">26 分钟读完 (大约3825个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">JVM 性能调优监控工具</h1><div class="content"><p>本篇主要学习记录下工作中常用的 <code>JDK</code> 自带的一些 <code>JVM</code> 性能调优监控工具，通过了解这些工具，可以在排查问题时给予我们非常大的帮助，将一些隐藏在底下的东西拿到明面上来做分析。</p>
<span id="more"></span>

<h1 id="jps-Java-Virtual-Machine-Process-Status-Tool"><a href="#jps-Java-Virtual-Machine-Process-Status-Tool" class="headerlink" title="jps(Java Virtual Machine Process Status Tool)"></a>jps(Java Virtual Machine Process Status Tool)</h1><p><code>jps</code> 主要用来输出 <code>JVM</code> 中运行的进程状态信息。语法格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jps [options] [hostid]</span><br></pre></td></tr></table></figure>

<p>如果不指定 <code>hostid</code> 就默认为当前主机或服务器，命令行参数选项说明如下：</p>
<p><strong>-q 不输出类名、Jar名和传入main方法的参数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ jps -q</span><br><span class="line">42060</span><br></pre></td></tr></table></figure>

<p><strong>-m 输出传入 main 方法的参数(与默认 jps 指令返回的信息相同)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ jps -m</span><br><span class="line">42060 TestSofaBootApplication</span><br></pre></td></tr></table></figure>

<p><strong>-l 输出 main 类或 jar 的全限名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ jps -l</span><br><span class="line">42060 com.glmapper.bridge.boot.TestSofaBootApplication</span><br></pre></td></tr></table></figure>

<p><strong>-v 输出传入 JVM 的参数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ jps -v</span><br><span class="line">42060 TestSofaBootApplication -agentlib:jdwp=transport=dt_socket,address=127.0.0.1:51645,suspend=y,server=n -XX:TieredStopAtLevel=1 -Xverify:none -Dspring.output.ansi.enabled=always -Dcom.sun.management.jmxremote -Dspring.jmx.enabled=true -Dspring.liveBeansView.mbeanDomain -Dspring.application.admin.enabled=true -javaagent:/Users/xxxx/Library/Caches/JetBrains/IntelliJIdea2020.1/captureAgent/debugger-agent.jar -Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure>

<p>在排查问题时，我们通过都会通过 <code>jps</code> 来看下当前机器运行的进程有哪些，通过不同的参数来快速找到我们目标进程所在的 <code>pid</code>，以便于我们后续的一系列排查操作。</p>
<h1 id="jstack-Java-Stack-Trace"><a href="#jstack-Java-Stack-Trace" class="headerlink" title="jstack(Java Stack Trace)"></a>jstack(Java Stack Trace)</h1><p><strong>jstack</strong> 主要用来查看某个 <code>Java</code> 进程内的线程堆栈信息。如果 <code>java</code> 程序崩溃生成 <code>core</code> 文件，<code>jstack</code> 工具可以用来获得 <code>core</code> 文件的 <code>java stack</code> 和 <code>native stack</code> 的信息，从而可以轻松地知道 <code>java</code> 程序是如何崩溃和在程序何处发生问题。另外，<code>jstack</code> 工具还可以附属到正在运行的 <code>java</code> 程序中，看到当时运行的 <code>java</code> 程序的 <code>java stack</code> 和 <code>native stack</code> 的信息, 如果现在运行的 <code>java</code> 程序呈现 <code>hung</code> 的状态，<code>jstack</code> 是非常有用的。</p>
<p>下面是 <code>jstack</code> 语法格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jstack [option] pid</span><br><span class="line">jstack [option] executable core</span><br><span class="line">jstack [option] [server-id@]remote-hostname-or-ip</span><br></pre></td></tr></table></figure>

<p><strong>不管是什么指令，我们都要学会先通过 -h 去查一下</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ jstack -h</span><br><span class="line">Usage:</span><br><span class="line">    jstack [-l] &lt;pid&gt;</span><br><span class="line">        (连接到正在运行的进程)</span><br><span class="line">    jstack -F [-m] [-l] &lt;pid&gt;</span><br><span class="line">        (连接到挂起的进程)</span><br><span class="line">    jstack [-m] [-l] &lt;executable&gt; &lt;core&gt;</span><br><span class="line">        (连接到 core 文件)</span><br><span class="line">    jstack [-m] [-l] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (连接到远程调试服务器)</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    -F  to force a thread dump. Use when jstack &lt;pid&gt; does not respond (process is hung)</span><br><span class="line">    -m  to print both java and native frames (mixed mode)</span><br><span class="line">    -l  long listing. Prints additional information about locks</span><br><span class="line">    -h or -help to print this help message</span><br></pre></td></tr></table></figure>

<p><code>Options</code> 参数说明如下：</p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-F</td>
<td align="left">当正常输出的请求不被响应时，强制输出线程堆栈</td>
</tr>
<tr>
<td align="left">-m</td>
<td align="left">如果调用到本地方法的话，可以显示 C&#x2F;C++ 的堆栈</td>
</tr>
<tr>
<td align="left">-l</td>
<td align="left">除堆栈外，显示关于锁的附加信息，在发生死锁时可以用 jstack -l pid 来观察锁持有情况</td>
</tr>
</tbody></table>
<p>下面我们重点来聊一聊，<code>jstack</code> 中信息到底要怎么看。</p>
<h2 id="jstack-堆栈信息介绍"><a href="#jstack-堆栈信息介绍" class="headerlink" title="jstack 堆栈信息介绍"></a>jstack 堆栈信息介绍</h2><p>下面是 <code>jstack</code> 输出的一段 <code>tacer</code> 数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;main&quot; #1 prio=5 os_prio=31 tid=0x00007fb93b802000 nid=0x2703 waiting on condition [0x0000700005e5d000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class="line">	at java.lang.Thread.sleep(Native Method)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack.testWaitingOnConditionCondition(TestJstack.java:19)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack.main(TestJstack.java:10)</span><br></pre></td></tr></table></figure>

<p>通过这段数据我们大概能 <code>get</code> 到的点主要包括以下信息：</p>
<ul>
<li>main 线程名</li>
<li>#1 堆栈序号，没有实际含义，可忽略</li>
<li>prio 线程优先级</li>
<li>os_prio 操作系统层次的优先级</li>
<li>tid 线程标识</li>
<li>nid 线程id</li>
</ul>
<h2 id="线程状态介绍"><a href="#线程状态介绍" class="headerlink" title="线程状态介绍"></a>线程状态介绍</h2><p>从上面 jstack 输出的信息可以看到线程状态相关的信息，比如</p>
<h4 id="TIMED-WAITING"><a href="#TIMED-WAITING" class="headerlink" title="TIMED_WAITING"></a>TIMED_WAITING</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br></pre></td></tr></table></figure>

<h4 id="RUNNABLE"><a href="#RUNNABLE" class="headerlink" title="RUNNABLE"></a>RUNNABLE</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.Thread.State: RUNNABLE</span><br></pre></td></tr></table></figure>

<p>还有一些 <code>&quot;GC task thread#0 (ParallelGC)&quot; os_prio=31 tid=0x00007fcee9004000 nid=0x1f07 runnable</code> 信息，这种是 jvm 用来回收内存的，先不关注，这里主要看下 <code>java.lang.Thread.State</code>;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当线程对象创建时存在的状态，此时线程不可能执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    NEW,</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 当调用thread.start()后，线程变成为 Runnable 状态。只要得到CPU，就可以执行；</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    RUNNABLE,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果进入同步方法或同步代码块，没有获取到锁，则会进入该状态；</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BLOCKED,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行thread.join()或在锁对象调用obj.wait()等情况就会进该状态，表明线程正处于等待某个资源或条件发生来唤醒自己；</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    WAITING,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行Thread.sleep(long)、thread.join(long)或obj.wait(long)等就会进该状态，与Waiting的区别在于Timed_Waiting的等待有时间限制；</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TIMED_WAITING,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 终止</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TERMINATED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再回到上面堆栈信息，可以观察到，当状态是 TIMED_WAITING 时，堆栈中会出现 <code>waiting on condition xxxx</code> 信息，类似的还有：</p>
<ul>
<li>waiting on monitor entry : 在等待获取锁，一般对应 BLOCKED</li>
<li>in Object.wait() : 获取锁后又执行obj.wait()放弃锁，一般对应 WAITING</li>
</ul>
<p>下面就针对这些状态举一些简单的小例子。</p>
<h2 id="线程状态举例及-jstack-分析"><a href="#线程状态举例及-jstack-分析" class="headerlink" title="线程状态举例及 jstack 分析"></a>线程状态举例及 jstack 分析</h2><h3 id="waiting-on-condition"><a href="#waiting-on-condition" class="headerlink" title="waiting on condition"></a>waiting on condition</h3><p><strong>1、执行代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 产生 waiting on condition</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testWaitingOnConditionCondition</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">60000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、执行结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;main&quot; #1 prio=5 os_prio=31 tid=0x00007fb93b802000 nid=0x2703 waiting on condition [0x0000700005e5d000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class="line">	at java.lang.Thread.sleep(Native Method)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack.testWaitingOnConditionCondition(TestJstack.java:19)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack.main(TestJstack.java:10)</span><br></pre></td></tr></table></figure>

<p><strong>3、结果分析</strong></p>
<p>这里就比较明显的是 main 线程中正在 sleep 方法。不过这里 TIMED_WAITING 后面的括号里还特殊表明了 <code>sleeping</code>，在一些场景下，常见的还有 parking，下面继续看例子。</p>
<h3 id="waiting-on-condition-parking"><a href="#waiting-on-condition-parking" class="headerlink" title="waiting on condition (parking)"></a>waiting on condition (parking)</h3><p><strong>1、执行代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testWaitingOnConditionConditionWithParking</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 提供一个阻塞对了</span></span><br><span class="line">    BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;String&gt;(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 先加一个</span></span><br><span class="line">    blockingQueue.add(<span class="string">&quot;test-parking&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//继续加，这里肯定加不进去，所以会阻塞</span></span><br><span class="line">        blockingQueue.put(<span class="string">&quot;test-parking-xxx&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、执行结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;main&quot; #1 prio=5 os_prio=31 tid=0x00007fd6d5008800 nid=0x2803 waiting on condition [0x000070000ffc1000]</span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">	at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">	- parking to wait for  &lt;0x000000076af3a938&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)</span><br><span class="line">	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)</span><br><span class="line">	at java.util.concurrent.ArrayBlockingQueue.put(ArrayBlockingQueue.java:353)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack.testWaitingOnConditionConditionWithParking(TestJstack.java:113)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack.main(TestJstack.java:13)</span><br></pre></td></tr></table></figure>

<p><strong>3、结果分析</strong></p>
<p>main 线程进入了 waiting on conditon 状态，等待某一个资源，可以看到是在 <code>a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObjec</code> 进行了等待，阻塞住了。</p>
<h3 id="waiting-on-monitor-entry"><a href="#waiting-on-monitor-entry" class="headerlink" title="waiting on monitor entry"></a>waiting on monitor entry</h3><p><strong>1、执行代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 产生 waiting on monitor entry</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testWaitingOnMonitorEntry</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// 锁 obj 对象</span></span><br><span class="line">            <span class="keyword">synchronized</span> (obj)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">60000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// 锁 obj 对象</span></span><br><span class="line">            <span class="keyword">synchronized</span> (obj)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">60000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    thread.setName(<span class="string">&quot;test-thread&quot;</span>);</span><br><span class="line">    thread.start();</span><br><span class="line">    thread1.setName(<span class="string">&quot;test-thread1&quot;</span>);</span><br><span class="line">    thread1.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、执行结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&quot;test-thread1&quot; #14 prio=5 os_prio=31 tid=0x00007f9563880800 nid=0x5c03 waiting for monitor entry [0x000070000b029000]</span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack$2.run(TestJstack.java:50)</span><br><span class="line">	- waiting to lock &lt;0x000000076af261d0&gt; (a java.lang.Object)</span><br><span class="line"></span><br><span class="line">&quot;test-thread&quot; #13 prio=5 os_prio=31 tid=0x00007f956387f800 nid=0x5a03 waiting on condition [0x000070000af26000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class="line">	at java.lang.Thread.sleep(Native Method)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack$1.run(TestJstack.java:38)</span><br><span class="line">	- locked &lt;0x000000076af261d0&gt; (a java.lang.Object)</span><br></pre></td></tr></table></figure>

<p><strong>3、结果分析</strong></p>
<p>test-thread 获取到 obj 对象上的锁，因此正在执行 sleep 操作，状态为 TIMED_WAINTING, 而 test-thread1 由于未获取到 obj 对象上的锁，因此处于BLOCKED 状态。</p>
<blockquote>
<p>test-thread1 正在 “waiting to lock &lt;0x000000076af261d0&gt;”，试图在地址为 0x000000076af261d0 所在的对象获取锁，而该锁却被 test-thread 线程占有 [locked &lt;0x000000076af261d0&gt;]。test-thread 线程正在 “waiting on condition”，说明正在等待某个条件触发，由 jstack 来看，此线程正在sleep。</p>
</blockquote>
<h3 id="object-wait"><a href="#object-wait" class="headerlink" title="object.wait()"></a>object.wait()</h3><p><strong>1、执行代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testObjectWait</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    thread.start();</span><br><span class="line">    thread.setName(<span class="string">&quot;test-object-wait&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (thread) &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">30000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        thread.notify();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、执行结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&quot;test-object-wait&quot; #13 prio=5 os_prio=31 tid=0x00007fd43a809000 nid=0xa803 in Object.wait() [0x0000700010926000]</span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">	at java.lang.Object.wait(Native Method)</span><br><span class="line">	- waiting on &lt;0x000000076af26140&gt; (a com.glmapper.bridge.boot.TestJstack$3)</span><br><span class="line">	at java.lang.Object.wait(Object.java:502)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack$3.run(TestJstack.java:73)</span><br><span class="line">	- locked &lt;0x000000076af26140&gt; (a com.glmapper.bridge.boot.TestJstack$3)</span><br><span class="line"></span><br><span class="line">&quot;main&quot; #1 prio=5 os_prio=31 tid=0x00007fd43b001800 nid=0x2603 waiting on condition [0x000070000f2e4000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class="line">	at java.lang.Thread.sleep(Native Method)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack.testObjectWait(TestJstack.java:93)</span><br><span class="line">	- locked &lt;0x000000076af26140&gt; (a com.glmapper.bridge.boot.TestJstack$3)</span><br><span class="line">	at com.glmapper.bridge.boot.TestJstack.main(TestJstack.java:10)</span><br></pre></td></tr></table></figure>

<p><strong>3、结果分析</strong></p>
<p>由于调用了 object.wait() 方法的时候放弃了锁，所以 <code>test-object-wait</code> 这个线程就出现了 Object.wait() 状态，线程的状态就是 waiting；等待 notify 来进行唤醒。由于 mian 线程在获得 <code>test-object-wait</code> 的线程锁后，调用了 Thread.sleep 方法，所以此时进入了 wating on condition 等待某一个资源，进入到 time_waiting 状态。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>一般情况我们在做问题排查时，如果系统非常慢，我们需要特别关注 <code>Blocked</code>，<code>Waiting on condition</code> 这些状态。如果系统的 cpu 负载比较高的话，则可以死循环等思路去摸查，此时要关注下 <code>Runable</code> 状态；那如果堆栈中有 <code>Deadlock</code>，那就是产生了死锁。</p>
<h1 id="jstat-JVM统计监测工具"><a href="#jstat-JVM统计监测工具" class="headerlink" title="jstat(JVM统计监测工具)"></a>jstat(JVM统计监测工具)</h1><p><code>jstat</code> 是 JVM 统计监测工具，其语法格式如下：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]</span><br></pre></td></tr></table></figure></p>
<p> <code>vmid</code> 是 <code>Java</code> 虚拟机 <code>ID</code>，在 <code>Linux/Unix</code> 系统上一般就是进程 <code>ID</code>。<code>interval</code> 是采样时间间隔; <code>count</code> 是采样数目。比如下面输出的是 <code>GC</code> 信息，采样时间间隔为 1000ms，采样数为 3：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ jstat -gc 58950 1000 3</span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">10752.0 10752.0  0.0    0.0   65536.0   6554.0   175104.0     0.0     4480.0 785.7  384.0   75.9       0    0.000   0      0.000    0.000</span><br><span class="line">10752.0 10752.0  0.0    0.0   65536.0   6554.0   175104.0     0.0     4480.0 785.7  384.0   75.9       0    0.000   0      0.000    0.000</span><br><span class="line">10752.0 10752.0  0.0    0.0   65536.0   6554.0   175104.0     0.0     4480.0 785.7  384.0   75.9       0    0.000   0      0.000    0.000</span><br></pre></td></tr></table></figure></p>
<p> 输出信息的列释义：</p>
<ul>
<li>S0C、S1C、S0U、S1U：Survivor 0&#x2F;1区容量（Capacity）和使用量（Used）</li>
<li>EC、EU：Eden区容量和使用量</li>
<li>OC、OU：年老代容量和使用量</li>
<li>PC、PU：永久代容量和使用量</li>
<li>YGC、YGT：年轻代 GC 次数和 GC 耗时</li>
<li>FGC、FGCT：Full GC 次数和 Full GC耗时</li>
<li>GCT：GC 总耗时</li>
</ul>
<h1 id="jmap-Memory-Map"><a href="#jmap-Memory-Map" class="headerlink" title="jmap(Memory Map)"></a>jmap(Memory Map)</h1><p><code>jmap</code> 用来查看堆内存使用状况，一般结合 <code>jhat</code> 使用。其使用语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jmap [option] &lt;pid&gt;</span><br><span class="line">jmap [option] &lt;executable &lt;core&gt;</span><br><span class="line">jmap [option] [server_id@]&lt;remote server IP or hostname&gt;</span><br></pre></td></tr></table></figure>

<p><code>Options</code> 参数说明如下：</p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><none></td>
<td align="left">打印与 <code>Solaris pmap</code> 相同的信息</td>
</tr>
<tr>
<td align="left">-heap</td>
<td align="left">打印 <code>java</code> 堆摘要</td>
</tr>
<tr>
<td align="left">-histo[:live]</td>
<td align="left">打印 java 对象堆的直方图;如果指定了“live”子选项，则只计算live对象</td>
</tr>
<tr>
<td align="left">-clstats</td>
<td align="left">打印 classloader 统计信息</td>
</tr>
<tr>
<td align="left">-finalizerinfo</td>
<td align="left">打印 等待终结 对象的信息</td>
</tr>
<tr>
<td align="left">–dump:<dump-options> :</td>
<td align="left">以 hprof 二进制格式dump java heap</td>
</tr>
<tr>
<td align="left">-F</td>
<td align="left">使用 -dump:<dump-options> <pid> or -histo 强制执行</td>
</tr>
<tr>
<td align="left">-J<flag></td>
<td align="left">将 <flag> 直接传递给运行时系统</td>
</tr>
</tbody></table>
<p>dump-options 又包括以下几个选项：</p>
<ul>
<li>live ： 只 dump 活动对象;如果未指定，堆中的所有对象将被dump。</li>
<li>format&#x3D;b ： 二进制格式</li>
<li>file&#x3D;<file> ： dump 到指定文件</li>
</ul>
<h2 id="jmap-heap"><a href="#jmap-heap" class="headerlink" title="jmap -heap"></a><code>jmap -heap</code></h2><p>通过指定 <code>pid</code>，可以将当前进程的 <code>heap</code> 信息打印在 <code>console</code> 上，包括使用的 <code>GC</code> 算法、堆配置参数和各代中堆内存使用情况，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -heap 3493</span><br><span class="line">Attaching to process ID 3493, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.172-b245</span><br><span class="line"></span><br><span class="line">using parallel threads in the new generation.(eden 区使用的是并发线程)</span><br><span class="line">using thread-local object allocation.(使用线程本地对象分配)</span><br><span class="line">Concurrent Mark-Sweep GC (使用 CMS 垃圾收集器)</span><br><span class="line"># 堆配置信息</span><br><span class="line">Heap Configuration:</span><br><span class="line">   MinHeapFreeRatio         = 40</span><br><span class="line">   MaxHeapFreeRatio         = 70</span><br><span class="line">   MaxHeapSize              = 2147483648 (2048.0MB)</span><br><span class="line">   NewSize                  = 805306368 (768.0MB)</span><br><span class="line">   MaxNewSize               = 805306368 (768.0MB)</span><br><span class="line">   OldSize                  = 1342177280 (1280.0MB)</span><br><span class="line">   NewRatio                 = 2</span><br><span class="line">   SurvivorRatio            = 8</span><br><span class="line">   MetaspaceSize            = 21807104 (20.796875MB)</span><br><span class="line">   CompressedClassSpaceSize = 1073741824 (1024.0MB)</span><br><span class="line">   MaxMetaspaceSize         = 17592186044415 MB</span><br><span class="line">   G1HeapRegionSize         = 0 (0.0MB)</span><br><span class="line"></span><br><span class="line"># 堆使用情况</span><br><span class="line">Heap Usage:</span><br><span class="line">New Generation (Eden + 1 Survivor Space):</span><br><span class="line">   capacity = 724828160 (691.25MB)</span><br><span class="line">   used     = 35156456 (33.527809143066406MB)</span><br><span class="line">   free     = 689671704 (657.7221908569336MB)</span><br><span class="line">   4.850315970063856% used</span><br><span class="line">Eden Space:</span><br><span class="line">   capacity = 644349952 (614.5MB)</span><br><span class="line">   used     = 19878008 (18.95714569091797MB)</span><br><span class="line">   free     = 624471944 (595.542854309082MB)</span><br><span class="line">   3.084970820328392% used</span><br><span class="line">From Space:</span><br><span class="line">   capacity = 80478208 (76.75MB)</span><br><span class="line">   used     = 15278448 (14.570663452148438MB)</span><br><span class="line">   free     = 65199760 (62.17933654785156MB)</span><br><span class="line">   18.984577787815553% used</span><br><span class="line">To Space:</span><br><span class="line">   capacity = 80478208 (76.75MB)</span><br><span class="line">   used     = 0 (0.0MB)</span><br><span class="line">   free     = 80478208 (76.75MB)</span><br><span class="line">   0.0% used</span><br><span class="line">concurrent mark-sweep generation:</span><br><span class="line">   capacity = 1342177280 (1280.0MB)</span><br><span class="line">   used     = 166885296 (159.1542205810547MB)</span><br><span class="line">   free     = 1175291984 (1120.8457794189453MB)</span><br><span class="line">   12.433923482894897% used</span><br><span class="line"></span><br><span class="line">55843 interned Strings occupying 6689024 bytes.</span><br></pre></td></tr></table></figure>

<h2 id="jmap-clstats"><a href="#jmap-clstats" class="headerlink" title="jmap -clstats"></a>jmap -clstats</h2><p>通过指定 pid ，可以将当前进程的 classloader 统计信息打印在 console 上，包括类加载器名称、对象是否存活、对象地址、父类加载器、已加载的类大小等信息，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -clstats  3493</span><br><span class="line">Attaching to process ID 3493, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.172-b245</span><br><span class="line">finding class loader instances ..done.</span><br><span class="line">computing per loader stat ..done.</span><br><span class="line">please wait.. computing liveness.......................liveness analysis may be inaccurate ...</span><br><span class="line">class_loader	classes	bytes	parent_loader	alive?	type</span><br><span class="line"></span><br><span class="line">&lt;bootstrap&gt;	3211	5818395	  null  	live	&lt;internal&gt;</span><br><span class="line">0x00000000b150ed50	1	1491	0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000b8715670	1	900	    0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000cb417140	1	1503	0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000b98b4388	1	1491	  null  	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000b5a419a0	1	900	    0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000b358df50	1	1493	0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000b7b277b8	1	1503	0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000c2527c58	1	1505	0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000b98b4580	1	1491	0x00000000b0026260	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000b9b307b8	1	1493	0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000e236b038	1	900	    0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000b0108400	1	1493	0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br><span class="line">0x00000000b010bc00	3	7946	0x00000000b0022f60	live	org/jacoco/compass/agent/rt/internal/fastjson/util/ASMClassLoader@0x00000001000eb830</span><br><span class="line">0x00000000b358e148	1	1493	0x00000000b0020830	dead	sun/reflect/DelegatingClassLoader@0x000000010000a040</span><br></pre></td></tr></table></figure>

<h2 id="jmap-histo"><a href="#jmap-histo" class="headerlink" title="jmap -histo"></a>jmap -histo</h2><p>使用 jmap -histo pid 可以查看堆内存中的对象数目、大小统计直方图，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># jmap -histo:live 1493  带上 live 则只统计存活对象</span><br><span class="line">$ jmap -histo 1493  </span><br><span class="line">num     #instances         #bytes  class name</span><br><span class="line">----------------------------------------------</span><br><span class="line">   1:       1314509      144436976  [C</span><br><span class="line">   2:       1572864       37748736  org.apache.logging.log4j.core.async.AsyncLoggerConfigDisruptor$Log4jEventWrapper</span><br><span class="line">   3:         77458       32776608  [B</span><br><span class="line">   4:       1061561       25477464  java.lang.String</span><br><span class="line">   5:        731623       23411936  java.util.HashMap$Node</span><br><span class="line">   6:         32930       22826616  [I</span><br><span class="line">   7:        150340       15546784  [Ljava.util.HashMap$Node;</span><br><span class="line">   8:        144895       14968208  [Ljava.lang.Object;</span><br><span class="line">   9:        377379       12076128  java.util.concurrent.ConcurrentHashMap$Node</span><br><span class="line">  10:        230943       11085264  java.util.HashMap</span><br><span class="line">  11:         81124        3893952  java.nio.HeapByteBuffer</span><br><span class="line">  12:          3396        3869944  [Ljava.util.concurrent.ConcurrentHashMap$Node;</span><br><span class="line">  13:         78418        3764064  java.nio.HeapCharBuffer</span><br><span class="line">  14:         75784        3031360  java.util.TreeMap$Entry</span><br><span class="line">  15:         72865        2914600  java.util.LinkedHashMap$Entry</span><br><span class="line">  16:        166213        2659408  java.util.HashSet</span><br><span class="line">  17:         18355        2643120  com.mysql.jdbc.Field</span><br><span class="line">  18:         18394        2044336  java.lang.Class</span><br><span class="line">  19:         19966        1757008  java.lang.reflect.Method</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS: 上图中的 [C [B 指的是 class 的对象类型，下面是常见类型的参考</p>
<ul>
<li>B  byte</li>
<li>C  char</li>
<li>D  double</li>
<li>F  float</li>
<li>I  int</li>
<li>J  long</li>
<li>Z  boolean</li>
<li>[  数组，如 [I 表示 int[]</li>
<li>[L+类名 其他对象，如 [Ljava.lang.Object</li>
</ul>
</blockquote>
<h2 id="jmap-dump"><a href="#jmap-dump" class="headerlink" title="jmap -dump"></a>jmap -dump</h2><p>绝大多数情况下，我们不会直接在 console 来打印分析，更常规的做法是 dump 到指定的文件，然后通过一些可视化工具来辅助分析；那执行 dump 到文件一般使用如下指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jmap -dump:format=b,file=dumpFileName pid   # 语法</span><br><span class="line"></span><br><span class="line">$ jmap -dump:format=b,file=test-dump.bin 85716  # 举例</span><br><span class="line">Dumping heap to /Users/guolei.sgl/test-dump.bin ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure>

<p>对于 dump 下来的文件，可以通过 jprofile 等图形化工具来分析，如下</p>
<p><img src="https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/jprofile.jpg"></p>
<p>也可以通过 jhat 查看，操作方式如下：</p>
<p><strong>1、起 http 服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">jhat -port 9300 test-dump.bin</span><br><span class="line">Reading from test-dump.bin...</span><br><span class="line">Dump file created Wed Oct 28 17:54:24 CST 2020</span><br><span class="line">Snapshot read, resolving...</span><br><span class="line">Resolving 1151952 objects...</span><br><span class="line">Chasing references, expect 230 dots......................................................................................................................................................................................................................................</span><br><span class="line">Eliminating duplicate references......................................................................................................................................................................................................................................</span><br><span class="line">Snapshot resolved.</span><br><span class="line">Started HTTP server on port 9300</span><br><span class="line">Server is ready.</span><br></pre></td></tr></table></figure>

<p><strong>2、dump 类概要信息</strong></p>
<p>访问 localhost:9300 查看 dump 概要信息</p>
<p><img src="https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/jvm/jhat.jpg"></p>
<p><strong>3、class 详情</strong></p>
<p>点击某个类查看详细信息</p>
<p><img src="https://glmapper-blog.oss-cn-hangzhou.aliyuncs.com/jvm/jhat-details.jpg"></p>
<h1 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h1><p>本文介绍了一些 JDK 自带的一些性能调优监控工具，通过对这些工具的掌握，可以使的我们在实际的开发或者运维中能够快速的去定位和解决一些问题，常见的有 OOM、内存泄漏、线程死锁、CPU 负载高等等；目前社区也有很多好用的工具，例如 <a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/">Arthas</a>，<a target="_blank" rel="noopener" href="https://www.perfma.com/">perfma</a> 等。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>JVM 性能调优监控工具</p><p><a href="http://www.glmapper.com/2020/10/26/jvm/jvm-self-command/">http://www.glmapper.com/2020/10/26/jvm/jvm-self-command/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>J.Queue</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-10-26</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-04-23</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/jvm/">jvm</a><a class="link-muted mr-2" rel="tag" href="/tags/JDK/">JDK</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/zfb.JPG" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/pay.JPG" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/10/26/linux/linux-cmd-yum/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">yum 指令</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/08/10/linux/linux-cmd-top/"><span class="level-item">Linux Top 命令指南</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "9eeef07e958dbf93bbf9a05b5d849e55",
            repo: "glmapper.github.io",
            owner: "glmapper",
            clientID: "d25147ddf77e70d7adfe",
            clientSecret: "c10bbd1ba7a09c96e4106709107d4da85d60be78",
            admin: ["glmapper"],
            createIssueManually: false,
            distractionFreeMode: true,
            perPage: 20,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/self.jpg" alt="J.Queue"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">J.Queue</p><p class="is-size-6 is-block">Java Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>HeFei AnHui</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">108</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">17</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">128</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/glmapper" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/glmapper"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="weibo" href="https://weibo.com/u/2412872703"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://juejin.cn/user/3227821827961806" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金社区</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://www.sofastack.tech/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">SOFAStack</span></span><span class="level-right"><span class="level-item tag">www.sofastack.tech</span></span></a></li></ul></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#jps-Java-Virtual-Machine-Process-Status-Tool"><span class="level-left"><span class="level-item">1</span><span class="level-item">jps(Java Virtual Machine Process Status Tool)</span></span></a></li><li><a class="level is-mobile" href="#jstack-Java-Stack-Trace"><span class="level-left"><span class="level-item">2</span><span class="level-item">jstack(Java Stack Trace)</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#jstack-堆栈信息介绍"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">jstack 堆栈信息介绍</span></span></a></li><li><a class="level is-mobile" href="#线程状态介绍"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">线程状态介绍</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#TIMED-WAITING"><span class="level-left"><span class="level-item">2.2.1.1</span><span class="level-item">TIMED_WAITING</span></span></a></li><li><a class="level is-mobile" href="#RUNNABLE"><span class="level-left"><span class="level-item">2.2.1.2</span><span class="level-item">RUNNABLE</span></span></a></li></ul></ul></li><li><a class="level is-mobile" href="#线程状态举例及-jstack-分析"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">线程状态举例及 jstack 分析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#waiting-on-condition"><span class="level-left"><span class="level-item">2.3.1</span><span class="level-item">waiting on condition</span></span></a></li><li><a class="level is-mobile" href="#waiting-on-condition-parking"><span class="level-left"><span class="level-item">2.3.2</span><span class="level-item">waiting on condition (parking)</span></span></a></li><li><a class="level is-mobile" href="#waiting-on-monitor-entry"><span class="level-left"><span class="level-item">2.3.3</span><span class="level-item">waiting on monitor entry</span></span></a></li><li><a class="level is-mobile" href="#object-wait"><span class="level-left"><span class="level-item">2.3.4</span><span class="level-item">object.wait()</span></span></a></li></ul></li><li><a class="level is-mobile" href="#小结"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">小结</span></span></a></li></ul></li><li><a class="level is-mobile" href="#jstat-JVM统计监测工具"><span class="level-left"><span class="level-item">3</span><span class="level-item">jstat(JVM统计监测工具)</span></span></a></li><li><a class="level is-mobile" href="#jmap-Memory-Map"><span class="level-left"><span class="level-item">4</span><span class="level-item">jmap(Memory Map)</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#jmap-heap"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">jmap -heap</span></span></a></li><li><a class="level is-mobile" href="#jmap-clstats"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">jmap -clstats</span></span></a></li><li><a class="level is-mobile" href="#jmap-histo"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">jmap -histo</span></span></a></li><li><a class="level is-mobile" href="#jmap-dump"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">jmap -dump</span></span></a></li></ul></li><li><a class="level is-mobile" href="#小结-1"><span class="level-left"><span class="level-item">5</span><span class="level-item">小结</span></span></a></li></ul></div></div><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/BeanDefinition/"><span class="tag">BeanDefinition</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BeanPostProcessor/"><span class="tag">BeanPostProcessor</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BeanWrapper/"><span class="tag">BeanWrapper</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CAS/"><span class="tag">CAS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ClassLoader/"><span class="tag">ClassLoader</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CopyOnWriteArraySet/"><span class="tag">CopyOnWriteArraySet</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Disruptor/"><span class="tag">Disruptor</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Embedded-Tomcat/"><span class="tag">Embedded Tomcat</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Exception/"><span class="tag">Exception</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Executor/"><span class="tag">Executor</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FX-Application/"><span class="tag">FX Application</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FatJar/"><span class="tag">FatJar</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ioc/"><span class="tag">Ioc</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JAR/"><span class="tag">JAR</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JDK/"><span class="tag">JDK</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JUC/"><span class="tag">JUC</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kafka/"><span class="tag">Kafka</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MANIFEST-MF/"><span class="tag">MANIFEST.MF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mockito/"><span class="tag">Mockito</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mysql/"><span class="tag">Mysql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OOM/"><span class="tag">OOM</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenTracing/"><span class="tag">OpenTracing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PropertySource/"><span class="tag">PropertySource</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Readiness-Check/"><span class="tag">Readiness Check</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ResourceLoader/"><span class="tag">ResourceLoader</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RestTemplate/"><span class="tag">RestTemplate</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RocketMQ/"><span class="tag">RocketMQ</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SOFA/"><span class="tag">SOFA</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SOFAArk/"><span class="tag">SOFAArk</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SOFAStack/"><span class="tag">SOFAStack</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringBoot/"><span class="tag">SpringBoot</span><span class="tag">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TestDouble/"><span class="tag">TestDouble</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ThreadPoolExecutor/"><span class="tag">ThreadPoolExecutor</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tracer/"><span class="tag">Tracer</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Zipkin/"><span class="tag">Zipkin</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ab-test/"><span class="tag">ab test</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/actuator/"><span class="tag">actuator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/aop/"><span class="tag">aop</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/api/"><span class="tag">api</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apollo/"><span class="tag">apollo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bean-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6/"><span class="tag">bean 扩展机制</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"><span class="tag">bean 生命周期</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bootstrap/"><span class="tag">bootstrap</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cache/"><span class="tag">cache</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/classloader/"><span class="tag">classloader</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/config/"><span class="tag">config</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cookie/"><span class="tag">cookie</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/curator/"><span class="tag">curator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/eureka/"><span class="tag">eureka</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/event/"><span class="tag">event</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/feign/"><span class="tag">feign</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gateway/"><span class="tag">gateway</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gc/"><span class="tag">gc</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/guava/"><span class="tag">guava</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/http/"><span class="tag">http</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hystrix/"><span class="tag">hystrix</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/junit/"><span class="tag">junit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jvm/"><span class="tag">jvm</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kafka/"><span class="tag">kafka</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lock/"><span class="tag">lock</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">log</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/logback/"><span class="tag">logback</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maven/"><span class="tag">maven</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maven-debug/"><span class="tag">maven debug</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/maven-plugin/"><span class="tag">maven plugin</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/merge/"><span class="tag">merge</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/microservices/"><span class="tag">microservices</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mock/"><span class="tag">mock</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mybatis/"><span class="tag">mybatis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nacos/"><span class="tag">nacos</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/namespace/"><span class="tag">namespace</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/netflix/"><span class="tag">netflix</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/oop-klass/"><span class="tag">oop-klass</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reactor/"><span class="tag">reactor</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rebase/"><span class="tag">rebase</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rpc/"><span class="tag">rpc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/session/"><span class="tag">session</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/set/"><span class="tag">set</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shell/"><span class="tag">shell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/slf4j/"><span class="tag">slf4j</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring/"><span class="tag">spring</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring-cloud/"><span class="tag">spring cloud</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring-mvc/"><span class="tag">spring mvc</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6/"><span class="tag">spring 扩展机制</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sql/"><span class="tag">sql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/starter-%E6%9C%BA%E5%88%B6/"><span class="tag">starter 机制</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/test/"><span class="tag">test</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/testing/"><span class="tag">testing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/thread/"><span class="tag">thread</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tomcat/"><span class="tag">tomcat</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/top/"><span class="tag">top</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/typecheck/"><span class="tag">typecheck</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/yapi/"><span class="tag">yapi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/yum/"><span class="tag">yum</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zookeeper/"><span class="tag">zookeeper</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B8%AD%E5%8F%B0/"><span class="tag">中台</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/"><span class="tag">事件机制</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"><span class="tag">依赖注入</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"><span class="tag">分布式</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"><span class="tag">分布式链路跟踪</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"><span class="tag">反向代理</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%B0%84/"><span class="tag">反射</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%90%88%E8%82%A5/"><span class="tag">合肥</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><span class="tag">并发编程</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"><span class="tag">微服务</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%AD%E5%B7%9E/"><span class="tag">杭州</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9E%B6%E6%9E%84/"><span class="tag">架构</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%A1%86%E6%9E%B6/"><span class="tag">框架</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B3%9B%E5%9E%8B/"><span class="tag">泛型</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"><span class="tag">注册中心</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B6%88%E6%81%AF/"><span class="tag">消息</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD/"><span class="tag">类加载</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"><span class="tag">线程池</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE/"><span class="tag">自动配置</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"><span class="tag">负载均衡</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%BF%90%E7%BB%B4/"><span class="tag">运维</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8/"><span class="tag">迭代器</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%85%8D%E7%BD%AE/"><span class="tag">配置</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9B%86%E7%BE%A4%E9%80%89%E4%B8%BB/"><span class="tag">集群选主</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">J.Queue的技术博客</a><p class="is-size-7"><span>&copy; 2022 J.Queue</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/glmapper"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: false,
                    fold: ''
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>